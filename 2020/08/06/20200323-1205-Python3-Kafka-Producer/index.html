<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/shin.png">
  <link rel="icon" type="image/png" href="/img/shin.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="description" content="">
  <meta name="author" content="Shinnosuke Guo">
  <meta name="keywords" content="">
  <title>20200323_1205_Python3-Kafka-Producer ~ Shinnosuke</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


<meta name="generator" content="Hexo 4.1.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Shinnosuke</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">Categories</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/archive.jpg')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  Thursday, August 6th 2020, 1:21 pm
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    5.7k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      34 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h2 id="Python3-KafkaProducerWithPostgreSQL"><a href="#Python3-KafkaProducerWithPostgreSQL" class="headerlink" title="Python3 KafkaProducerWithPostgreSQL"></a>Python3 KafkaProducerWithPostgreSQL</h2><h3 id="01-数据库数据采集-amp-监控"><a href="#01-数据库数据采集-amp-监控" class="headerlink" title="01. 数据库数据采集&amp;监控"></a>01. 数据库数据采集&amp;监控</h3><ul>
<li><p>Repo Point<br>  kafka-python<br>  psycopg2</p>
</li>
<li><p>class_Kafka_producer_linux_section2.py</p>
</li>
</ul>
<pre><code class="python"># -*- coding:utf-8 -*-
# @Author: Shin
# @Date: 20/3/23 10:13
# @File: class_Kafka_producer_linux_section2.py
# @Usage: Kafka producer for kafka_2.11-0.10.2.1


from kafka import KafkaProducer
import threading

# Self Repo
# from src.func_demo.func_f import clog2, errclog2
from func_demo.func_f import clog2, errclog2


class KafkaProducerPython(object):

    def __init__(self, topic, bootstrap_servers=&#39;localhost:9092&#39;):
        &quot;&quot;&quot;
        :param bootstrap_servers:   host:port for Kafka
        :param topic:   Kafka topic
        &quot;&quot;&quot;
        self.bootstrap_servers = bootstrap_servers
        self.topic = topic
        self.producer = None
        self.future_record_metadata = None

    def producer_send(self, value_byte):
        &quot;&quot;&quot;
        :param value_byte:  str or json_str in bytes
        :return:    &lt;class &#39;kafka.producer.future.FutureRecordMetadata&#39;&gt;
        &quot;&quot;&quot;
        try:
            self.producer = KafkaProducer(bootstrap_servers=self.bootstrap_servers)
            # clog2.logger.warning(f&#39;Kafka Producer Begin: {self.producer}&#39;)

            self.future_record_metadata = self.producer.send(self.topic, value_byte)   # &lt;class &#39;kafka.producer.future.FutureRecordMetadata&#39;&gt;
            # print(type(self.future_record_metadata))
            return self.future_record_metadata

        except Exception as e:
            clog2.logger.error(f&#39;Kafka producer send error... {e}&#39;)
        finally:
            self.producer.flush()

    def producer_send_callback(self, future_record_metadata):
        &quot;&quot;&quot;
        :param future_record_metadata: &lt;class &#39;kafka.producer.future.FutureRecordMetadata&#39;&gt; producer.send 返回
        :return: 
        &quot;&quot;&quot;
        # log = Logger(filename = f&#39;./logs/all_bokeh.log&#39;, level=&#39;info&#39;, when=&#39;H&#39;)
        # clog2.logger.info(f&#39;future_record_metadata.topic: {future_record_metadata.topic}&#39;)
        clog2.logger.info(f&#39;future_record_metadata.offset: {future_record_metadata.offset}&#39;)
        # clog2.logger.info(f&#39;future_record_metadata.partition: {future_record_metadata.partition}&#39;)
        # clog2.logger.warning(f&#39;Kafka Producer End: {self.producer}\n&#39;)

    # def on_send_err(self):
    # clog2.logger.info(&#39;I am an errback&#39;, exc_info=excp)

    def producer_send_log(self, info):
        &quot;&quot;&quot;
        :param info: &lt;class json2byte&#39;&gt;
        :return: 
        &quot;&quot;&quot;
        clog2.logger.info(f&#39;future_record_metadata.info: {info}&#39;)

    def to_bytes(self, v):
        v_byte = bytes(str(v).strip(), encoding=&#39;utf-8&#39;)
        return v_byte
        # return str(v)


class MyThread(threading.Thread):
    def __init__(self, func=None, args=()):
        super().__init__()
        self.func = func
        self.args = args
        self.result = []

    def run(self):
        self.result = self.func(*self.args)

    def get_result(self):
        # noinspection PyBroadException
        try:
            return self.result
        except Exception as e:
            errclog2.logger.error(f&#39;Results within threading. {e}&#39;)
            return 1</code></pre>
<hr>
<ul>
<li>class_DB_demo.py</li>
</ul>
<pre><code class="python"># -*- coding:utf-8 -*-
# @Author: Shin
# @Date: 20/3/29 12:19
# @File: class_DB_demo.py
# @Usage: 

import pymysql as pm
import psycopg2 as pg
from psycopg2.extras import execute_values

# Self Repo
from src.func_demo.logging_f import *

# 下面的三行包其实是main函数中使用，有部分重复
# Self Repo
# from src.class_DB_demo import UseMySQL, UsePostgreSQL, ExecutePostgreSQL
from src.conf.kafka_conf import mysql_conn, pgsql_conn, pgsql_conn_pp, pgsql_conn_prod
from src.func_demo.logging_f import *

class UseMySQL(object):
    def __init__(self, config:dict):
        self.configurantion = config

    def __enter__(self):
        self.conn = pm.connect(**self.configurantion)
        self.cursor = self.conn.cursor()
        return self.cursor

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.conn.commit()
        self.cursor.close()
        self.conn.close()


class UsePostgreSQL(object):
    def __init__(self, config:dict):
        self.config = config

    def __enter__(self):
        self.conn = pg.connect(**self.config)
        self.cursor = self.conn.cursor()
        return self.cursor

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.conn.commit()
        self.cursor.close()
        self.conn.close()


class ExecutePostgreSQL(object):
    def __init__(self, kwargs:dict):
        self.cur = kwargs[&#39;cur&#39;]
        self.sql = kwargs[&#39;sql&#39;]
        self.argslist = kwargs[&#39;argslist&#39;]

    def pg_insert(self):
        # super(ExecutePostgreSQL, self).__enter__()
        try:
            log.logger.warning(f&#39;UsePostgreSQL.pg_insert Begin.&#39;)
            log.logger.info(f&#39;Total rows for current rollover: {len(self.argslist)}&#39;)
            execute_values(cur=self.cur, sql=self.sql, argslist=self.argslist)
            log.logger.warning(f&#39;UsePostgreSQL.pg_insert End.&#39;)
        except Exception as e:
            errlog.logger.error(f&#39;pg_insert: {e}&#39;)


# Demo
if __name__ == &#39;__main__&#39;:
    # MySQL cursor
    try:
        log.logger.warning(f&#39;MySQL Begin...&#39;)
        with UseMySQL(mysql_conn) as cursor:
            sql_1 = &quot;&quot;&quot;show tables&quot;&quot;&quot;
            sql_1 = &quot;&quot;&quot;select * from MURA.t_pm_alarm_tst&quot;&quot;&quot;
            cursor.execute(sql_1)
            data = cursor.fetchall()
            col0 = [x for x in data]    # [(),(),()]
            k = 0
            for rs in col0:
                k += 1
                print(f&#39;k:{k}   v:{rs}\nc1:{rs[0]} c2:{rs[1]} c3:{rs[2]} c4:{rs[3]} c5:{rs[4]} c6:{rs[5]} c7:{rs[6]}\n&#39;)

     except Exception as e:
        log.logger.error(f&#39;{e}\n&#39;)
        errlog.logger.error(f&#39;{e}&#39;)


    # PostgreSQL cursor
     try:
        log.logger.warning(f&#39;PostgreSQL Begin!!!&#39;)
        with UsePostgreSQL(pgsql_conn_pp) as cursor:
            sql_1 = &quot;&quot;&quot;SELECT * FROM public.t_fm_alarm_fields&quot;&quot;&quot;
            # sql_2 = &quot;&quot;&quot;SELECT COUNT(1) FROM public.t_fm_alarm_fields&quot;&quot;&quot;
            sql_3 = &quot;&quot;&quot;INSERT INTO public.t_fm_alarm_fields VALUES %s&quot;&quot;&quot;
            sql_4 = &quot;&quot;&quot;TRUNCATE TABLE public.t_fm_alarm_fields&quot;&quot;&quot;
            size = 100

            log.logger.info(f&#39;Current execution &lt;{sql_1}&gt;&#39;)
            cursor.execute(sql_1)

            rowcnt = cursor.rowcount
            log.logger.info(f&#39;Total rows for current execution &lt;{sql_1}&gt;: {rowcnt}&#39;)

            limitcnt, limitlast = divmod(rowcnt, size)
            log.logger.info(f&#39;Based on interval: {size}, total rows for rollover: {limitcnt}, ending number: {limitlast}&#39;)

            with UsePostgreSQL(pgsql_conn_prod) as cursor2_1:
                cursor2_1.execute(sql_4)  # 清理

            with UsePostgreSQL(pgsql_conn_prod) as cursor2_2:
                for rn in range(limitcnt + 1):
                    data = cursor.fetchmany(size=size)
                    exe_dict = {
                                    &quot;cur&quot;: cursor2_2,
                                    &quot;sql&quot;: sql_3,
                                    &quot;argslist&quot;: data
                    }
                    pg_prod = ExecutePostgreSQL(exe_dict)   # 批插入，更效率
                    pg_prod.pg_insert()

            with UsePostgreSQL(pgsql_conn_prod) as cursor3:
                cursor3.execute(sql_1)
                # result = cursor3.fetchall()
                log.logger.info(f&#39;Total rows for execution: {cursor3.rowcount}&#39;)

        log.logger.warning(f&#39;PostgreSQL End!!!&#39;)

    except Exception as e:
        log.logger.error(f&#39;{e}\n&#39;)
        errlog.logger.error(f&#39;{e}&#39;)</code></pre>
<hr>
<ul>
<li>logging_f.py</li>
</ul>
<pre><code class="python"># -*- coding:utf-8 -*-
# @Author: Shin
# @Date: 20/3/5 17:05
# @File: logging_f.py
# @Usage: 


import logging
from logging import handlers
import re


# Self Repo
from src.func_demo.func_f import *
# from func_demo.func_f import *


def re_match(list_input, re_pattern):
    &quot;&quot;&quot;
    :param list_input:  &lt;class: list&gt;
    :param re_pattern:  RE

    :return:    返回正则匹配结果集 re.compile(re_pattern).findall() &lt;class: list&gt;
    &quot;&quot;&quot;
    log.logger.info(f&#39;***RE***&#39;)
    try:
        p = re.compile(re_pattern)
        match_result = [rs for rs in list_input if p.findall(rs)]  # 别忘了，findall返回的是 &lt;class &#39;list&#39;&gt;
        # print(match_result)
        return match_result

    except Exception as e:
        print(&#39;Status: RE failed!&#39;)
        print(&#39;------------------&#39; * 2, f&#39;\nError Details:\n{e}&#39;)
        print(&#39;------------------&#39; * 2)
        return 1


class Logger(object):
    # 日志级别关系映射，这种定义类的变量x，并使用self.x运用于类方法内，还是第一次见    ---&gt;
    level_relations = {
        &#39;debug&#39;:logging.DEBUG,
        &#39;info&#39;:logging.INFO,
        &#39;warning&#39;:logging.WARNING,
        &#39;error&#39;:logging.ERROR,
        &#39;crit&#39;:logging.CRITICAL
    }

    def __init__(self, filename, level=&#39;warning&#39;, when=&#39;D&#39;, backup_count=7, interval=1,
                 fmt=&#39;%(asctime)s   %(pathname)s ---&gt; %(funcName)s ---&gt; %(threadName)s ---&gt; [line:%(lineno)d][%(levelname)s] ⬇⬇⬇\n&#39;
                     &#39;%(asctime)s   ⬆⬆⬆ [%(levelname)s]: %(message)s&#39;):

        # 1.最低级别logging对象设置
        self.logger = logging.getLogger(filename)
        self.format_str = logging.Formatter(fmt, datefmt=&#39;%Y-%m-%d %H:%M:%S&#39;) # 设置日志格式
        self.logger.setLevel(self.level_relations.get(level))   # 设置日志级别    &lt;---

        # 2.不同级别的Handler对象：sh &amp; th
        sh = logging.StreamHandler()  # 控制台流式输出
        sh.setFormatter(self.format_str)   # 设置屏幕上显示的格式
        # logging.handlers.RotatingFileHandler  # 按大小切分
        # logging.FileHandler # 文件输出

        # 指定间隔时间自动生成文件的对象处理器
        # 实例化TimedRotatingFileHandler
        th = handlers.TimedRotatingFileHandler(filename=filename,
                                               when=when,
                                               backupCount=backup_count,
                                               encoding=&#39;utf-8&#39;,
                                               interval=interval,
                                               delay=True
                                               )    # 往文件里写入
        # interval是时间间隔，backupCount是备份文件的个数，如果超过这个个数，就会自动删除，when是间隔的时间单位，单位有以下几种：
        # S/M/H/D/W/midnight
        th.setFormatter(self.format_str)    # 设置文件里写入的格式

        # 3.从对象处理器内添加
        self.logger.addHandler(sh) #把对象加到logger里
        self.logger.addHandler(th)
        # self.logger.removeHandler(sh)

    def err_log_test(self):
        print(1 + &#39;_2&#39;)


current_path = f&#39;./logs/&#39;
log = Logger(filename=current_path + f&#39;all_bokeh.log&#39;, level=&#39;info&#39;, when=&#39;H&#39;, fmt=&#39;%(asctime)s   [line:%(lineno)d][%(levelname)s]: %(message)s&#39;)
errlog = Logger(filename=current_path + f&#39;err_bokeh.log&#39;, level=&#39;error&#39;, when=&#39;H&#39;, fmt=&#39;%(asctime)s   [line:%(lineno)d][%(levelname)s]: %(message)s&#39;)</code></pre>
<hr>
<ul>
<li>func_f.py</li>
</ul>
<pre><code class="python">
# -*- coding:utf-8 -*-
# @Author: Shin
# @Date: 19/9/5 8:08
# @File: func_f.py

import datetime
import os
import shutil
from sys import exc_info, path
from re import compile as re_compile
# from pprint import pprint


def date_f(daysdelta=0, hoursdelta=0):
    &quot;&quot;&quot;
    :param timedelta: Day Intervals
    :param hoursdelta: Hour Intervals
    :return: date &lt;class:tuple&gt;
            Ex: (&#39;20191205&#39;, &#39;2019120522&#39;, &#39;20191205 22:40:51&#39;,
                 {&#39;year&#39;: &#39;2019&#39;, &#39;month&#39;: &#39;12&#39;, &#39;day&#39;: &#39;05&#39;, &#39;hour&#39;: &#39;22&#39;}, &#39;src.func_demo.func_f&#39;)
    &quot;&quot;&quot;
    # date = []
    # date_str = datetime.datetime.now().strftime(&#39;%Y%m%d&#39;)

    date_str = (datetime.datetime.now() + datetime.timedelta(days=daysdelta, hours=hoursdelta)).strftime(&#39;%Y%m%d&#39;)
    date_str_h = (datetime.datetime.now() + datetime.timedelta(days=daysdelta, hours=hoursdelta)).strftime(&#39;%Y%m%d%H&#39;)
    date_str_s = (datetime.datetime.now() + datetime.timedelta(days=daysdelta, hours=hoursdelta)).strftime(&#39;%Y%m%d %H:%M:%S&#39;)

    # 各维度时间戳段拆分
    year = (datetime.datetime.now() + datetime.timedelta(days=daysdelta, hours=hoursdelta)).strftime(&#39;%Y&#39;)
    month = (datetime.datetime.now() + datetime.timedelta(days=daysdelta, hours=hoursdelta)).strftime(&#39;%m&#39;)
    day = (datetime.datetime.now() + datetime.timedelta(days=daysdelta, hours=hoursdelta)).strftime(&#39;%d&#39;)
    hour = (datetime.datetime.now() + datetime.timedelta(days=daysdelta, hours=hoursdelta)).strftime(&#39;%H&#39;)
    date_dict = dict(year=year, month=month, day=day, hour=hour)

    # 所有已知时间格式组合
    date = (date_str, date_str_h, date_str_s, date_dict, __name__)
    return date</code></pre>
<hr>
<ul>
<li>kafka_conf.py</li>
</ul>
<pre><code class="python"># -*- coding:utf-8 -*-
# @Author: Shin
# @Date: 20/3/23 15:46
# @File: kafka_cfg.py
# @Usage: cfg for kafka &amp; MySQL &amp; PostgreSQL


# Self Repo


# kafka configuration
kafka_cfg_dict = {
    &#39;bootstrap_servers&#39;: [&quot;10.72.8.30:9092&quot;, &quot;10.72.8.46:9092&quot;, &quot;10.72.8.38:9092&quot;],# &quot;10.72.8.46:9092&quot;,
    &#39;topic&#39;: &quot;PREDATA&quot;
}


kafka_cfg_dict_section2 = {
    &#39;bootstrap_servers&#39;: [&quot;10.72.8.30:9092&quot;, &quot;10.72.8.46:9092&quot;, &quot;10.72.8.38:9092&quot;],# &quot;10.72.8.30:9092&quot;,
    &#39;topic&#39;: &quot;PREDATA&quot;
}

kafka_cfg_dict_section3 = {
    &#39;bootstrap_servers&#39;: [&quot;10.72.8.30:9092&quot;, &quot;10.72.8.46:9092&quot;, &quot;10.72.8.38:9092&quot;],# &quot;10.72.8.38:9092&quot;,
    &#39;topic&#39;: &quot;PREDATA&quot;
}


###################################################################################################################
# postgres configuration
# mysql_conn = {
#     # oltp_mysql_matser = pymysql.connect(host=&#39;192.168.73.21&#39;, user=&#39;root&#39;, passwd=&#39;123456&#39;, db=&#39;MURA&#39;, port=3306)
#     &quot;host&quot;: &#39;192.168.73.21&#39;,
#     &quot;user&quot;: &quot;root&quot;,
#     &quot;password&quot;: &#39;123456&#39;,
#     &quot;database&quot;: &quot;MURA&quot;,
#     &quot;port&quot;: 3306
# }
#
# mysql_conn_pp = {
#     # oltp_mysql_matser = pymysql.connect(host=&#39;192.168.73.21&#39;, user=&#39;root&#39;, passwd=&#39;123456&#39;, db=&#39;MURA&#39;, port=3306)
#     &quot;host&quot;: &#39;192.168.62.74&#39;,
#     &quot;user&quot;: &quot;root&quot;,
#     &quot;password&quot;: &#39;Inspur*()890&#39;,
#     &quot;database&quot;: &quot;wrnop&quot;,
#     &quot;port&quot;: 5029
# }

# sqlmap_mysql = {
#     &quot;sql1&quot;: &quot;select * from MURA.t_pm_alarm_tst&quot;,
#     &quot;sql2&quot;: &quot;select count(1) from MURA.t_pm_alarm_tst&quot;,
# }
###################################################################################################################


sqlmap_pgsql_section2 = {
    &quot;v_alarm_06_0&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 0&quot;,
    &quot;v_alarm_06_1&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 1&quot;,
    &quot;v_alarm_06_2&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 2&quot;,
    &quot;v_alarm_06_3&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 3&quot;,
    &quot;v_alarm_06_4&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 4&quot;,
    &quot;v_alarm_06_5&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 5&quot;,
    &quot;v_alarm_06_6&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 6&quot;,
    &quot;v_alarm_06_7&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 7&quot;,
    &quot;v_alarm_06_8&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 8&quot;,
    &quot;v_alarm_06_9&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 9&quot;,
    #&quot;v_alarm_07_0&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_07_1&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_07_2&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_07_3&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_07_4&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_07_5&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_07_6&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_07_7&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_07_8&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_07_9&quot;: &quot;SELECT * FROM public.v_alarm_07 WHERE hash_value = 9&quot;,
}

sqlmap_pgsql = {
    &quot;v_alarm_13_0&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 0&quot;,
    &quot;v_alarm_13_1&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 1&quot;,
    &quot;v_alarm_13_2&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 2&quot;,
    &quot;v_alarm_13_3&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 3&quot;,
    &quot;v_alarm_13_4&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 4&quot;,
    &quot;v_alarm_13_5&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 5&quot;,
    &quot;v_alarm_13_6&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 6&quot;,
    &quot;v_alarm_13_7&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 7&quot;,
    &quot;v_alarm_13_8&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 8&quot;,
    &quot;v_alarm_13_9&quot;: &quot;SELECT * FROM public.m_v_alarm_13 WHERE hash_value = 9&quot;,
    &quot;v_alarm_14_0&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 0&quot;,
    &quot;v_alarm_14_1&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 1&quot;,
    &quot;v_alarm_14_2&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 2&quot;,
    &quot;v_alarm_14_3&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 3&quot;,
    &quot;v_alarm_14_4&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 4&quot;,
    &quot;v_alarm_14_5&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 5&quot;,
    &quot;v_alarm_14_6&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 6&quot;,
    &quot;v_alarm_14_7&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 7&quot;,
    &quot;v_alarm_14_8&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 8&quot;,
    &quot;v_alarm_14_9&quot;: &quot;SELECT * FROM public.m_v_alarm_14 WHERE hash_value = 9&quot;,
}

sqlmap_pgsql_section3 = {
    &quot;v_alarm_12_0&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 0&quot;,
    &quot;v_alarm_12_1&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 1&quot;,
    &quot;v_alarm_12_2&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 2&quot;,
    &quot;v_alarm_12_3&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 3&quot;,
    &quot;v_alarm_12_4&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 4&quot;,
    &quot;v_alarm_12_5&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 5&quot;,
    &quot;v_alarm_12_6&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 6&quot;,
    &quot;v_alarm_12_7&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 7&quot;,
    &quot;v_alarm_12_8&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 8&quot;,
    &quot;v_alarm_12_9&quot;: &quot;SELECT * FROM public.m_v_alarm_12 WHERE hash_value = 9&quot;,
    &quot;v_alarm_01_0&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 0&quot;,
    &quot;v_alarm_01_1&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 1&quot;,
    &quot;v_alarm_01_2&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 2&quot;,
    &quot;v_alarm_01_3&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 3&quot;,
    &quot;v_alarm_01_4&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 4&quot;,
    &quot;v_alarm_01_5&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 5&quot;,
    &quot;v_alarm_01_6&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 6&quot;,
    &quot;v_alarm_01_7&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 7&quot;,
    &quot;v_alarm_01_8&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 8&quot;,
    &quot;v_alarm_01_9&quot;: &quot;SELECT * FROM public.m_v_alarm_01 WHERE hash_value = 9&quot;,
}

sqlmap_pgsql1_2 = {
    &quot;v_alarm_04_0&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 0&quot;,
    &quot;v_alarm_04_1&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 1&quot;,
    &quot;v_alarm_04_2&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 2&quot;,
    &quot;v_alarm_04_3&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 3&quot;,
    &quot;v_alarm_04_4&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 4&quot;,
    &quot;v_alarm_04_5&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 5&quot;,
    &quot;v_alarm_04_6&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 6&quot;,
    &quot;v_alarm_04_7&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 7&quot;,
    &quot;v_alarm_04_8&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 8&quot;,
    &quot;v_alarm_04_9&quot;: &quot;SELECT * FROM public.m_v_alarm_04 WHERE hash_value = 9&quot;,
    &quot;v_alarm_05_0&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 0&quot;,
    &quot;v_alarm_05_1&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 1&quot;,
    &quot;v_alarm_05_2&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 2&quot;,
    &quot;v_alarm_05_3&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 3&quot;,
    &quot;v_alarm_05_4&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 4&quot;,
    &quot;v_alarm_05_5&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 5&quot;,
    &quot;v_alarm_05_6&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 6&quot;,
    &quot;v_alarm_05_7&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 7&quot;,
    &quot;v_alarm_05_8&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 8&quot;,
    &quot;v_alarm_05_9&quot;: &quot;SELECT * FROM public.m_v_alarm_05 WHERE hash_value = 9&quot;,
}

sqlmap_pgsql_section2_2 = {
    &quot;v_alarm_02_0&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 0&quot;,
    &quot;v_alarm_02_1&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 1&quot;,
    &quot;v_alarm_02_2&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 2&quot;,
    &quot;v_alarm_02_3&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 3&quot;,
    &quot;v_alarm_02_4&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 4&quot;,
    &quot;v_alarm_02_5&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 5&quot;,
    &quot;v_alarm_02_6&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 6&quot;,
    &quot;v_alarm_02_7&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 7&quot;,
    &quot;v_alarm_02_8&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 8&quot;,
    &quot;v_alarm_02_9&quot;: &quot;SELECT * FROM public.m_v_alarm_02 WHERE hash_value = 9&quot;,
    &quot;v_alarm_03_0&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 0&quot;,
    &quot;v_alarm_03_1&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 1&quot;,
    &quot;v_alarm_03_2&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 2&quot;,
    &quot;v_alarm_03_3&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 3&quot;,
    &quot;v_alarm_03_4&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 4&quot;,
    &quot;v_alarm_03_5&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 5&quot;,
    &quot;v_alarm_03_6&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 6&quot;,
    &quot;v_alarm_03_7&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 7&quot;,
    &quot;v_alarm_03_8&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 8&quot;,
    &quot;v_alarm_03_9&quot;: &quot;SELECT * FROM public.m_v_alarm_03 WHERE hash_value = 9&quot;,
}

sqlmap_pgsql_section3_2 = {
    &quot;v_alarm_20_0&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 0&quot;,
    &quot;v_alarm_20_1&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 1&quot;,
    &quot;v_alarm_20_2&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 2&quot;,
    &quot;v_alarm_20_3&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 3&quot;,
    &quot;v_alarm_20_4&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 4&quot;,
    &quot;v_alarm_20_5&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 5&quot;,
    &quot;v_alarm_20_6&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 6&quot;,
    &quot;v_alarm_20_7&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 7&quot;,
    &quot;v_alarm_20_8&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 8&quot;,
    &quot;v_alarm_20_9&quot;: &quot;SELECT * FROM public.m_v_alarm_20 WHERE hash_value = 9&quot;,
    &quot;v_alarm_21_0&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 0&quot;,
    &quot;v_alarm_21_1&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 1&quot;,
    &quot;v_alarm_21_2&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 2&quot;,
    &quot;v_alarm_21_3&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 3&quot;,
    &quot;v_alarm_21_4&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 4&quot;,
    &quot;v_alarm_21_5&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 5&quot;,
    &quot;v_alarm_21_6&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 6&quot;,
    &quot;v_alarm_21_7&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 7&quot;,
    &quot;v_alarm_21_8&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 8&quot;,
    &quot;v_alarm_21_9&quot;: &quot;SELECT * FROM public.m_v_alarm_21 WHERE hash_value = 9&quot;,
    &quot;v_alarm_07_0&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 0&quot;,
    &quot;v_alarm_07_1&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 1&quot;,
    &quot;v_alarm_07_2&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 2&quot;,
    &quot;v_alarm_07_3&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 3&quot;,
    &quot;v_alarm_07_4&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 4&quot;,
    &quot;v_alarm_07_5&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 5&quot;,
    &quot;v_alarm_07_6&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 6&quot;,
    &quot;v_alarm_07_7&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 7&quot;,
    &quot;v_alarm_07_8&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 8&quot;,
    &quot;v_alarm_07_9&quot;: &quot;SELECT * FROM public.m_v_alarm_07 WHERE hash_value = 9&quot;,
}


# 天级告警:8~11
sqlmap_pgsql_section4 = {
    #&quot;v_alarm_08_0&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_08_1&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_08_2&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_08_3&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_08_4&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_08_5&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_08_6&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_08_7&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_08_8&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_08_9&quot;: &quot;SELECT * FROM public.m_v_alarm_08 WHERE hash_value = 9&quot;,
    #&quot;v_alarm_09_0&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_09_1&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_09_2&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_09_3&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_09_4&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_09_5&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_09_6&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_09_7&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_09_8&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_09_9&quot;: &quot;SELECT * FROM public.m_v_alarm_09 WHERE hash_value = 9&quot;,
    #&quot;v_alarm_10_0&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_10_1&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_10_2&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_10_3&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_10_4&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_10_5&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_10_6&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_10_7&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_10_8&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_10_9&quot;: &quot;SELECT * FROM public.m_v_alarm_10 WHERE hash_value = 9&quot;
    #&quot;v_alarm_11_0&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_11_1&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_11_2&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_11_3&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_11_4&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_11_5&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_11_6&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_11_7&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_11_8&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_11_9&quot;: &quot;SELECT * FROM public.m_v_alarm_11 WHERE hash_value = 9&quot;,
}

sqlmap_pgsql_section_check = {
    &quot;v_alarm_06_0&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 0&quot;,
    &quot;v_alarm_06_1&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 1&quot;,
    &quot;v_alarm_06_2&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 2&quot;,
    &quot;v_alarm_06_3&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 3&quot;,
    &quot;v_alarm_06_4&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 4&quot;,
    &quot;v_alarm_06_5&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 5&quot;,
    &quot;v_alarm_06_6&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 6&quot;,
    &quot;v_alarm_06_7&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 7&quot;,
    &quot;v_alarm_06_8&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 8&quot;,
    &quot;v_alarm_06_9&quot;: &quot;SELECT * FROM public.m_v_alarm_06 WHERE hash_value = 9&quot;,
    #&quot;v_alarm_06_9&quot;: &quot;SELECT * FROM public.m_v_alarm_06&quot;,
}

# 天级告警:16~19
sqlmap_pgsql_section5 = {
    #&quot;v_alarm_16_0&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_16_1&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_16_2&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_16_3&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_16_4&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_16_5&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_16_6&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_16_7&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_16_8&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_16_9&quot;: &quot;SELECT * FROM public.m_v_alarm_16 WHERE hash_value = 9&quot;,
    #&quot;v_alarm_17_0&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_17_1&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_17_2&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_17_3&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_17_4&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_17_5&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_17_6&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_17_7&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_17_8&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_17_9&quot;: &quot;SELECT * FROM public.m_v_alarm_17 WHERE hash_value = 9&quot;,
    #&quot;v_alarm_18_0&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_18_1&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_18_2&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_18_3&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_18_4&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_18_5&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_18_6&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_18_7&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_18_8&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_18_9&quot;: &quot;SELECT * FROM public.m_v_alarm_18 WHERE hash_value = 9&quot;
    #&quot;v_alarm_19_0&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 0&quot;,
    #&quot;v_alarm_19_1&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 1&quot;,
    #&quot;v_alarm_19_2&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 2&quot;,
    #&quot;v_alarm_19_3&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 3&quot;,
    #&quot;v_alarm_19_4&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 4&quot;,
    #&quot;v_alarm_19_5&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 5&quot;,
    #&quot;v_alarm_19_6&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 6&quot;,
    #&quot;v_alarm_19_7&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 7&quot;,
    #&quot;v_alarm_19_8&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 8&quot;,
    #&quot;v_alarm_19_9&quot;: &quot;SELECT * FROM public.m_v_alarm_19 WHERE hash_value = 9&quot;,
}

#pgsql_conn_pp = {
#    &quot;host&quot;: &#39;10.73.8.28&#39;,
#    &quot;user&quot;: &quot;postgres&quot;,
#    &quot;password&quot;: &#39;1qaz)P(O&#39;,
#    &quot;database&quot;: &quot;postgres&quot;,
#    &quot;port&quot;: 5432
#}

pgsql_conn_prod = {
    &quot;host&quot;: &#39;10.72.8.50&#39;,
    &quot;user&quot;: &quot;postgres&quot;,
    &quot;password&quot;: &#39;xxxx&#39;,
    &quot;database&quot;: &quot;postgres&quot;,
    &quot;port&quot;: 5432
}


# sqlmap_pgsql = {
#     &quot;p_cna_hap_maint_user&quot;: &quot;CALL p_cna_hap_maint_user()&quot;,
#     # &quot;p_fm_app_exception_detail_info&quot;: &quot;CALL p_fm_app_exception_detail_info()&quot;,
#     # &quot;p_fm_server_performence_info&quot;: &quot;CALL p_fm_server_performence_info()&quot;,
#     # &quot;p_fm_server_runnning_info&quot;: &quot;CALL p_fm_server_runnning_info()&quot;,
#     # &quot;p_fm_system_general_info&quot;: &quot;CALL p_fm_system_general_info()&quot;
# }

if __name__ == &#39;__main__&#39;:
    # partition_lst = [k for k in sqlmap_pgsql_section3_2.keys()]
    # print(len(partition_lst))
    pass</code></pre>
<ul>
<li>main_kafka_section2.py</li>
</ul>
<pre><code class="python"># -*- coding:utf-8 -*-
# @Author: Shinnosuke
# @Date: 20/5/12 16:32
# @File: main_kafka_section2.py
# @Usage: main_kafka_section2


import json
import psycopg2 as pg
from time import ctime, time
from multiprocessing.dummy import Pool as ThreadPool
from tqdm import tqdm

# Self Repo
# from src.class_Kafka_producer_linux_section2 import *
# from src.cfg import kafka_cfg as cfg

from class_Kafka_producer_linux_section2 import *
from cfg import kafka_cfg as cfg
from func_demo.func_f import date_f


# global balance

def lock_f(lock_flag=&#39;N&#39;):
    def threading_f(f):
        def inner_f(*value):
            clog2.logger.warning(f&#39;decorator job begin!&#39;)
            if lock_flag == &#39;Y&#39;:
                # i += 1
                lock = threading.RLock()
                with lock:
                    # r_lock.acquire()
                    clog2.logger.info(f&#39;Thread {threading.current_thread().getName()} is running. Time: {ctime()}&#39;)
                    dt_start = int(time())
                    result = f(*value)
                    # print(type(results))    # &lt;class &#39;tuple&#39;&gt;
                    # balance.append(result)
                    # r_lock.release()
                    clog2.logger.info(f&#39;Thread {threading.current_thread().getName()} end. Time: {ctime()}&#39;)
                    clog2.logger.warning(f&#39;job: &lt;{result}&gt; closed. time consume：{int(time()) - dt_start}s.\n&#39;)
            else:
                clog2.logger.warning(f&#39;decorator job not chosen&#39;)
                clog2.logger.info(f&#39;Thread {threading.current_thread().getName()} is running. Time: {ctime()}&#39;)
                f(*value)
                # balance.append(result)
                clog2.logger.info(f&#39;Thread {threading.current_thread().getName()} end. Time: {ctime()}&#39;)
            # return balance
        return inner_f
    return threading_f

@lock_f(&#39;Y&#39;)  # RLock
def kafka_job(sql, pg_connect_dict=cfg.pgsql_conn_prod, kafka_cfg_dict=cfg.kafka_cfg_dict_section2):
    global oltp_pgsql_master
    sql_return = sql
    # global cursor
    try:
        # PostgreSQL结果转json
        # step2 PostgreSQL execute
        oltp_pgsql_master = pg.connect(
            host=pg_connect_dict[&quot;host&quot;], user=pg_connect_dict[&quot;user&quot;],
            password=pg_connect_dict[&quot;password&quot;], database=pg_connect_dict[&quot;database&quot;],
            port=pg_connect_dict[&quot;port&quot;]
        )

        # clog2.logger.warning(f&#39;PostgreSQL Begin...&#39;)
        cursor = oltp_pgsql_master.cursor()
        cursor.execute(sql)

        # 可分批，不知是否合理
        # rows = cursor2.fetchone()
        rowcnt = cursor.rowcount
        clog2.logger.info(f&#39;Total rows for current execution &lt;{sql}&gt;: {rowcnt}&#39;)
        execute_result = cursor.fetchmany(rowcnt)    # &lt;class &#39;tuple&#39;&gt;
        #cursor.close()
        #oltp_pgsql_master.close()
        # clog2.logger.warning(f&#39;PostgreSQL End: {oltp_pgsql_master}&#39;)

        # step3 Kafka json
        clog2.logger.warning(f&#39;Kafka Python Begin...&#39;)
        prod = KafkaProducerPython(
            topic=kafka_cfg_dict[&#39;topic&#39;],
            bootstrap_servers=kafka_cfg_dict[&#39;bootstrap_servers&#39;]
        )

        dict2byte_jsonlist = []     # dict ---&gt; json ---&gt; byte ---&gt; list.append
        # i = 0
        for rn in execute_result:
            pgsql_dict = {}
            pgsql_dict[&quot;res_type&quot;] = str(rn[0])
            pgsql_dict[&quot;res_key&quot;] = rn[1]
            pgsql_dict[&quot;kpi_id&quot;] = rn[2]
            pgsql_dict[&quot;time&quot;] = str(rn[3])
            pgsql_dict[&quot;value&quot;] = str(rn[4])
            pgsql_dict[&quot;vendor&quot;] = rn[5]
            pgsql_dict[&quot;specialty&quot;] = rn[6]
            pgsql_dict[&quot;province&quot;] = str(rn[7])
            pgsql_dict[&quot;city&quot;] = str(rn[8])
            # pgsql_dict[&quot;value_1&quot;] = str(rn[9])
            # pgsql_dict[&quot;clear&quot;] = str(rn[10])


            # dict append
            # dict ---&gt; json ---&gt; byte ---&gt; list.append
            # json序列化时关闭中文的ascii编码
            dict2byte_jsonlist.append(prod.to_bytes(json.dumps([pgsql_dict], ensure_ascii=False)))
            # clog2.logger.info(f&#39;sql: {sql}, pgsql_dict: {pgsql_dict}&#39;)
            # if i == 0:
            #     current_dt = rn[3]
            #     i += 1
        # clog2.logger.info(f&#39;dt for current round: {current_dt}&#39;)


        # clog2.logger.info(f&#39;round time: {}&#39;)
        # step4 Kakfa sender
        #pbar = tqdm(dict2byte_jsonlist, ncols=200)
        #for rb in pbar:
        #    prod.producer_send(rb)
        #    # pbar.set_description(f&#39;{json.loads(bytes.decode(rb))[0][&quot;kpi_id&quot;]}: {json.loads(bytes.decode(rb))[0][&quot;res_key&quot;]}&#39;)
        #    pbar.set_description(f&#39;{sql_return}: {json.loads(bytes.decode(rb))[0][&quot;res_key&quot;]}&#39;)

        for rb in dict2byte_jsonlist:
            prod.producer_send(rb).add_callback(prod.producer_send_callback)
            rj = json.loads(rb)[0]
            # print(rj)
            tmp = {}
            tmp[&quot;res_key&quot;] = rj[&quot;res_key&quot;]
            tmp[&quot;kpi_id&quot;] = rj[&quot;kpi_id&quot;]
            tmp[&quot;dt&quot;] = rj[&quot;time&quot;]
            prod.producer_send_log(tmp)
        clog2.logger.warning(f&#39;Kafka Python End...&#39;)

        # # dict ---&gt; json ---&gt; bytes
        # # Chinese in Consumer need to be decoded  # ××××××
        # for rj in mysql_dict_list_2:
        #     rj_json2bytes = json.dumps(rj).encode(&#39;utf-8&#39;)
        #     prod.producer_send(rj_json2bytes).add_callback(prod.producer_send_callback)
        #     print(f&#39;rj: {rj} {type(rj)}\n&#39;)
    except Exception as e:
        # cursor.close()
        errclog2.logger.error(f&#39;{e}&#39;)
    finally:
    #    # oltp_pgsql_master.close()
        return sql_return


@lock_f(&#39;Y&#39;)  # RLock
def threading_job():
    # threads initial
    threads = []
    for rv in cfg.sqlmap_pgsql_section2.values():
        t = MyThread(kafka_job, (rv, cfg.pgsql_conn_prod, cfg.kafka_cfg_dict))
        # clog2.logger.info(f&#39;Current sql: {rv}&#39;)
        threads.append(t)

    # 线程批量启动
    # rt = None
    for rt in threads:
        rt.start()
        clog2.logger.warning(f&#39;PostgreSQL Begin: {rt}&#39;)

        # rt.join()
    for rt in threads:
        rt.join()
        # clog2.logger.warning(f&#39;PostgreSQL join: {rt}&#39;)


if __name__ == &#39;__main__&#39;:
    cutline = &#39;--------------------------------------------------------------&#39;
    clog2.logger.info(cutline)
    # Make the Pool of workers
    partition_lst = [v for v in cfg.sqlmap_pgsql_section2.values()]
    pool = ThreadPool(len(partition_lst))
    # print(partition_lst, len(partition_lst))
    # Open the urls in their own threads and return the results
    results = pool.map(kafka_job, partition_lst)
    # close the pool and wait for the work to finish
    pool.close()
    pool.join()
    clog2.logger.info(f&#39;{cutline}\n&#39;)</code></pre>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/Kafka%20Python3%20PG">Kafka Python3 PG</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;TOC</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
      <br><br>
      
      

    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    


    <!-- cnzz Analytics icon -->
    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  <!-- cnzz Analytics -->
  



  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "20200323_1205_Python3-Kafka-Producer&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>











</body>
</html>
