<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     Shinnosuke
  </title>
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/css/style.css">
  
<script src="/js/pace.min.js"></script>


  

  

<meta name="generator" content="Hexo 4.1.1"></head>

</html>

<body>
  <div id="app">
    <main class="content">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/shinnosuke1028"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/index.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">Shinnosuke</a></h1>
      <h2>吃宵夜(1/1)</h2>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="#main" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>

<div id="main">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>

    
    
    <article id="post-20191225-1309-Python3-FTP-list" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/26/20191225-1309-Python3-FTP-list/"
    >20191226_1309_Python3-FTP-list</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/26/20191225-1309-Python3-FTP-list/" class="article-date">
  <time datetime="2019-12-26T05:09:45.000Z" itemprop="datePublished">2019-12-26</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Python3-FTP-List-Gather"><a href="#Python3-FTP-List-Gather" class="headerlink" title="Python3 FTP_List_Gather"></a>Python3 FTP_List_Gather</h2><h3 id="01-服务器数据清单采集（暂时不含可视化部分）"><a href="#01-服务器数据清单采集（暂时不含可视化部分）" class="headerlink" title="01. 服务器数据清单采集（暂时不含可视化部分）"></a>01. 服务器数据清单采集（暂时不含可视化部分）</h3><ul>
<li>Repo Point<br>  ftplib, os, socket, re<br>  Oracle2File.FileWR（class_email_daily3.py）<br>  func_demo.func_f.date_f</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tree ftp_monitor/src -L 2</span></span><br><span class="line">$ tree src -L 3</span><br><span class="line">src</span><br><span class="line">|-- __init__.py</span><br><span class="line">|-- __pycache__</span><br><span class="line">|   `-- __init__.cpython-37.pyc</span><br><span class="line">|-- conf</span><br><span class="line">|   |-- __init__.py</span><br><span class="line">|   `-- ftp_conf_bak.py</span><br><span class="line">|-- data</span><br><span class="line">|-- data_output</span><br><span class="line">|   `-- __init__.py</span><br><span class="line">|-- ftp_wc.py</span><br><span class="line">|-- func_demo</span><br><span class="line">|   |-- Oracle2File.py</span><br><span class="line">|   |-- __init__.py</span><br><span class="line">|   |-- __pycache__</span><br><span class="line">|   |-- func_f.py</span><br><span class="line">|   `-- os_f.py</span><br><span class="line">`-- main.py</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Shin</span></span><br><span class="line"><span class="comment"># @Date: 2019/12/5 11:48</span></span><br><span class="line"><span class="comment"># @File: main.py</span></span><br><span class="line"><span class="comment"># @Usage: Main</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> src.ftp_wc <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> src.func_demo.os_f <span class="keyword">import</span> file_create</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 测试用文件&amp;文件夹生成，生产环境无需部署以下两步</span></span><br><span class="line">    <span class="comment"># file_create(d_path, 0, d_name)</span></span><br><span class="line">    <span class="comment"># file_create(f_path, 1, *file_name_list)</span></span><br><span class="line"></span><br><span class="line">    ftp_result = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> rn_dict <span class="keyword">in</span> ftp_ip_dict.keys():</span><br><span class="line">            <span class="comment"># 测试Limit</span></span><br><span class="line">            <span class="keyword">if</span> rn_dict == <span class="string">'NSN_CM'</span>:</span><br><span class="line">                <span class="comment"># pprint.pprint(ftp_ip_dict[rs])</span></span><br><span class="line">                print(<span class="string">f'<span class="subst">&#123;rn_dict&#125;</span>: <span class="subst">&#123;ftp_ip_dict[rn_dict]&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> rs <span class="keyword">in</span> ftp_ip_dict[rn_dict]:</span><br><span class="line">                    <span class="comment"># print(rs)  # &lt;class 'dict'&gt;</span></span><br><span class="line">                    <span class="comment"># 这里后续可以引入多线程，同时统计当前采集服务器上的对应的所有IP</span></span><br><span class="line">                    ftp = ftp_connect(host=rs[<span class="string">'host'</span>], port=rs[<span class="string">'port'</span>], usr=rs[<span class="string">'usr'</span>], passwd=rs[<span class="string">'passwd'</span>])</span><br><span class="line">                    <span class="keyword">if</span> ftp == <span class="number">1</span>:</span><br><span class="line">                        <span class="comment"># print(f'FinishStatus: User &#123;rs["usr"]&#125; Exception!', '\n'*2)</span></span><br><span class="line">                        print(<span class="string">f'FinishStatus: Connect Exception!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        remote_path = rs[<span class="string">'remotePath'</span>]</span><br><span class="line">                        <span class="comment"># print(f'已配置的远程路径: &#123;remote_path&#125;')</span></span><br><span class="line">                        ftp_reply = ftp_nlst(ftp, remote_path=remote_path, re_pattern=rs[<span class="string">'re_pattern'</span>]) <span class="comment"># &lt;class 'list'&gt;</span></span><br><span class="line">                        <span class="keyword">if</span> ftp_reply == <span class="number">1</span>:</span><br><span class="line">                            print(<span class="string">f'FinishStatus: NLST Exception!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="comment"># print(type(ftp_reply))</span></span><br><span class="line">                            ftp_reply.insert(<span class="number">0</span>, rn_dict)</span><br><span class="line">                            print(<span class="string">f'ftp_reply: <span class="subst">&#123;ftp_reply&#125;</span>'</span>)</span><br><span class="line">                            ftp_result.extend([ftp_reply])</span><br><span class="line">                            print(<span class="string">f'FinishStatus: Succeed!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> (KeyError, Exception) <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">f'FinishStatus: Exception!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清单采集</span></span><br><span class="line">    <span class="comment"># 这里可以引入多线程，同时统计多个服务器上的采集清单</span></span><br><span class="line">    ftp_nlst_write(ftp_result, local_path=file_nlst_path, file_flag=fileDict[<span class="string">'NSN_CM'</span>][<span class="string">'flag'</span>], file_title=fileDict[<span class="string">'NSN_CM'</span>][<span class="string">'title'</span>])</span><br><span class="line">    print(<span class="string">f'Final List Status: \n<span class="subst">&#123;ftp_result&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清单处理</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 暂停</span></span><br><span class="line">    <span class="comment"># input_word = input('Input any key to quit: ')</span></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Shin</span></span><br><span class="line"><span class="comment"># @Date: 2019/12/5 11:13</span></span><br><span class="line"><span class="comment"># @File: ftp_wc.py</span></span><br><span class="line"><span class="comment"># @Usage: Generation for Remote FTP List</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ftplib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment"># import sys</span></span><br><span class="line"><span class="comment"># import csv</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Self Repo</span></span><br><span class="line"><span class="comment"># from src.func_demo.func_f import date_f</span></span><br><span class="line"><span class="keyword">from</span> src.conf.ftp_conf_bak <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> src.func_demo.Oracle2File <span class="keyword">import</span> FileWR</span><br><span class="line"><span class="comment"># from src.ftp_wc import *</span></span><br><span class="line"><span class="keyword">from</span> src.func_demo.os_f <span class="keyword">import</span> file_create</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ftp_connect</span><span class="params">(host, usr, passwd, port=<span class="number">21</span>, timeout=<span class="number">5</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param host: remote FTP address</span></span><br><span class="line"><span class="string">    :param usr: username for FTP</span></span><br><span class="line"><span class="string">    :param passwd: password</span></span><br><span class="line"><span class="string">    :param port: port &lt;int&gt;</span></span><br><span class="line"><span class="string">    :param timeout: the timeout to set against the ftp socket(s)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return: &lt;class 'ftplib.FTP'&gt; or 1&lt;num&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Ex: ftp = ftp_connect(host=rs['host'], port=rs['port'], usr=rs['usr'], passwd=rs['passwd'])</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(<span class="string">f'Current Connection Info: <span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span>/<span class="subst">&#123;usr&#125;</span>'</span>)</span><br><span class="line">        ftp = ftplib.FTP()</span><br><span class="line">        <span class="comment"># ftp.encoding = 'utf-8'</span></span><br><span class="line">        <span class="comment"># print(type(ftp))</span></span><br><span class="line">        ftp.connect(host, port, timeout)</span><br><span class="line">    <span class="keyword">except</span> socket.timeout <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Status: Timed out during connection.'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="comment"># raise OSError('FTP connect timed out!')</span></span><br><span class="line">    <span class="keyword">except</span> ConnectionRefusedError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Status: Login failed. Please check whether the remote address is normal.'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span>*<span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span>*<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        ftp.set_debuglevel(<span class="number">0</span>)  <span class="comment"># 打开调试级别2，显示详细信息</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            ftp.login(usr, passwd)</span><br><span class="line">            print(<span class="string">f'***Welcome Infomation: <span class="subst">&#123;ftp.welcome&#125;</span>***'</span>)  <span class="comment"># 打印出欢迎信息</span></span><br><span class="line">            print(<span class="string">f'Status: FTP User &lt;<span class="subst">&#123;usr&#125;</span>&gt; has connected to &lt;<span class="subst">&#123;host&#125;</span> <span class="subst">&#123;port&#125;</span>&gt;.'</span>)</span><br><span class="line">            <span class="keyword">return</span> ftp</span><br><span class="line">        <span class="keyword">except</span> ftplib.error_perm <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Status: Login failed. Please check whether the login information is correct.'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span>*<span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span>*<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span> socket.timeout <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Status: Time out during login.'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span>*<span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;str(e).title()&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span>*<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ftp_nlst</span><span class="params">(ftp, remote_path, re_pattern)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param ftp:         &lt;class 'ftplib.FTP'&gt;</span></span><br><span class="line"><span class="string">    :param remote_path: FTP file path</span></span><br><span class="line"><span class="string">    :param re_pattern:     RE: Regular expression</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return: &lt;class 'list'&gt; or Error 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Ex: ftp_reply = ftp_nlst(ftp, remote_path=remote_path, re_pattern=f'.*.&#123;y&#125;&#123;m&#125;&#123;d&#125;.*.csv$')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ftp = ftplib.FTP()</span></span><br><span class="line">    print(<span class="string">f'***NLST***'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Local Path</span></span><br><span class="line">    print(<span class="string">f'--Local script path: <span class="subst">&#123;os.getcwd()&#125;</span>'</span>)</span><br><span class="line">    <span class="comment"># Remote Path</span></span><br><span class="line">    print(<span class="string">f'--Remote path: <span class="subst">&#123;remote_path&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        n_lst_decode = []</span><br><span class="line">        ftp.cwd(remote_path)</span><br><span class="line">        <span class="comment"># ftp.dir() # &lt;class 'NoneType'&gt;</span></span><br><span class="line">        <span class="comment"># print(f'ftp_dir: &#123;type(ftp_dir)&#125;')</span></span><br><span class="line">        cur = ftp.pwd()</span><br><span class="line">        print(<span class="string">f'Status: Successfully change dirName into <span class="subst">&#123;cur&#125;</span>.'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            n_lst = ftp.nlst()  <span class="comment"># &lt;class 'list'&gt;</span></span><br><span class="line">            <span class="keyword">for</span> rs <span class="keyword">in</span> n_lst:</span><br><span class="line">                n_lst_decode.append(rs.encode(<span class="string">'iso-8859-1'</span>).decode(<span class="string">'gbk'</span>))  <span class="comment"># 解决Python3中文乱码  latin-1 ---&gt; gbk/gb2312</span></span><br><span class="line">            print(n_lst_decode)</span><br><span class="line">            <span class="comment"># ftp.retrlines(cmd='LIST', &lt;function&gt;)</span></span><br><span class="line">            match_result = re_match(list_input=n_lst_decode, re_pattern=re_pattern)</span><br><span class="line">            <span class="keyword">return</span> match_result</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Status: Failed to obtain the file lists!'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> ftplib.all_errors <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Status: Path switching failed!'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        ftp.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_match</span><span class="params">(list_input, re_pattern)</span>:</span></span><br><span class="line">    print(<span class="string">f'***RE***'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># # 1</span></span><br><span class="line">        <span class="comment">#     match_result = [rs for rs in list_input if re.match(re_pattern, rs)]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># # 2</span></span><br><span class="line">        <span class="comment">#     match_result = []</span></span><br><span class="line">        <span class="comment">#     for rs in list_input:</span></span><br><span class="line">        <span class="comment">#         if re.match(re_pattern, rs):</span></span><br><span class="line">        <span class="comment">#             match_result.append(rs)</span></span><br><span class="line">        <span class="comment">#             print(f'Status: File match successfully. Filename: &#123;rs&#125;')</span></span><br><span class="line">        <span class="comment">#         else:</span></span><br><span class="line">        <span class="comment">#             # print(f'Match failed. Filename: &#123;rs&#125;')</span></span><br><span class="line">        <span class="comment">#             print(f'Match failed.')</span></span><br><span class="line">        <span class="comment">#     print(match_result)</span></span><br><span class="line">        <span class="comment">#     return match_result</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3</span></span><br><span class="line">        <span class="comment">#     match_result = []</span></span><br><span class="line">        <span class="comment">#     p = re.compile(re_pattern)</span></span><br><span class="line">        <span class="comment">#     for rs in list_input:</span></span><br><span class="line">        <span class="comment">#         if p.findall(rs):</span></span><br><span class="line">        <span class="comment">#             match_result.append(rs)</span></span><br><span class="line">        <span class="comment">#             print(rs)</span></span><br><span class="line"></span><br><span class="line">        p = re.compile(re_pattern)</span><br><span class="line">        match_result = [ rs <span class="keyword">for</span> rs <span class="keyword">in</span> list_input <span class="keyword">if</span> p.findall(rs)]  <span class="comment"># 别忘了，findall返回的是 &lt;class 'list'&gt;</span></span><br><span class="line">        <span class="comment"># print(match_result)</span></span><br><span class="line">        <span class="keyword">return</span> match_result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Status: RE failed!'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ftp_nlst_write</span><span class="params">(message_date, local_path, file_flag, file_title)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param message_date: list input</span></span><br><span class="line"><span class="string">    :param local_path:  local file path for out-put</span></span><br><span class="line"><span class="string">    :param file_flag:   hint to distinguish between different flag_lists</span></span><br><span class="line"><span class="string">    :param file_title:  file title</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return file_title  &lt;class 'list'&gt; or 1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    print(<span class="string">f'***NLST_WRITE***'</span>)</span><br><span class="line">    <span class="comment"># 清单</span></span><br><span class="line">    <span class="comment"># local_path = file_nlst_path</span></span><br><span class="line">    <span class="comment"># file_title = 'LOCAL'    # fileDict['LOCAL']['title']</span></span><br><span class="line">    <span class="comment"># file_flag = fileDict['HW_CM']['flag']</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file = FileWR(local_file_path=local_path, title=file_title)</span><br><span class="line">        file.file_write_f(message_date=message_date, job_flag=file_flag)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方法2:</span></span><br><span class="line">    <span class="comment"># try:</span></span><br><span class="line">    <span class="comment">#     with open(output_file, 'w', newline='', encoding='UTF-8') as file_1:</span></span><br><span class="line">    <span class="comment">#         writer_csv = csv.writer(file_1)</span></span><br><span class="line">    <span class="comment">#         writer_csv.writerow([file_title])</span></span><br><span class="line">    <span class="comment">#         for row in n_lst:</span></span><br><span class="line">    <span class="comment">#             writer_csv.writerow([row])  # csv提供的写入方法可以按行写入list，无需按照对象一个个写入，效率更高</span></span><br><span class="line">    <span class="comment">#         # writer_csv.writerows([n_lst])</span></span><br><span class="line">    <span class="comment">#     return 0</span></span><br><span class="line">    <span class="comment"># except Exception as e:</span></span><br><span class="line">    <span class="comment">#     print('Status: 文件写入失败!')</span></span><br><span class="line">    <span class="comment">#     print('------------------' * 2, f'\nError Details:\n&#123;e&#125;')</span></span><br><span class="line">    <span class="comment">#     print('------------------' * 2)</span></span><br><span class="line">    <span class="comment">#     return 1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> (IOError, OSError, Exception) <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Status: File write error!'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_job</span><span class="params">(key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param key: 采集标签，标签用来区分清单采集的内容和厂家</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ftp_result = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> rn_dict <span class="keyword">in</span> ftp_ip_dict.keys():</span><br><span class="line">            <span class="comment"># 测试Limit</span></span><br><span class="line">            <span class="keyword">if</span> rn_dict == key:<span class="comment"># 'NSN_CM':</span></span><br><span class="line">                <span class="comment"># pprint.pprint(ftp_ip_dict[rs])</span></span><br><span class="line">                print(<span class="string">f'<span class="subst">&#123;rn_dict&#125;</span>: <span class="subst">&#123;ftp_ip_dict[rn_dict]&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> rs <span class="keyword">in</span> ftp_ip_dict[rn_dict]:</span><br><span class="line">                    <span class="comment"># print(rs)  # &lt;class 'dict'&gt;</span></span><br><span class="line">                    <span class="comment"># 这里后续可以引入多线程，同时统计当前采集服务器上的对应的所有IP</span></span><br><span class="line">                    ftp = ftp_connect(host=rs[<span class="string">'host'</span>], port=rs[<span class="string">'port'</span>], usr=rs[<span class="string">'usr'</span>], passwd=rs[<span class="string">'passwd'</span>])</span><br><span class="line">                    <span class="keyword">if</span> ftp == <span class="number">1</span>:</span><br><span class="line">                        <span class="comment"># print(f'FinishStatus: User &#123;rs["usr"]&#125; Exception!', '\n'*2)</span></span><br><span class="line">                        print(<span class="string">f'FinishStatus: Connect Exception!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        remote_path = rs[<span class="string">'remotePath'</span>]</span><br><span class="line">                        <span class="comment"># print(f'已配置的远程路径: &#123;remote_path&#125;')</span></span><br><span class="line">                        ftp_reply = ftp_nlst(ftp, remote_path=remote_path, re_pattern=rs[<span class="string">'re_pattern'</span>]) <span class="comment"># &lt;class 'list'&gt;</span></span><br><span class="line">                        <span class="keyword">if</span> ftp_reply == <span class="number">1</span>:</span><br><span class="line">                            print(<span class="string">f'FinishStatus: NLST Exception!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="comment"># print(type(ftp_reply))</span></span><br><span class="line">                            ftp_reply.insert(<span class="number">0</span>, rn_dict)</span><br><span class="line">                            print(<span class="string">f'ftp_reply: <span class="subst">&#123;ftp_reply&#125;</span>'</span>)</span><br><span class="line">                            ftp_result.extend([ftp_reply])</span><br><span class="line">                            print(<span class="string">f'FinishStatus: Succeed!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> (KeyError, Exception) <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">f'FinishStatus: Exception!'</span>, <span class="string">'\n'</span> * <span class="number">2</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 20191225-Demo1</span></span><br><span class="line">    <span class="comment">#     for rs in ftp_ip_dict:</span></span><br><span class="line">    <span class="comment">#         # print(rs)</span></span><br><span class="line">    <span class="comment">#         ftp = ftp_connect(host=rs['host'], port=rs['port'], usr=rs['usr'], passwd=rs['passwd'])</span></span><br><span class="line">    <span class="comment">#         if ftp == 1:</span></span><br><span class="line">    <span class="comment">#             # print(f'FinishStatus: User &#123;rs["usr"]&#125; Exception!', '\n'*2)</span></span><br><span class="line">    <span class="comment">#             print(f'FinishStatus: Connect Exception!', '\n'*2)</span></span><br><span class="line">    <span class="comment">#         else:</span></span><br><span class="line">    <span class="comment">#             remote_path = rs['remotePath']</span></span><br><span class="line">    <span class="comment">#             # print(f'已配置的远程路径: &#123;remote_path&#125;')</span></span><br><span class="line">    <span class="comment">#             ftp_reply = ftp_nlst(ftp, remote_path=remote_path, re_pattern=rs['re_rule'])</span></span><br><span class="line">    <span class="comment">#             if ftp_reply == 1:</span></span><br><span class="line">    <span class="comment">#                 print(f'FinishStatus: NLST Exception!', '\n' * 2)</span></span><br><span class="line">    <span class="comment">#             else:</span></span><br><span class="line">    <span class="comment">#                 # print(ftp_reply)</span></span><br><span class="line">    <span class="comment">#                 ftp_result.extend(ftp_reply)</span></span><br><span class="line">    <span class="comment">#                 print(f'FinishStatus: Succeed!', '\n' * 2)</span></span><br><span class="line">    <span class="comment">#                 # try:</span></span><br><span class="line">    <span class="comment">#                 #     ftp_result.extend(ftp_reply)</span></span><br><span class="line">    <span class="comment">#                 #     print(f'FinishStatus: Succeed!', '\n' * 2)</span></span><br><span class="line">    <span class="comment">#                 #     # ftp.quit() # 获取返回值后关闭服务</span></span><br><span class="line">    <span class="comment">#                 #</span></span><br><span class="line">    <span class="comment">#                 # except Exception as e:</span></span><br><span class="line">    <span class="comment">#                 #     print(f'FinishStatus: Exception!', '\n' * 2)</span></span><br><span class="line">    <span class="comment">#                 #     print('------------------' * 2, f'\nError Details:\n&#123;e&#125;')</span></span><br><span class="line">    <span class="comment">#                 #     print('------------------' * 2)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># except Exception as e:</span></span><br><span class="line">    <span class="comment">#     print(f'FinishStatus: Exception!', '\n' * 2)</span></span><br><span class="line">    <span class="comment">#     print('------------------' * 2, f'\nError Details:\n&#123;e&#125;')</span></span><br><span class="line">    <span class="comment">#     print('------------------' * 2)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(type(ftp))</span></span><br><span class="line">    <span class="comment"># ftp.quit()</span></span><br><span class="line">    <span class="comment"># re_match(ftp_result, ftp_ip_dict[0]['re_rule'])</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清单采集</span></span><br><span class="line">    <span class="comment"># 这里可以引入多线程，同时统计多个服务器上的采集清单</span></span><br><span class="line">    ftp_nlst_write(ftp_result, local_path=file_nlst_path, file_flag=fileDict[<span class="string">'NSN_CM'</span>][<span class="string">'flag'</span>], file_title=fileDict[<span class="string">'NSN_CM'</span>][<span class="string">'title'</span>])</span><br><span class="line">    print(<span class="string">f'Final List Status: \n<span class="subst">&#123;ftp_result&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># if __name__ == '__main__':</span></span><br><span class="line">    <span class="comment"># pass</span></span><br></pre></td></tr></table></figure>


      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/26/20191225-1309-Python3-FTP-list/" data-id="ck4mw85ko000kawu6c7bf1t4z"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python3/" rel="tag">Python3</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191219-2254-Hive-1-x" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/24/20191219-2254-Hive-1-x/"
    >20191224-1414_Hive-1.x</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/24/20191219-2254-Hive-1-x/" class="article-date">
  <time datetime="2019-12-24T06:14:20.000Z" itemprop="datePublished">2019-12-24</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Hive-配置"><a href="#Hive-配置" class="headerlink" title="Hive 配置"></a>Hive 配置</h2><h3 id="01-Hive-1-x"><a href="#01-Hive-1-x" class="headerlink" title="01. Hive 1.x"></a>01. Hive 1.x</h3><ul>
<li>Repo Point<br><a href="http://mirror.bit.edu.cn/apache/hive/hive-1.2.2/apache-hive-1.2.2-bin.tar.gz" target="_blank" rel="noopener">apache-hive-1.2.2-bin.tar.gz</a><br><a href="https://downloads.mysql.com/archives/get/file/mysql-connector-java-5.1.44.tar.gz" target="_blank" rel="noopener">mysql-connector-java-5.1.44.tar</a></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-环境包"><a href="#1-环境包" class="headerlink" title="1. 环境包"></a>1. 环境包</h4><h5 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h5><p><code>Tips</code> 记得安装JDBC连接器mysql-connector-java-5.1.44-bin.jar，并将Hive和Hadoop侧的jline版本同步！！！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压并拷贝MySQL-jdbc的jar包至 $Hive/libs下：</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">tar -zxvf mysql-connector-java-5.1.44.tar</span><br><span class="line">cp /usr/<span class="built_in">local</span>/src/mysql-connector-java-5.1.44/mysql-connector-java-5.1.44-bin.jar <span class="variable">$HIVE_HOME</span>/lib/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入yarn下的lib查看Hadoop-2.6.1自带的jline版本：</span></span><br><span class="line">ll <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/*jline*</span><br><span class="line"><span class="comment">#发现Jjline版本过低：jline-0.9.94.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入Hive下的lib查看Hive-1.2.2自带的jline版本：</span></span><br><span class="line">ll <span class="variable">$HIVE_HOME</span>/lib/*jline*</span><br><span class="line"><span class="comment"># jline-2.12.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份Hadoop侧的jline，用Hive侧的jline替代：</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br><span class="line">mv jline-0.9.94.jar jline-0.9.94.jar.old</span><br><span class="line"></span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/lib/jline-2.12.jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br><span class="line"><span class="comment"># 替换后检查</span></span><br><span class="line">ll <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/jline*</span><br></pre></td></tr></table></figure>

<h5 id="配置文件修改-amp-相关文件夹创建"><a href="#配置文件修改-amp-相关文件夹创建" class="headerlink" title="配置文件修改&amp;相关文件夹创建"></a>配置文件修改&amp;相关文件夹创建</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对应创建Hive配置文件中配置的文件夹：</span></span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/warehouse</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/tmp</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户环境变量，添加Hive路径：</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># ~/.bashrc</span></span><br><span class="line"><span class="comment"># SET JAVA PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># SET HADOOP PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET HIVE PATH</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SCALA PATH</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET INI PATH</span></span><br><span class="line"><span class="built_in">export</span> INI_PATH=/usr/<span class="built_in">local</span>/src</span><br><span class="line"><span class="comment"># SET SPARK PATH</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hive log位置配置</span></span><br><span class="line">mv hive-log4j.properties.template hive-log4j.propertie</span><br><span class="line"><span class="comment"># Hive exec-log位置配置(貌似没有任务执行日志生成？？？)</span></span><br><span class="line">mv hive-exec-log4j.properties.template hive-exec-log4j.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加JDK/Hadoop/Hive家目录/Hive配置文件路径 </span></span><br><span class="line">cp hive-env.sh.template hive-env.sh</span><br><span class="line"><span class="comment"># hive-env.sh</span></span><br><span class="line"><span class="comment"># Folder containing extra ibraries required for hive compilation/execution can be controlled by:</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> HIVE_CONF_DIR=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/conf</span><br><span class="line"><span class="comment">######</span></span><br></pre></td></tr></table></figure>

<h5 id="Hive配置的文件需要手动新建，修改MySQL连接信息-amp-更新多组文件夹路径"><a href="#Hive配置的文件需要手动新建，修改MySQL连接信息-amp-更新多组文件夹路径" class="headerlink" title="Hive配置的文件需要手动新建，修改MySQL连接信息&amp;更新多组文件夹路径"></a>Hive配置的文件需要手动新建，修改MySQL连接信息&amp;更新多组文件夹路径</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">touch hive-site.xml </span><br><span class="line"><span class="comment"># hive-site.xml</span></span><br><span class="line"><span class="comment"># 目前仅配置这么多，还有其他配置尚未添加</span></span><br><span class="line"><span class="comment"># javax.jdo.option.ConnectionURL: Hive使用MySQL作为 Metadata 存储时(MySql为5.7.12版本)，需要在连接串中指定是否采用SSL连接</span></span><br><span class="line">Tips：mysql -V	java -version</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;jdbc:mysql://master:3306/hive?createDatabaseIfNotExist=<span class="literal">true</span>&amp;amp;useSSL=<span class="literal">false</span>&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Warning disabled.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;root&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;123456&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/warehouse&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.exec.scratchdir&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/tmp&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.querylog.location&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/<span class="built_in">log</span>&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.cli.print.header&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Whether to <span class="built_in">print</span> the names of the columns <span class="keyword">in</span> query output.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.cli.print.current.db&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Whether to include the current database <span class="keyword">in</span> the Hive prompt.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.metastore.uris&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;thrift://master:9083&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Path <span class="keyword">for</span> Hive metadata.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>




<h5 id="Beeline连接Hive"><a href="#Beeline连接Hive" class="headerlink" title="Beeline连接Hive"></a>Beeline连接Hive</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置了hive.metastore.uris后需开启 Metastore</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HIVE_HOME</span>/bin/</span><br><span class="line"><span class="comment"># 后缀为重定向，需百度解决</span></span><br><span class="line">hive --service metastore  1&gt;/dev/null  2&gt;&amp;1  &amp;</span><br><span class="line"><span class="comment"># beeline方式连接Hive，默认端口为10000</span></span><br><span class="line">hive --service hiveserver2 &amp;</span><br><span class="line"><span class="comment">#beeline</span></span><br><span class="line"><span class="comment">#!connect jdbc:hive2://master:10000 root 123456</span></span><br><span class="line">beeline -u jdbc:hive2://master:10000 -n root -p 123456 --color=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><code>Tips</code> <strong>退出当前jdbc:</strong> !close    <strong>退出Beeline:</strong> !q  <strong>查询表:</strong>!tables</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/20191219-2254-Hive-1-x/" data-id="ck4mw85jj000bawu62i4kcdtr"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191220-1940-Hive" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/24/20191220-1940-Hive/"
    >20191224-1220_Hive</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/24/20191220-1940-Hive/" class="article-date">
  <time datetime="2019-12-24T04:20:20.000Z" itemprop="datePublished">2019-12-24</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="移花接木-Hive"><a href="#移花接木-Hive" class="headerlink" title="移花接木-Hive"></a>移花接木-Hive</h2><h3 id="01-Hive-1-x"><a href="#01-Hive-1-x" class="headerlink" title="01. Hive 1.x"></a>01. Hive 1.x</h3><ul>
<li>Repo Point<br><a href="http://mirror.bit.edu.cn/apache/hive/hive-1.2.2/apache-hive-1.2.2-bin.tar.gz" target="_blank" rel="noopener">apache-hive-1.2.2-bin.tar.gz</a><br><a href="https://downloads.mysql.com/archives/get/file/mysql-connector-java-5.1.44.tar.gz" target="_blank" rel="noopener">mysql-connector-java-5.1.44.tar</a><br><a href="http://archive.apache.org/dist/hive/hive-1.2.2/apache-hive-1.2.2-src.tar.gz" target="_blank" rel="noopener">apache-hive-1.2.2-src.tar.gz</a></li>
</ul>
<h3 id="02-Hive-元素"><a href="#02-Hive-元素" class="headerlink" title="02. Hive 元素"></a>02. Hive 元素</h3><h4 id="元数据-amp-数据"><a href="#元数据-amp-数据" class="headerlink" title="元数据 &amp; 数据"></a>元数据 &amp; 数据</h4><ul>
<li>Hive中的表是纯逻辑表，即<code>元数据</code>；</li>
<li>数据存储在<code>HDFS</code>上，元数据与数据存储分离；</li>
<li>数据计算依赖分布式计算框架 <strong>MapReduce</strong>；</li>
<li>Hive<code>读多写少</code>，从HDFS中读，MR计算，并写回HDFS；<code>不支持数据改写&amp;删除</code>；</li>
<li>用户需指定<code>三个属性</code>用来定义数据格式：<br>列分隔符：空格 ‘,’  ‘\t’<br>行分隔符：’\n’<br>读取数据的方法</li>
</ul>
<h4 id="Hive-架构"><a href="#Hive-架构" class="headerlink" title="Hive 架构"></a>Hive 架构</h4><p><code>CLI</code> <strong><em>Hive</em></strong> / Metastore → hiveserver2(HS2) → <strong><em>Beeline</em></strong><br><code>JDBC</code> <strong><em>Metastore</em></strong> → Java/Python/C++<br><code>WUI</code> apache-hive-0.13.0-src.tar.gz → <strong><em>hive –service hwi</em></strong></p>
<h3 id="03-数据入库"><a href="#03-数据入库" class="headerlink" title="03. 数据入库"></a>03. 数据入库</h3><h4 id="3-1-建表"><a href="#3-1-建表" class="headerlink" title="3-1 建表"></a>3-1 建表</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--HQL</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> article(sentence <span class="keyword">string</span>)   <span class="comment">--一句话就是一行</span></span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\n'</span>;<span class="comment">--每一行的format</span></span><br><span class="line"></span><br><span class="line">desc article; <span class="comment">--查询表结构</span></span><br><span class="line"><span class="comment">--数据导入前，表为空</span></span><br><span class="line"><span class="keyword">select</span> article.sentence <span class="keyword">from</span> article <span class="keyword">limit</span> <span class="number">2</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">--本地数据load（Local Load）</span></span><br><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">local</span> inpath <span class="string">'/data/mr_wc/The_man_of_property.txt'</span></span><br><span class="line"><span class="keyword">into</span> <span class="keyword">table</span> article;</span><br><span class="line"></span><br><span class="line"><span class="comment">--再次查询</span></span><br><span class="line">0: jdbc:hive2://master:10000&gt; select article.sentence from article limit 1;</span><br><span class="line">OK</span><br><span class="line">+<span class="comment">-------------------+--+</span></span><br><span class="line">| article.sentence  |</span><br><span class="line">+<span class="comment">-------------------+--+</span></span><br><span class="line">| Preface           |</span><br><span class="line">+<span class="comment">-------------------+--+</span></span><br><span class="line">1 row selected (0.185 seconds)</span><br></pre></td></tr></table></figure>

<h4 id="3-2-数据清洗"><a href="#3-2-数据清洗" class="headerlink" title="3-2 数据清洗"></a>3-2 数据清洗</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--HQL</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-分区-分桶（详见04）"><a href="#3-3-分区-分桶（详见04）" class="headerlink" title="3-3 分区/分桶（详见04）"></a>3-3 分区/分桶（详见04）</h4><hr>
<h3 id="04-分桶"><a href="#04-分桶" class="headerlink" title="04. 分桶"></a>04. 分桶</h3><h4 id="有点绕的概念"><a href="#有点绕的概念" class="headerlink" title="有点绕的概念"></a>有点绕的概念</h4><p><code>语法</code> tablesample(bucket x out of y on id)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLESAMPLE (BUCKET x OUT OF y [ON colname])</span><br></pre></td></tr></table></figure>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/24/20191220-1940-Hive/" data-id="ck4mw85kf000iawu6g2ak5w8t"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191221-1006-Oracle12cR2" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/23/20191221-1006-Oracle12cR2/"
    >20191223_2356-Oracle12cR2</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/23/20191221-1006-Oracle12cR2/" class="article-date">
  <time datetime="2019-12-23T15:56:17.000Z" itemprop="datePublished">2019-12-23</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="OCP12c"><a href="#OCP12c" class="headerlink" title="OCP12c"></a>OCP12c</h2><h3 id="01-Oracle12cR2"><a href="#01-Oracle12cR2" class="headerlink" title="01. Oracle12cR2"></a>01. Oracle12cR2</h3><ul>
<li>Repo Point<br>[&lt;Oracle-12.2&gt;linuxx64_12201_database.zip]（<a href="https://www.oracle.com/downloads/software-license-agreement.html#license-lightbox）" target="_blank" rel="noopener">https://www.oracle.com/downloads/software-license-agreement.html#license-lightbox）</a></li>
</ul>
<h3 id="02-runInstaller"><a href="#02-runInstaller" class="headerlink" title="02. runInstaller"></a>02. runInstaller</h3><p><code>To be continued...</code></p>
<h3 id="03-Oracle12c-架构"><a href="#03-Oracle12c-架构" class="headerlink" title="03. Oracle12c 架构"></a>03. Oracle12c 架构</h3><h4 id="实例和内存结构"><a href="#实例和内存结构" class="headerlink" title="实例和内存结构"></a>实例和内存结构</h4><p><code>Instance</code> 实例其实就是物理内存段的一部分，相当于软件进程.<br><code>kernel.shmall</code> 为共享内存大小，按照192.168.62.103测试库来看，可以配置为 <strong>4294967296</strong> 个page（4KB/page）.<br><code>kernel.shmmax</code> 用于定义单个共享内存段的最大值，<code>kernel.shmmax</code> 设置应该足够大，能在一个共享内存段下容纳下整个的 <code>SGA</code> ，设置的过低可能会导致需要创建多个共享内存段，这样可能导致系统性能的下降，最大值为16GB（在大多数情况下，该值应该比SGA大）.按照192.168.62.103测试库（内存128G）来看，可以配置为 <strong>88719476736</strong>（82GB）.<br>53477376 pages / 219043332096 bytes</p>
<p><code>Ex</code> 内核参数，系统内存4G，下面为对应内核配置大小（出自官方白皮书）<br><img src="Linux内核参数.png" title="Linux内核参数" alt="Linux内核参数"></p>
<p>实例内存由下面<strong>两组内存参数</strong>动态调整：<br><code>SGA</code>（total_mem × 80%） × 80%，一般不超过物理内存的1/2.<br><code>PGA</code>（total_mem × 80%） × 20%.</p>
<table>
<thead>
<tr>
<th>×</th>
<th>×</th>
<th>MEM参数</th>
</tr>
</thead>
<tbody><tr>
<td>×</td>
<td>×</td>
<td><code>MEMORY_MAX_TARGET</code>（静态）⬇</td>
</tr>
<tr>
<td><code>SGA_MAX_SIZE</code></td>
<td>×</td>
<td><code>MEMORY_TARGET</code>（动态）⬇</td>
</tr>
<tr>
<td>×</td>
<td><code>SGA_TARGET</code>⬇</td>
<td><code>PGA_AGGREGATE_TARGET</code>⬇</td>
</tr>
<tr>
<td>×</td>
<td><code>DB_CACHE</code> <code>SHARED_POOL</code> <code>LARGE_POOL</code> …</td>
<td></td>
</tr>
</tbody></table>
<img src="RAM.png" title="内存架构" alt="内存架构">

<h4 id="关于SGA和PGA的一点配置总结"><a href="#关于SGA和PGA的一点配置总结" class="headerlink" title="关于SGA和PGA的一点配置总结"></a>关于SGA和PGA的一点配置总结</h4><p><code>Tips</code> 相关总结不一定正确，仍需实验验证.<br>[相关博客：关于oracle11G的自动内存管理MEMORY_TARGET和MEMORY_MAX_TARGET]（<a href="https://blog.csdn.net/fjseryi/article/details/50818843）" target="_blank" rel="noopener">https://blog.csdn.net/fjseryi/article/details/50818843）</a><br><code>MEMORY_MAX_TARGET</code> 参数定义了 <code>MEMORY_TARGET</code> 可以达到的最大值，若未设置，则默认等于 <code>MEMORY_TARGET</code> 的值；该值为数据库初始化参数，不可动态调节，通过调整Spfile中的<code>MEMORY_MAX_TARGET</code>并重启实例，可以达到调整的目的.<br><code>MEMORY_TARGET</code> SGA + PGA. Oracle总共可以使用的共享内存大小，不可超过 <code>MEMORY_MAX_TARGET</code> 的大小，默认为0；该值可以动态调节，无需重启实例.<br><code>动态内存管理</code> 使用动态内存管理时，<code>MEMORY_TARGET</code>下的 <code>SGA_TARGET</code> 和 <code>PGA_AGGREGATE_TARGET</code> 代表它们各自内存区域的<strong>最小设置</strong>，要让Oracle完全控制内存管理，上述两个参数应该设置为0.</p>
<ul>
<li><p><code>MEMORY_TARGET</code>设置为非0值：</p>
<ol>
<li>设置了<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，则两个参数将各自作为最小值，作为各自的初始化目标值.</li>
<li>未设置<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，则根据DB状态按照一个固定比例分配：<br>SGA = MEMORY_TARGET * 60%.<br>PGA_AGGREGATE_TARGET = MEMORY_TARGET * 40%.</li>
<li>仅设置了两个中的一个，则 SGA = MEMORY_TARGET - PGA_AGGREGATE_TARGET；反之类似.</li>
</ol>
</li>
<li><p><code>MEMORY_TARGET</code>设置为0或未设置：</p>
<ol>
<li>设置了<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，则自动调节 <code>SGA</code> 中的 Shared pool、Buffer Cache、Redo Log Buffer、Java Pool、Larger Pool等内存空间的大小；PGA 则依赖 <code>PGA_AGGREGATE_TARGET</code> 的大小。 <code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code> 不能自动增长和自动缩小.</li>
<li>未设置<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，第1点<code>SGA</code> 中的各二级内存配置需要被明确设定，<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code> 不能自动增长和自动缩小.</li>
<li><code>MEMORY_MAX_TARGET</code> 设置而 <code>MEMORY_TARGET</code> = 0，这种情况不太懂？？？</li>
</ol>
</li>
</ul>
<hr>
<h4 id="SGA下的各种缓冲区（二级内存配置）"><a href="#SGA下的各种缓冲区（二级内存配置）" class="headerlink" title="SGA下的各种缓冲区（二级内存配置）"></a>SGA下的各种缓冲区（二级内存配置）</h4><ul>
<li><code>Data Buffer Cache</code> 数据高速缓冲区，又分级为：Dirty Buffer/Free Buffer/Pinned Buffer<br>  → <code>Dirty Buffer</code> 脏缓冲区，当数据库发生 DML（Insert、Update、Delete）操作时，会对缓冲区内容进行修改，这样缓冲区的内容就会和相对应的数据文件不一致，这时，缓冲区标识为“脏缓冲区”.<br>  → <code>Free Buffer</code> 自由缓冲区，当“脏缓冲区”的内容被写入数据文件后，因为该缓冲区与相应数据文件部分内容一致，所以将这些缓冲区称为“自由缓冲区”；当执行 SELECT 语句时，会将对应数据文件部分数据读取到数据高速缓存的相应缓冲区，因为缓冲区与数据块内容完全一致，所以这些缓冲区也被称为“自由缓冲区”.<br>  → <code>Pinned Buffer</code> 忙缓冲区，指服务器进程正在访问的缓冲区.<br>  → 为了防止数据库高速缓冲区空间不够用，Oracle 会将脏缓冲区中的数据写入对应的数据文件中（<code>Redo.log</code>），以腾出空间给新的数据.</li>
</ul>
<p><code>Ex</code> 高速缓冲区的大小管理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示高速缓冲区的大小</span></span><br><span class="line"><span class="comment"># "0" 表示数据库自动管理，这里表示设置的是最小值。</span></span><br><span class="line">show parameter db_cache_size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改数据库高速缓冲区大小</span></span><br><span class="line">alter system <span class="built_in">set</span> db_cache_size=500m; </span><br><span class="line"></span><br><span class="line"><span class="comment"># flush缓冲区，生产库慎用</span></span><br><span class="line">alter system flush buffer_cache</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li><code>Redo Log Buffer</code> 重做日志缓冲区（循环文件，redo01.log/redo02.log/redo03.log），由一条条重做项构成.</li>
</ul>
<p><code>初始化参数</code> LOG_BUFFER</p>
<hr>
<ul>
<li><code>Shared Pool</code> SGA的共享池，内含库缓存、数字字典缓冲区（执行计划的依赖来源）等.<br>  <code>数据字典缓冲区</code> 数据库参考信息（数据库结构/用户等）<br>  <code>库高速缓存</code> 共享SQL区和共享PL/SQL区.</li>
</ul>
<p><code>Ex</code> Shared Pool 展示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--当用户执行语句时</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> empno=<span class="number">7788</span>;</span><br><span class="line"><span class="comment">--Oracle 需要查询数据字典 dba_tables 确定表 emp 是否存在</span></span><br><span class="line"><span class="comment">--如果该表已经存在，还需要查询数据字典 dba_tab_columns 确定列 empno 在表 emp 中是否存在</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> dba_tab_columns <span class="keyword">WHERE</span> column_name = <span class="string">'EMPNO'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--然后才能生成执行语句的过程（执行计划），这些定义在首次查询时存入数据字典高速缓冲区.</span></span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li><code>大型池 Java池 流池</code><br>主要是大型池的大小影响数据备份效率.</li>
</ul>
<hr>
<h4 id="PGA（了解即可）"><a href="#PGA（了解即可）" class="headerlink" title="PGA（了解即可）"></a>PGA（了解即可）</h4><p><code>PGA</code> 私有SQL、会话内存、SQL工作区.</p>
<h4 id="In-Memory-Column-Store"><a href="#In-Memory-Column-Store" class="headerlink" title="In-Memory Column Store"></a>In-Memory Column Store</h4><ul>
<li><code>In-Memory area</code> 适用于：<br>  → 资源表中的行非常多，但查询结果行不多.<br>  → 资源表中的列很多，但查询结果的列很少.<br>  → 查询聚集数据</li>
</ul>
<h4 id="各种进程"><a href="#各种进程" class="headerlink" title="各种进程"></a>各种进程</h4><ul>
<li>用户进程：用户机器上的进程，在服务端体现为进程状态中的LOCAL和非LOCAL.</li>
</ul>
<img src="用户进程.png" title="用户进程" alt="用户进程">

<ul>
<li>后台进程：<code>LGWR</code> <code>DBWn</code> <code>CKPT</code> <code>SMON</code> <code>PMON</code> </li>
</ul>
<h4 id="一次数据更新所要走过的流程"><a href="#一次数据更新所要走过的流程" class="headerlink" title="一次数据更新所要走过的流程"></a>一次数据更新所要走过的流程</h4><p><code>Tips</code> 关于 <code>SGA下的众多二级内存</code>和<code>LGWR</code> <code>DBWn</code> <code>CKPT</code>等进程之间的一点关联和解析</p>
<hr>
<h3 id="04-实例管理"><a href="#04-实例管理" class="headerlink" title="04. 实例管理"></a>04. 实例管理</h3><h4 id="实例加载"><a href="#实例加载" class="headerlink" title="实例加载"></a>实例加载</h4><p><code>NOMOUNT</code><br><code>MOUNT</code><br><code>OPEN</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="实例关闭"><a href="#实例关闭" class="headerlink" title="实例关闭"></a>实例关闭</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="动态性能视图"><a href="#动态性能视图" class="headerlink" title="动态性能视图"></a>动态性能视图</h4><h4 id="ORACLE-HOME-dbs"><a href="#ORACLE-HOME-dbs" class="headerlink" title="$ORACLE_HOME/dbs"></a>$ORACLE_HOME/dbs</h4><p><code>Tips</code> 初始化文件</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/23/20191221-1006-Oracle12cR2/" data-id="ck4mw85k9000gawu6g9infsgr"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Oracle12c/" rel="tag">Oracle12c</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191220-1347-ubuntu16-04-2-server-amd64" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/20/20191220-1347-ubuntu16-04-2-server-amd64/"
    >20191220_1347_ubuntu16.04.2-server-amd64</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/20/20191220-1347-ubuntu16-04-2-server-amd64/" class="article-date">
  <time datetime="2019-12-20T05:48:57.000Z" itemprop="datePublished">2019-12-20</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Ubuntu-Server-配置"><a href="#Ubuntu-Server-配置" class="headerlink" title="Ubuntu Server 配置"></a>Ubuntu Server 配置</h2><h3 id="01-Ubuntu16-04-2-Server-amd64"><a href="#01-Ubuntu16-04-2-Server-amd64" class="headerlink" title="01. Ubuntu16.04.2-Server-amd64"></a>01. Ubuntu16.04.2-Server-amd64</h3><ul>
<li>Repo Point<br><a href="http://old-releases.ubuntu.com/releases/16.04.2/ubuntu-16.04.2-server-amd64.iso" target="_blank" rel="noopener">ubuntu-16.04.2-server-amd64.iso</a><br><code>Tips</code> <strong>最新的版本已到19.01</strong></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-Ubuntu16-04-2-Server-amd64"><a href="#1-Ubuntu16-04-2-Server-amd64" class="headerlink" title="1. Ubuntu16.04.2-Server-amd64"></a>1. Ubuntu16.04.2-Server-amd64</h4><h5 id="服务器BOIS启动"><a href="#服务器BOIS启动" class="headerlink" title="服务器BOIS启动"></a>服务器BOIS启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F2、F12或 Del 进BOIS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部分前置的选项包括语言、键盘语言&amp;布局、用户描述、非root用户账密、时区等</span></span><br></pre></td></tr></table></figure>

<h4 id="2-LVM"><a href="#2-LVM" class="headerlink" title="2. LVM"></a>2. LVM</h4><p><code>Tips</code> <a href="https://help.ubuntu.com/lts/serverguide/advanced-installation.html" target="_blank" rel="noopener">https://help.ubuntu.com/lts/serverguide/advanced-installation.html</a></p>
<h5 id="下面是官方文档步骤，建议使用LVM配置除了-boot外的所有挂载，便于后续LVM扩容"><a href="#下面是官方文档步骤，建议使用LVM配置除了-boot外的所有挂载，便于后续LVM扩容" class="headerlink" title="下面是官方文档步骤，建议使用LVM配置除了/boot外的所有挂载，便于后续LVM扩容."></a>下面是官方文档步骤，建议使用LVM配置除了/boot外的所有挂载，便于后续LVM扩容.</h5><ol>
<li>Follow the installation steps until you get to the Partition disks step, then: At the “Partition Disks screen choose “Manual”.</li>
</ol>
<ul>
<li>选择分区手动配置.</li>
</ul>
<hr>
<ol start="2">
<li>Select the hard disk and on the next screen choose “yes” to “Create a new empty partition table on this device”.</li>
</ol>
<ul>
<li>选择在磁盘上创建新的分区.</li>
</ul>
<hr>
<ol start="3">
<li>Next, create standard /boot, swap, and / partitions with whichever filesystem you prefer.</li>
</ol>
<ul>
<li>先手动建立 <code>/boot</code> 分区，剩余所有大小全部配置为 <code>LVM</code> 逻辑卷.</li>
</ul>
<hr>
<ol start="4">
<li>For the LVM /srv, create a new Logical partition. Then change “Use as” to “physical volume for LVM” then “Done setting up the partition”.</li>
</ol>
<ul>
<li>LVM内按照自己的需求进行生成和挂载，选择 “physical volume for LVM”.</li>
</ul>
<hr>
<ol start="5">
<li>Now select “Configure the Logical Volume Manager” at the top, and choose “Yes” to write the changes to disk.</li>
</ol>
<ul>
<li>磁盘分切完后(/boot &amp; LVM)，进入LVM管理配置，开始配置划分后的LVM磁盘.</li>
</ul>
<hr>
<ol start="6">
<li>For the “LVM configuration action” on the next screen, choose “Create volume group”. Enter a name for the VG such as vg01, or something more descriptive. After entering a name, select the partition configured for LVM, and choose “Continue”.</li>
</ol>
<ul>
<li>顺序：<code>PV(Free physical volumes) → VG → LV</code> 此处应该可以从配置项里看到可用的PV，选择创建命名VG(例如：vg01).</li>
</ul>
<hr>
<ol start="7">
<li>Back at the “LVM configuration action” screen, select “Create logical volume”. Select the newly created volume group, and enter a name for the new LV, for example srv since that is the intended mount point. Then choose a size, which may be the full partition because it can always be extended later. Choose “Finish” and you should be back at the main “Partition Disks” screen.</li>
</ol>
<ul>
<li>根据自己的需求，将创建好的VG分切至各个LV，并取名(例如：swap、root).</li>
</ul>
<hr>
<ol start="8">
<li>Now add a filesystem to the new LVM. Select the partition under “LVM VG vg01, LV srv”, or whatever name you have chosen, the choose Use as. Setup a file system as normal selecting /srv as the mount point. Once done, select “Done setting up the partition”.</li>
</ol>
<ul>
<li>到这里，LVM已按照需求划分为不同分区，现在要做的就是挂载到对应的目录下，按照先前的命名，一一对应挂载.</li>
</ul>
<hr>
<ol start="9">
<li>Finally, select “Finish partitioning and write changes to disk”. Then confirm the changes and continue with the rest of the installation.</li>
</ol>
<ul>
<li>Finish.</li>
</ul>
<hr>
<h5 id="具体磁盘配置步骤"><a href="#具体磁盘配置步骤" class="headerlink" title="具体磁盘配置步骤"></a><strong>具体磁盘配置步骤</strong></h5><img src="1.png" title="01" alt="">

<hr>
<img src="2.png" title="02" alt="">

<hr>
<img src="3.png" title="03" alt="">

<hr>
<img src="4.png" title="单独建立/boot" alt="">

<hr>
<img src="5.png" title="单独建立/boot" alt="">

<hr>
<img src="6.png" title="单独建立/boot" alt="">

<hr>
<img src="7.png" title="单独建立/boot" alt="">

<hr>
<img src="8.png" title="08" alt="">

<hr>
<img src="9.png" title="09" alt="">

<hr>
<img src="10.png" title="10" alt="">

<hr>
<img src="11.png" title="11" alt="">

<hr>
<img src="12.png" title="12" alt="">

<hr>
<img src="13.png" title="13" alt="">

<hr>
<img src="14.png" title="14" alt="">

<hr>
<img src="15.png" title="15" alt="">

<hr>
<img src="16.png" title="16" alt="">

<hr>
<img src="17.png" title="17" alt="">

<hr>
<img src="18.png" title="18" alt="">

<hr>
<img src="19.png" title="19" alt="">

<hr>
<img src="20.png" title="20" alt="">

<hr>
<img src="21.png" title="21" alt="">

<hr>
<img src="22.png" title="配置完成后的挂载" alt="">

<hr>
<img src="23.png" title="23" alt="">

<hr>
<img src="24.png" title="24" alt="">

<hr>
<img src="25.png" title="25" alt="">

<hr>
<img src="26.png" title="26" alt="">

<hr>
<img src="27.png" title="27" alt="">

<hr>
<img src="28.png" title="28" alt="">

<hr>
<img src="29.png" title="29" alt="">

<hr>
<img src="30.png" title="不自动更新" alt="">

<hr>
<img src="31.png" title="31" alt="">

<hr>
<img src="32.png" title="Install GRUB boot loader" alt="">

<hr>
<img src="33.png" title="Install GRUB boot loader" alt="">

<hr>
<img src="34.png" title="Finish!" alt="">

<hr>
<h5 id="安装过程完成后会自动reboot"><a href="#安装过程完成后会自动reboot" class="headerlink" title="安装过程完成后会自动reboot."></a>安装过程完成后会自动reboot.</h5><img src="35.png" title="Finish!" alt="">


<h4 id="3-静态IP"><a href="#3-静态IP" class="headerlink" title="3. 静态IP"></a>3. 静态IP</h4><h5 id="配置root用户"><a href="#配置root用户" class="headerlink" title="配置root用户"></a>配置root用户</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置静态IP</span></span><br><span class="line">ubuntu@ubuntu:~$ sudo vim /etc/network/interfaces</span><br><span class="line">[sudo] password <span class="keyword">for</span> ubuntu: </span><br><span class="line"><span class="comment"># interfaces</span></span><br><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto ens33                 ⬅ 网关自启</span><br><span class="line"><span class="comment"># iface ens33 inet dhcp</span></span><br><span class="line">iface ens33 inet static</span><br><span class="line">address 192.168.73.21      ⬅ 内网静态IP</span><br><span class="line">gateway 192.168.73.2       ⬅ 内网网关</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">network 192.168.73.0       ⬅ 子网IP</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置DNS</span></span><br><span class="line">ubuntu@ubuntu:~$ sudo vim /etc/resolv.conf </span><br><span class="line"><span class="comment"># resolv.conf</span></span><br><span class="line"><span class="comment"># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</span></span><br><span class="line"><span class="comment">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span></span><br><span class="line"><span class="comment"># nameserver 192.168.73.2</span></span><br><span class="line"><span class="comment"># search localdomain</span></span><br><span class="line">nameserver 202.96.128.86</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启网络</span></span><br><span class="line">ubuntu@ubuntu:~$ sudo service networking restart</span><br></pre></td></tr></table></figure>


<h5 id="4-上述配置正确，此时就可以用客户端进行连接"><a href="#4-上述配置正确，此时就可以用客户端进行连接" class="headerlink" title="4.上述配置正确，此时就可以用客户端进行连接"></a>4.上述配置正确，此时就可以用客户端进行连接</h5><h5 id="5-root用户激活"><a href="#5-root用户激活" class="headerlink" title="5. root用户激活"></a>5. root用户激活</h5><p><code>Tips</code> 这一步可以放在第3步执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ubuntu:~$ sudo passwd root</span><br><span class="line">Enter new UNIX password:        ⬅ root </span><br><span class="line">Retype new UNIX password:       ⬅ root</span><br><span class="line">passwd: password updated successfully</span><br><span class="line">ubuntu@ubuntu:~$ su - root</span><br><span class="line">Password:                       ⬅ root</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/20/20191220-1347-ubuntu16-04-2-server-amd64/" data-id="ck4mw85jy000eawu66dumcwai"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191219-2347-Hadoop-2-6-1" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/19/20191219-2347-Hadoop-2-6-1/"
    >20191219-2347_Hadoop-2.6.1</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/19/20191219-2347-Hadoop-2-6-1/" class="article-date">
  <time datetime="2019-12-19T15:47:55.000Z" itemprop="datePublished">2019-12-19</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Hadoop-2-X-配置"><a href="#Hadoop-2-X-配置" class="headerlink" title="Hadoop 2.X 配置"></a>Hadoop 2.X 配置</h2><h3 id="01-Hadoop-2-6-1"><a href="#01-Hadoop-2-6-1" class="headerlink" title="01. Hadoop 2.6.1"></a>01. Hadoop 2.6.1</h3><ul>
<li>Repo Point<br><a href="http://archive.apache.org/dist/hadoop/common/hadoop-2.6.1/hadoop-2.6.1.tar.gz" target="_blank" rel="noopener">hadoop-2.6.1.tar.gz</a></li>
</ul>
<h3 id="02-环境配置-部分Linux基础环境配置暂未罗列，如host、jdk等"><a href="#02-环境配置-部分Linux基础环境配置暂未罗列，如host、jdk等" class="headerlink" title="02. 环境配置(部分Linux基础环境配置暂未罗列，如host、jdk等)"></a>02. 环境配置(部分Linux基础环境配置暂未罗列，如host、jdk等)</h3><h4 id="1-环境包-rz-至相关路径，分流至其它节点："><a href="#1-环境包-rz-至相关路径，分流至其它节点：" class="headerlink" title="1. 环境包 rz 至相关路径，分流至其它节点："></a>1. 环境包 rz 至相关路径，分流至其它节点：</h4><h5 id="组件-amp-源码分发"><a href="#组件-amp-源码分发" class="headerlink" title="组件&amp;源码分发"></a>组件&amp;源码分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件解压：hadoop-2.6.1/etc/hadoop</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/</span><br><span class="line">tar -xvf hadoop-2.6.1.tar.gz</span><br></pre></td></tr></table></figure>

<h5 id="当前用户环境变量"><a href="#当前用户环境变量" class="headerlink" title="当前用户环境变量"></a>当前用户环境变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># ~/.bashrc</span></span><br><span class="line"><span class="comment"># SET JAVA PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># SET HADOOP PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET HIVE PATH</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SCALA PATH</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET INI PATH</span></span><br><span class="line"><span class="built_in">export</span> INI_PATH=/usr/<span class="built_in">local</span>/src</span><br><span class="line"><span class="comment"># SET SPARK PATH</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">scp ~/.bashrc root@slave1 ~/.bashrc</span><br><span class="line">scp ~/.bashrc root@slave2 ~/.bashrc</span><br><span class="line"><span class="comment"># 节点分发&amp;生效</span></span><br><span class="line">ssh slave1</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">ssh slave2</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<h5 id="配置文件修改-amp-相关文件夹创建"><a href="#配置文件修改-amp-相关文件夹创建" class="headerlink" title="配置文件修改&amp;相关文件夹创建"></a>配置文件修改&amp;相关文件夹创建</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/etc/hadoop</span><br><span class="line">vim hadoop-env.sh</span><br><span class="line"><span class="comment"># hadoop-env.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim yarn-env.sh</span><br><span class="line"><span class="comment"># yarn-env.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim slaves</span><br><span class="line"><span class="comment"># 配置节点</span></span><br><span class="line"><span class="comment"># slaves</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim core-site.xml</span><br><span class="line"><span class="comment"># 配置master节点IP及Hadoop临时文件根目录tmp</span></span><br><span class="line"><span class="comment"># core-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim hdfs-site.xml</span><br><span class="line"><span class="comment"># 配置namenode/datanode/replication（备份）文件目录</span></span><br><span class="line"><span class="comment"># hdfs-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim mapred-site.xml</span><br><span class="line"><span class="comment"># mapred-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim yarn-site.xml</span><br><span class="line"><span class="comment"># yarn-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Hadoop临时目录和文件目录</span></span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/tmp</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/dfs/name</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/dfs/data</span><br></pre></td></tr></table></figure>


<h5 id="主节点配置好的-Hadoop-源码分发至集群其余节点"><a href="#主节点配置好的-Hadoop-源码分发至集群其余节点" class="headerlink" title="主节点配置好的 Hadoop 源码分发至集群其余节点"></a>主节点配置好的 Hadoop 源码分发至集群其余节点</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /usr/<span class="built_in">local</span>/src/hadoop-2.6.1 root@slave1:/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line">scp /usr/<span class="built_in">local</span>/src/hadoop-2.6.1 root@slave2:/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br></pre></td></tr></table></figure>

<h3 id="03-Hadoop集群初始化-启动-关闭"><a href="#03-Hadoop集群初始化-启动-关闭" class="headerlink" title="03. Hadoop集群初始化/启动/关闭"></a>03. Hadoop集群初始化/启动/关闭</h3><h4 id="集群格式化-集群启动-JAVA进程查看-集群关闭"><a href="#集群格式化-集群启动-JAVA进程查看-集群关闭" class="headerlink" title="集群格式化/集群启动/JAVA进程查看/集群关闭"></a>集群格式化/集群启动/JAVA进程查看/集群关闭</h4><p><code>Tips</code> 初始化只需要做一次！！！</p>
<h5 id="格式化Hadoop-NN"><a href="#格式化Hadoop-NN" class="headerlink" title="格式化Hadoop(NN)"></a>格式化Hadoop(NN)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line">hadoop namenode -format</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line">./start-all.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭集群</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line">./stop-all.ssh</span><br></pre></td></tr></table></figure>

<h5 id="jps查看集群状态"><a href="#jps查看集群状态" class="headerlink" title="jps查看集群状态"></a>jps查看集群状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master bin]<span class="comment"># jps</span></span><br><span class="line">2784 NameNode       ⬅ NN</span><br><span class="line">3122 ResourceManager    ⬅ RM</span><br><span class="line">13827 Jps</span><br><span class="line">6853 Master     ⬅ (这个为Spark集群启动标识，Hadoop启动时不包括)</span><br><span class="line">2943 SecondaryNameNode  ⬅ Secondary Bak NN</span><br><span class="line">[root@master bin]<span class="comment"># </span></span><br><span class="line">[root@master bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/20191219-2347-Hadoop-2-6-1/" data-id="ck4mw85js000cawu61k8ufoyk"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hadoop-2-X/" rel="tag">Hadoop 2.X</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191219-1545-Spark" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/19/20191219-1545-Spark/"
    >20191219_1545_SPARK</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/19/20191219-1545-Spark/" class="article-date">
  <time datetime="2019-12-19T08:18:41.000Z" itemprop="datePublished">2019-12-19</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Spark-配置"><a href="#Spark-配置" class="headerlink" title="Spark 配置"></a>Spark 配置</h2><h3 id="01-Spark"><a href="#01-Spark" class="headerlink" title="01. Spark"></a>01. Spark</h3><ul>
<li>Repo Point<br><a href="http://archive.apache.org/dist/spark/spark-2.0.2/spark-2.0.2-bin-hadoop2.6.tgz" target="_blank" rel="noopener">spark-2.0.2-bin-hadoop2.6.tgz</a></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-环境包-rz-至相关路径，分流至其它节点"><a href="#1-环境包-rz-至相关路径，分流至其它节点" class="headerlink" title="1. 环境包 rz 至相关路径，分流至其它节点"></a>1. 环境包 rz 至相关路径，分流至其它节点</h4><h5 id="源码分发"><a href="#源码分发" class="headerlink" title="源码分发"></a>源码分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave1:/usr/<span class="built_in">local</span>/src/</span><br><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave2:/usr/<span class="built_in">local</span>/src/</span><br></pre></td></tr></table></figure>

<h4 id="2-用户环境变量配置"><a href="#2-用户环境变量配置" class="headerlink" title="2. 用户环境变量配置"></a>2. 用户环境变量配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SET JAVA PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># SET HADOOP PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET HIVE PATH</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SCALA PATH</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SPARK PATH</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># SET INI PATH</span></span><br><span class="line"><span class="built_in">export</span> INI_PATH=/usr/<span class="built_in">local</span>/src</span><br></pre></td></tr></table></figure>
<h5 id="环境变量分发"><a href="#环境变量分发" class="headerlink" title="环境变量分发"></a>环境变量分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.bashrc root@slave1:~/</span><br><span class="line">scp ~/.bashrc root@slave2:~/</span><br></pre></td></tr></table></figure>

<h4 id="3-修改-SPARK-源码环境配置文件、添加集群节点："><a href="#3-修改-SPARK-源码环境配置文件、添加集群节点：" class="headerlink" title="3. 修改 SPARK 源码环境配置文件、添加集群节点："></a>3. 修改 SPARK 源码环境配置文件、添加集群节点：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6/conf/</span><br><span class="line">mv spark-env.sh.template spark-env.sh</span><br><span class="line">vim spark-env.sh</span><br><span class="line"><span class="comment"># spark-env.sh</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1/etc/hadoop</span><br><span class="line">SPARK_MASTER_IP=master</span><br><span class="line">SPARK_LOCAL_DIRS=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line">SPARK_DRIVER_MEMORY=1G</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">mv slaves.template slaves</span><br><span class="line">vim slaves</span><br><span class="line"><span class="comment"># slaves 添加集群节点</span></span><br><span class="line">slave1</span><br><span class="line">slave2</span><br><span class="line"><span class="comment">######</span></span><br></pre></td></tr></table></figure>

<h4 id="4-适配Spark-SQL"><a href="#4-适配Spark-SQL" class="headerlink" title="4. 适配Spark-SQL"></a>4. 适配Spark-SQL</h4><h5 id="MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：MySQL配置"><a href="#MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：MySQL配置" class="headerlink" title="MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：MySQL配置"></a>MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：<a href="">MySQL配置</a></h5><p>修改 $HIVE_HOME/bin下的Hive启动脚本 <strong><code>hive</code></strong>：<br><code>Tips</code> <strong>SPARK2.0</strong> 中没有 <code>${SPARK_HOME}/lib/spark-assembly-*.jar</code>，<strong>lib</strong>文件中的jar包已经被分成多个小的jar包在放置在 <code>${SPARK_HOME}/jars/</code> 下.</p>
<h5 id="修改前："><a href="#修改前：" class="headerlink" title="修改前："></a>修改前：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add SPARK assembly jar to the classpath</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="string">"<span class="variable">$SPARK_HOME</span>"</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  sparkAssemblyPath=`ls <span class="variable">$&#123;SPARK_HOME&#125;</span>/lib/spark-assembly-*.jar`</span><br><span class="line">  CLASSPATH=<span class="string">"<span class="variable">$&#123;CLASSPATH&#125;</span>:<span class="variable">$&#123;sparkAssemblyPath&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h5 id="YARN-Hadoop-2-0-内的："><a href="#YARN-Hadoop-2-0-内的：" class="headerlink" title="YARN (Hadoop 2.0) 内的："></a>YARN (Hadoop 2.0) 内的：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add SPARK assembly jar to the classpath</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="string">"<span class="variable">$SPARK_HOME</span>"</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  sparkAssemblyPath=`ls <span class="variable">$&#123;SPARK_HOME&#125;</span>/jars/*.jar`</span><br><span class="line">  CLASSPATH=<span class="string">"<span class="variable">$&#123;CLASSPATH&#125;</span>:<span class="variable">$&#123;sparkAssemblyPath&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="5-更新Hadoop-Yarn下的老版-jline-0-9-94-jar"><a href="#5-更新Hadoop-Yarn下的老版-jline-0-9-94-jar" class="headerlink" title="5. 更新Hadoop Yarn下的老版 jline-0.9.94.jar"></a>5. 更新Hadoop Yarn下的老版 <strong>jline-0.9.94.jar</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hive内较新版本的jline替换Hadoop内的OLD版本</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br><span class="line">mv jline-0.9.94.jar jline-0.9.94.jar.old</span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/lib/jline-2.12.jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br></pre></td></tr></table></figure>

<h4 id="6-Hive集成Spark-SQL"><a href="#6-Hive集成Spark-SQL" class="headerlink" title="6. Hive集成Spark-SQL"></a>6. Hive集成Spark-SQL</h4><p><code>Tips</code> 这部分集成后的功能暂未进行操作</p>
<h5 id="hive-site-xml-内新增-Metastore-配置"><a href="#hive-site-xml-内新增-Metastore-配置" class="headerlink" title="hive-site.xml 内新增 Metastore 配置"></a>hive-site.xml 内新增 Metastore 配置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$HIVE_HOME</span>/conf/hive-site.xml</span><br><span class="line"><span class="comment"># hive-site.xml 新增如下内容：</span></span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;hive.metastore.uris&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;thrift://hostname:9083&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将Hive的配置文件拷贝给SPARK</span></span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/conf/hive-site.xml <span class="variable">$SPARK_HOME</span>/conf/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将MySQL下的jdbc驱动包拷贝给SPARK</span></span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/lib/mysql-connector-java-5.1.44.jar  <span class="variable">$SPARK_HOME</span>/jars/</span><br></pre></td></tr></table></figure>

<h4 id="7-SPARK集群启动-关闭"><a href="#7-SPARK集群启动-关闭" class="headerlink" title="7. SPARK集群启动/关闭"></a>7. SPARK集群启动/关闭</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6/sbin/</span><br><span class="line">./start-all.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭集群：</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6/sbin/</span><br><span class="line">./stop-all.sh</span><br></pre></td></tr></table></figure>

<h5 id="启动-Hive-metastore"><a href="#启动-Hive-metastore" class="headerlink" title="启动 Hive metastore"></a>启动 Hive metastore</h5><p><code>Metedata</code>元数据.<br><code>Metastore</code>Hive客户端连接Metastore元存储服务，Metastore再去连接MySQL来存取 <strong>元数据</strong>。多个客户端连接Hive时，只需要连接Metastore服务即可；即启动后可以用Java、Python等调用该jdbc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hive --service metastore</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HIVE_HOME</span>/bin/</span><br><span class="line">hive --service metastore  1&gt;/dev/null  2&gt;&amp;1  &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Spark-SQL的shell交互界面</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SPARK_HOME</span>/bin/</span><br><span class="line">spark-shell --master spark://master:7077</span><br></pre></td></tr></table></figure>
<h5 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h5><p><code>hiveserver2</code>HS2是一个服务端接口，使远程客户端可以执行对Hive的查询并返回结果，HS2提供了新的CLI：Beeline(基于SQLLine)，可以作为Hive jdbc Client端访问HS2.<br><code>hiveserver2</code> 和 <code>Metastore</code>一样同为Thrift Service，区别是否在于前者访问数据，后者访问元数据？？？</p>
<ul>
<li>网上有一部分解释：</li>
</ul>
<ol>
<li><p>若有在 <code>hive-site.xml</code> 中配置 <code>hive.metastore.uris</code>，则 <code>hiveserver2</code> 启动时会去连接配置好的 Metastore 服务(故需开启Metastore服务，其余jdbc访问也需开启该服务)，这种方式最为常用；</p>
</li>
<li><p>配置情况下未启动 <code>Metastore</code>，本地Beeline Client连接会失败；<img src="Spark-error_metastore_beeline.png" alt="配置MS但未开启时，Beeline报错." title="配置MS但未开启时，Beeline报错."> </p>
</li>
<li><p>若未配置，则启动HS2时，会先启动一个 <code>Metastore</code> 服务，然后再启动HS2，便于后续Beeline CLI的连接.</p>
</li>
<li></li>
</ol>
<h5 id="回顾下Beeline连接Hive"><a href="#回顾下Beeline连接Hive" class="headerlink" title="回顾下Beeline连接Hive"></a>回顾下Beeline连接Hive</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置了hive.metastore.uris后需开启 Metastore</span></span><br><span class="line"><span class="comment"># 后缀为重定向，需百度解决</span></span><br><span class="line">hive --service metastore  1&gt;/dev/null  2&gt;&amp;1  &amp;</span><br><span class="line"><span class="comment"># beeline方式连接Hive，默认端口为10000</span></span><br><span class="line">hive --service hiveserver2</span><br><span class="line"><span class="comment">#beeline</span></span><br><span class="line"><span class="comment">#!connect jdbc:hive2://master:10000 root 123456</span></span><br><span class="line">beeline -u jdbc:hive2://master:10000 -n root -p 123456 --color=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><code>Tips</code> 可以单独启动 SPARK 集群，但此时无ResourceManager/NodeManager等进程！！！</p>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/20191219-1545-Spark/" data-id="ck4mw85ja0007awu697pabfgp"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191219-1545-ZooKeeper-Kafka" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/19/20191219-1545-ZooKeeper-Kafka/"
    >20191219_1545_ZooKeeper-Kafka</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/19/20191219-1545-ZooKeeper-Kafka/" class="article-date">
  <time datetime="2019-12-19T07:47:13.000Z" itemprop="datePublished">2019-12-19</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="ZooKeeper-amp-Kafka-配置"><a href="#ZooKeeper-amp-Kafka-配置" class="headerlink" title="ZooKeeper &amp; Kafka 配置"></a>ZooKeeper &amp; Kafka 配置</h2><h3 id="01-ZooKeeper"><a href="#01-ZooKeeper" class="headerlink" title="01. ZooKeeper"></a>01. ZooKeeper</h3><ul>
<li>Repo Point<br><a href="http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/0.10.2.1/kafka_2.11-0.10.2.1.tgz" target="_blank" rel="noopener">kafka_2.11-0.10.2.1.tgz</a><br><a href="http://archive.apache.org/dist/zookeeper/zookeeper-3.4.11/zookeeper-3.4.11.tar.gz" target="_blank" rel="noopener">ZooKeeper</a></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-环境包-rz-至相关路径，分流至其它节点："><a href="#1-环境包-rz-至相关路径，分流至其它节点：" class="headerlink" title="1. 环境包 rz 至相关路径，分流至其它节点："></a>1. 环境包 rz 至相关路径，分流至其它节点：</h4><h5 id="源码分发"><a href="#源码分发" class="headerlink" title="源码分发"></a>源码分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave1:/usr/<span class="built_in">local</span>/src/</span><br><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave2:/usr/<span class="built_in">local</span>/src/</span><br></pre></td></tr></table></figure>
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/20191219-1545-ZooKeeper-Kafka/" data-id="ck4mw85jf0008awu65lelexzr"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ZooKeeper-Kafka/" rel="tag">ZooKeeper Kafka</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191218-2224-MURA-Excel" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/18/20191218-2224-MURA-Excel/"
    >20191218-2224-MURA-Excel</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/18/20191218-2224-MURA-Excel/" class="article-date">
  <time datetime="2019-12-18T14:24:35.000Z" itemprop="datePublished">2019-12-18</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      <h2 id="Execl-数据分析"><a href="#Execl-数据分析" class="headerlink" title="Execl 数据分析"></a>Execl 数据分析</h2><h3 id="01-数据验证"><a href="#01-数据验证" class="headerlink" title="01. 数据验证"></a>01. 数据验证</h3><p>通过 <strong>数据验证</strong> 填充数据</p>
<p><code>Excel</code> 的 <strong>数据验证</strong> 选项是在 <strong>数据</strong> 目录下：<br><img src="Excel-数据验证.png" width="100" title="数据验证." alt="数据验证."></p>
<!-- ![001-数据验证-w001](/image/Excel-数据验证.png) -->


<h3 id="02-快速选中-amp-快速填充"><a href="#02-快速选中-amp-快速填充" class="headerlink" title="02. 快速选中&amp;快速填充"></a>02. 快速选中&amp;快速填充</h3><p>ctrl + shift + 方向键</p>
<h3 id="03-分类统计"><a href="#03-分类统计" class="headerlink" title="03. 分类统计"></a>03. 分类统计</h3><p>SUMIF(&lt;条件区域&gt;,&lt;条件值&gt;,&lt;待求和区域&gt;)<br>SUMIFS(&lt;待求和区域&gt;,&lt;条件区域1&gt;,&lt;条件值1&gt;,…,&lt;条件区域n&gt;,&lt;条件值n&gt;)</p>
<h3 id="04-函数"><a href="#04-函数" class="headerlink" title="04. 函数"></a>04. 函数</h3><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SUMPRODUCT</span>(<span class="symbol">A3</span>:<span class="symbol">A3</span>,<span class="symbol">B2</span>:<span class="symbol">B3</span>,<span class="symbol">C2</span>:<span class="symbol">C3</span>)</span><br><span class="line"><span class="built_in">SUMPRODUCT</span>((<span class="symbol">A2</span>:<span class="symbol">A3</span>=<span class="string">"2018"</span>)*(<span class="symbol">D2</span>:<span class="symbol">D3</span>=<span class="string">"上海"</span>)*(<span class="symbol">B2</span>:<span class="symbol">B3</span>)*(<span class="symbol">C2</span>:<span class="symbol">C3</span>))</span><br></pre></td></tr></table></figure>


<h3 id="0x-样例分析"><a href="#0x-样例分析" class="headerlink" title="0x. 样例分析"></a>0x. 样例分析</h3><ul>
<li>某顶尖外卖平台数据分析师面试题。现有交易数据表user_goods_table如下：<br>user_name    用户名<br>goods_kind   用户订购的的外卖品类</li>
</ul>
<ul>
<li><p>现在老板想知道每个用户购买的外卖品类偏好分布，并取出每个用户购买最多的外卖品类是哪个。</p>
</li>
<li><p>输出要求如下：<br>user_name    用户名<br>goods_kind   该用户购买的最多外卖品类</p>
</li>
</ul>

      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/18/20191218-2224-MURA-Excel/" data-id="ck4mw85hp0001awu66pcaah8w"
        class="article-share-link">Share</a>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Excel/" rel="tag">Excel</a></li></ul>

    </footer>

  </div>

  

  

  

</article>
    
    <article id="post-20191212_1629_MURA" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2019/12/18/20191212_1629_MURA/"
    >20191212_1629_MURA</a
  >
</h2>
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2019/12/18/20191212_1629_MURA/" class="article-date">
  <time datetime="2019-12-18T14:05:52.479Z" itemprop="datePublished">2019-12-18</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      


      

      
      
      
      <!-- 打赏 -->
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/18/20191212_1629_MURA/" data-id="ck4mw85d40000awu6hlttc633"
        class="article-share-link">Share</a>
      
    </footer>

  </div>

  

  

  

</article>
    
  </article>
  

  
  <nav class="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">NEXT</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>
        &copy;
        2019
        Shinnosuke Guo
      </li>
      <li>
        
        
        
        <a href="https://hexo.io" target="_blank">Hexo</a> Theme <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a> by shenyu
        
      </li>
    </ul>
    <ul class="list-inline">
      <li>
        
      </li>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>
    <div class="to_top">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>
      </div>
    </main>
    
      <aside class="sidebar">
        
        <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Shinnosuke"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Main</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">Tags</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="https://github.com/shinnosuke1028" target="_blank" rel="noopener">About</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
      </aside>
      <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    
  </div>
</div>
      
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>





<script>
  var ayerConfig = {
    mathjax: false
  }
</script>


<script src="/js/ayer.js"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">



<script type="text/javascript" src="https://js.users.51.la/20544303.js"></script>
  
  
  </div>
</body>

</html>