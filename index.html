<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-20191221-1006-Oracle12cR2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/21/20191221-1006-Oracle12cR2/" class="article-date">
  <time datetime="2019-12-21T02:07:17.000Z" itemprop="datePublished">2019-12-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/21/20191221-1006-Oracle12cR2/">20191221_1006-Oracle12cR2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="OCP12c"><a href="#OCP12c" class="headerlink" title="OCP12c"></a>OCP12c</h2><h3 id="01-Oracle12cR2"><a href="#01-Oracle12cR2" class="headerlink" title="01. Oracle12cR2"></a>01. Oracle12cR2</h3><ul>
<li>Repo Point<br>[&lt;Oracle-12.2&gt;linuxx64_12201_database.zip]（<a href="https://www.oracle.com/downloads/software-license-agreement.html#license-lightbox）" target="_blank" rel="noopener">https://www.oracle.com/downloads/software-license-agreement.html#license-lightbox）</a></li>
</ul>
<h3 id="02-runInstaller"><a href="#02-runInstaller" class="headerlink" title="02. runInstaller"></a>02. runInstaller</h3><p><code>To be continued...</code></p>
<h3 id="03-Oracle12c-架构"><a href="#03-Oracle12c-架构" class="headerlink" title="03. Oracle12c 架构"></a>03. Oracle12c 架构</h3><h4 id="实例和内存结构"><a href="#实例和内存结构" class="headerlink" title="实例和内存结构"></a>实例和内存结构</h4><p><code>Instance</code> 实例其实就是物理内存段的一部分，相当于软件进程.<br><code>内核参数</code> 系统内存4G，下面为对应内核配置大小（出自官方白皮书）<br><img src="Linux内核参数.png" title="Linux内核参数" alt="Linux内核参数"></p>
<p>实例内存由下面<strong>两组内存参数</strong>动态调整：<br><code>SGA</code>（total_mem × 80%） × 80%，一般不超过物理内存的1/2.<br><code>PGA</code>（total_mem × 80%） × 20%.</p>
<table>
<thead>
<tr>
<th>×</th>
<th>×</th>
<th>MEM参数</th>
</tr>
</thead>
<tbody><tr>
<td>×</td>
<td>×</td>
<td><code>MEMORY_MAX_TARGET</code>（静态）⬇</td>
</tr>
<tr>
<td><code>SGA_MAX_SIZE</code></td>
<td>×</td>
<td><code>MEMORY_TARGET</code>（动态）⬇</td>
</tr>
<tr>
<td>×</td>
<td><code>SGA_TARGET</code>⬇</td>
<td><code>PGA_AGGREGATE_TARGET</code>⬇</td>
</tr>
<tr>
<td>×</td>
<td><code>DB_CACHE</code> <code>SHARED_POOL</code> <code>LARGE_POOL</code> …</td>
<td></td>
</tr>
</tbody></table>
<img src="RAM.png" title="内存架构" alt="内存架构">

<h4 id="关于SGA和PGA的一点配置总结"><a href="#关于SGA和PGA的一点配置总结" class="headerlink" title="关于SGA和PGA的一点配置总结"></a>关于SGA和PGA的一点配置总结</h4><p><code>Tips</code> 相关总结不一定正确，仍需实验验证.<br>[相关博客：关于oracle11G的自动内存管理MEMORY_TARGET和MEMORY_MAX_TARGET]（<a href="https://blog.csdn.net/fjseryi/article/details/50818843）" target="_blank" rel="noopener">https://blog.csdn.net/fjseryi/article/details/50818843）</a><br><code>MEMORY_MAX_TARGET</code> 参数定义了 <code>MEMORY_TARGET</code> 可以达到的最大值，若未设置，则默认等于 <code>MEMORY_TARGET</code> 的值；该值为数据库初始化参数，不可动态调节，通过调整Spfile中的<code>MEMORY_MAX_TARGET</code>并重启实例，可以达到调整的目的.<br><code>MEMORY_TARGET</code> SGA + PGA. Oracle总共可以使用的共享内存大小，不可超过 <code>MEMORY_MAX_TARGET</code> 的大小，默认为0；该值可以动态调节，无需重启实例.<br><code>动态内存管理</code> 使用动态内存管理时，<code>MEMORY_TARGET</code>下的 <code>SGA_TARGET</code> 和 <code>PGA_AGGREGATE_TARGET</code> 代表它们各自内存区域的<strong>最小设置</strong>，要让Oracle完全控制内存管理，上述两个参数应该设置为0.</p>
<ul>
<li><p><code>MEMORY_TARGET</code>设置为非0值：</p>
<ol>
<li>设置了<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，则两个参数将各自作为最小值，作为各自的初始化目标值.</li>
<li>未设置<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，则根据DB状态按照一个固定比例分配：<br>SGA = MEMORY_TARGET * 60%.<br>PGA_AGGREGATE_TARGET = MEMORY_TARGET * 40%.</li>
<li>仅设置了两个中的一个，则 SGA = MEMORY_TARGET - PGA_AGGREGATE_TARGET；反之类似.</li>
</ol>
</li>
<li><p><code>MEMORY_TARGET</code>设置为0或未设置：</p>
<ol>
<li>设置了<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，则自动调节 <code>SGA</code> 中的 Shared pool、Buffer Cache、Redo Log Buffer、Java Pool、Larger Pool等内存空间的大小；PGA 则依赖 <code>PGA_AGGREGATE_TARGET</code> 的大小。 <code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code> 不能自动增长和自动缩小.</li>
<li>未设置<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code>，第1点<code>SGA</code> 中的各二级内存配置需要被明确设定，<code>SGA</code>/<code>PGA_AGGREGATE_TARGET</code> 不能自动增长和自动缩小.</li>
<li><code>MEMORY_MAX_TARGET</code> 设置而 <code>MEMORY_TARGET</code> = 0，这种情况不太懂？？？</li>
</ol>
</li>
</ul>
<hr>
<h4 id="SGA下的各种缓冲区（二级内存配置）"><a href="#SGA下的各种缓冲区（二级内存配置）" class="headerlink" title="SGA下的各种缓冲区（二级内存配置）"></a>SGA下的各种缓冲区（二级内存配置）</h4><ul>
<li><code>Data Buffer Cache</code> 数据高速缓冲区，又分级为：Dirty Buffer/Free Buffer/Pinned Buffer<br>  → <code>Dirty Buffer</code> 脏缓冲区，当数据库发生 DML（Insert、Update、Delete）操作时，会对缓冲区内容进行修改，这样缓冲区的内容就会和相对应的数据文件不一致，这时，缓冲区标识为“脏缓冲区”.<br>  → <code>Free Buffer</code> 自由缓冲区，当“脏缓冲区”的内容被写入数据文件后，因为该缓冲区与相应数据文件部分内容一致，所以将这些缓冲区称为“自由缓冲区”；当执行 SELECT 语句时，会将对应数据文件部分数据读取到数据高速缓存的相应缓冲区，因为缓冲区与数据块内容完全一致，所以这些缓冲区也被称为“自由缓冲区”.<br>  → <code>Pinned Buffer</code> 忙缓冲区，指服务器进程正在访问的缓冲区.<br>  → 为了防止数据库高速缓冲区空间不够用，Oracle 会将脏缓冲区中的数据写入对应的数据文件中（<code>Redo.log</code>），以腾出空间给新的数据.</li>
</ul>
<p><code>Ex</code> 高速缓冲区的大小管理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 显示高速缓冲区的大小</span></span><br><span class="line"><span class="comment"># "0" 表示数据库自动管理，这里表示设置的是最小值。</span></span><br><span class="line">show parameter db_cache_size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改数据库高速缓冲区大小</span></span><br><span class="line">alter system <span class="built_in">set</span> db_cache_size=500m; </span><br><span class="line"></span><br><span class="line"><span class="comment"># flush缓冲区，生产库慎用</span></span><br><span class="line">alter system flush buffer_cache</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li><code>Redo Log Buffer</code> 重做日志缓冲区（循环文件，redo01.log/redo02.log/redo03.log），由一条条重做项构成.</li>
</ul>
<p><code>初始化参数</code> LOG_BUFFER</p>
<hr>
<ul>
<li><code>Shared Pool</code> SGA的共享池，内含库缓存、数字字典缓冲区（执行计划的依赖来源）等.<br>  <code>数据字典缓冲区</code> 数据库参考信息（数据库结构/用户等）<br>  <code>库高速缓存</code> 共享SQL区和共享PL/SQL区.</li>
</ul>
<p><code>Ex</code> Shared Pool 展示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--当用户执行语句时</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">WHERE</span> empno=<span class="number">7788</span>;</span><br><span class="line"><span class="comment">--Oracle 需要查询数据字典 dba_tables 确定表 emp 是否存在</span></span><br><span class="line"><span class="comment">--如果该表已经存在，还需要查询数据字典 dba_tab_columns 确定列 empno 在表 emp 中是否存在</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> dba_tab_columns <span class="keyword">WHERE</span> column_name = <span class="string">'EMPNO'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--然后才能生成执行语句的过程（执行计划），这些定义在首次查询时存入数据字典高速缓冲区.</span></span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li><code>大型池 Java池 流池</code><br>主要是大型池的大小影响数据备份效率.</li>
</ul>
<hr>
<h4 id="PGA（了解即可）"><a href="#PGA（了解即可）" class="headerlink" title="PGA（了解即可）"></a>PGA（了解即可）</h4><p><code>PGA</code> 私有SQL、会话内存、SQL工作区.</p>
<h4 id="In-Memory-Column-Store"><a href="#In-Memory-Column-Store" class="headerlink" title="In-Memory Column Store"></a>In-Memory Column Store</h4><ul>
<li><code>In-Memory area</code> 适用于：<br>  → 资源表中的行非常多，但查询结果行不多.<br>  → 资源表中的列很多，但查询结果的列很少.<br>  → 查询聚集数据</li>
</ul>
<h4 id="各种进程"><a href="#各种进程" class="headerlink" title="各种进程"></a>各种进程</h4><ul>
<li>用户进程：用户机器上的进程，在服务端体现为进程状态中的LOCAL和非LOCAL.</li>
</ul>
<img src="用户进程.png" title="用户进程" alt="用户进程">

<ul>
<li>后台进程：<code>LGWR</code> <code>DBWn</code> <code>CKPT</code> <code>SMON</code> <code>PMON</code> </li>
</ul>
<h4 id="一次数据更新所要走过的流程"><a href="#一次数据更新所要走过的流程" class="headerlink" title="一次数据更新所要走过的流程"></a>一次数据更新所要走过的流程</h4><p><code>Tips</code> 关于 <code>SGA下的众多二级内存</code>和<code>LGWR</code> <code>DBWn</code> <code>CKPT</code>等进程之间的一点关联和解析</p>
<hr>
<h3 id="04-实例管理"><a href="#04-实例管理" class="headerlink" title="04. 实例管理"></a>04. 实例管理</h3><h4 id="实例加载"><a href="#实例加载" class="headerlink" title="实例加载"></a>实例加载</h4><p><code>NOMOUNT</code><br><code>MOUNT</code><br><code>OPEN</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="实例关闭"><a href="#实例关闭" class="headerlink" title="实例关闭"></a>实例关闭</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="动态性能视图"><a href="#动态性能视图" class="headerlink" title="动态性能视图"></a>动态性能视图</h4><h4 id="ORACLE-HOME-dbs"><a href="#ORACLE-HOME-dbs" class="headerlink" title="$ORACLE_HOME/dbs"></a>$ORACLE_HOME/dbs</h4><p><code>Tips</code> 初始化文件</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/21/20191221-1006-Oracle12cR2/" data-id="ck4ili08c000ih0u637i01ncb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Oracle12c/" rel="tag">Oracle12c</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191220-1940-Hive" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/20/20191220-1940-Hive/" class="article-date">
  <time datetime="2019-12-20T11:40:20.000Z" itemprop="datePublished">2019-12-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/20/20191220-1940-Hive/">20191220-1940_Hive</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="移花接木-Hive"><a href="#移花接木-Hive" class="headerlink" title="移花接木-Hive"></a>移花接木-Hive</h2><h3 id="01-Hive-1-x"><a href="#01-Hive-1-x" class="headerlink" title="01. Hive 1.x"></a>01. Hive 1.x</h3><ul>
<li>Repo Point<br><a href="http://mirror.bit.edu.cn/apache/hive/hive-1.2.2/apache-hive-1.2.2-bin.tar.gz" target="_blank" rel="noopener">apache-hive-1.2.2-bin.tar.gz</a><br><a href="https://downloads.mysql.com/archives/get/file/mysql-connector-java-5.1.44.tar.gz" target="_blank" rel="noopener">mysql-connector-java-5.1.44.tar</a><br><a href="http://archive.apache.org/dist/hive/hive-1.2.2/apache-hive-1.2.2-src.tar.gz" target="_blank" rel="noopener">apache-hive-1.2.2-src.tar.gz</a></li>
</ul>
<h3 id="02-Hive-元素"><a href="#02-Hive-元素" class="headerlink" title="02. Hive 元素"></a>02. Hive 元素</h3><h4 id="元数据-amp-数据"><a href="#元数据-amp-数据" class="headerlink" title="元数据 &amp; 数据"></a>元数据 &amp; 数据</h4><ul>
<li>Hive中的表是纯逻辑表，即<code>元数据</code>；</li>
<li>数据存储在<code>HDFS</code>上，元数据与数据存储分离；</li>
<li>数据计算依赖分布式计算框架 <strong>MapReduce</strong>；</li>
<li>Hive<code>读多写少</code>，从HDFS中读，MR计算，并写回HDFS；<code>不支持数据改写&amp;删除</code>；</li>
<li>用户需指定<code>三个属性</code>用来定义数据格式：<br>列分隔符：空格 ‘,’  ‘\t’<br>行分隔符：’\n’<br>读取数据的方法</li>
</ul>
<h4 id="Hive-架构"><a href="#Hive-架构" class="headerlink" title="Hive 架构"></a>Hive 架构</h4><p><code>CLI</code> <strong><em>Hive</em></strong> / Metastore → hiveserver2(HS2) → <strong><em>Beeline</em></strong><br><code>JDBC</code> <strong><em>Metastore</em></strong> → Java/Python/C++<br><code>WUI</code> apache-hive-0.13.0-src.tar.gz → <strong><em>hive –service hwi</em></strong></p>
<h3 id="03-分桶"><a href="#03-分桶" class="headerlink" title="03. 分桶"></a>03. 分桶</h3><h4 id="有点绕的概念"><a href="#有点绕的概念" class="headerlink" title="有点绕的概念"></a>有点绕的概念</h4><p><code>语法</code> tablesample(bucket x out of y on id)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLESAMPLE (BUCKET x OUT OF y [ON colname])</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/20/20191220-1940-Hive/" data-id="ck4ili089000gh0u66clm8hdt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191220-1347-ubuntu16-04-2-server-amd64" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/20/20191220-1347-ubuntu16-04-2-server-amd64/" class="article-date">
  <time datetime="2019-12-20T05:48:57.000Z" itemprop="datePublished">2019-12-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/20/20191220-1347-ubuntu16-04-2-server-amd64/">20191220_1347_ubuntu16.04.2-server-amd64</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Ubuntu-Server-配置"><a href="#Ubuntu-Server-配置" class="headerlink" title="Ubuntu Server 配置"></a>Ubuntu Server 配置</h2><h3 id="01-Ubuntu16-04-2-Server-amd64"><a href="#01-Ubuntu16-04-2-Server-amd64" class="headerlink" title="01. Ubuntu16.04.2-Server-amd64"></a>01. Ubuntu16.04.2-Server-amd64</h3><ul>
<li>Repo Point<br><a href="http://old-releases.ubuntu.com/releases/16.04.2/ubuntu-16.04.2-server-amd64.iso" target="_blank" rel="noopener">ubuntu-16.04.2-server-amd64.iso</a><br><code>Tips</code> <strong>最新的版本已到19.01</strong></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-Ubuntu16-04-2-Server-amd64"><a href="#1-Ubuntu16-04-2-Server-amd64" class="headerlink" title="1. Ubuntu16.04.2-Server-amd64"></a>1. Ubuntu16.04.2-Server-amd64</h4><h5 id="服务器BOIS启动"><a href="#服务器BOIS启动" class="headerlink" title="服务器BOIS启动"></a>服务器BOIS启动</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F2、F12或 Del 进BOIS</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部分前置的选项包括语言、键盘语言&amp;布局、用户描述、非root用户账密、时区等</span></span><br></pre></td></tr></table></figure>

<h4 id="2-LVM"><a href="#2-LVM" class="headerlink" title="2. LVM"></a>2. LVM</h4><p><code>Tips</code> <a href="https://help.ubuntu.com/lts/serverguide/advanced-installation.html" target="_blank" rel="noopener">https://help.ubuntu.com/lts/serverguide/advanced-installation.html</a></p>
<h5 id="下面是官方文档步骤，建议使用LVM配置除了-boot外的所有挂载，便于后续LVM扩容"><a href="#下面是官方文档步骤，建议使用LVM配置除了-boot外的所有挂载，便于后续LVM扩容" class="headerlink" title="下面是官方文档步骤，建议使用LVM配置除了/boot外的所有挂载，便于后续LVM扩容."></a>下面是官方文档步骤，建议使用LVM配置除了/boot外的所有挂载，便于后续LVM扩容.</h5><ol>
<li>Follow the installation steps until you get to the Partition disks step, then: At the “Partition Disks screen choose “Manual”.</li>
</ol>
<ul>
<li>选择分区手动配置.</li>
</ul>
<hr>
<ol start="2">
<li>Select the hard disk and on the next screen choose “yes” to “Create a new empty partition table on this device”.</li>
</ol>
<ul>
<li>选择在磁盘上创建新的分区.</li>
</ul>
<hr>
<ol start="3">
<li>Next, create standard /boot, swap, and / partitions with whichever filesystem you prefer.</li>
</ol>
<ul>
<li>先手动建立 <code>/boot</code> 分区，剩余所有大小全部配置为 <code>LVM</code> 逻辑卷.</li>
</ul>
<hr>
<ol start="4">
<li>For the LVM /srv, create a new Logical partition. Then change “Use as” to “physical volume for LVM” then “Done setting up the partition”.</li>
</ol>
<ul>
<li>LVM内按照自己的需求进行生成和挂载，选择 “physical volume for LVM”.</li>
</ul>
<hr>
<ol start="5">
<li>Now select “Configure the Logical Volume Manager” at the top, and choose “Yes” to write the changes to disk.</li>
</ol>
<ul>
<li>磁盘分切完后(/boot &amp; LVM)，进入LVM管理配置，开始配置划分后的LVM磁盘.</li>
</ul>
<hr>
<ol start="6">
<li>For the “LVM configuration action” on the next screen, choose “Create volume group”. Enter a name for the VG such as vg01, or something more descriptive. After entering a name, select the partition configured for LVM, and choose “Continue”.</li>
</ol>
<ul>
<li>顺序：<code>PV(Free physical volumes) → VG → LV</code> 此处应该可以从配置项里看到可用的PV，选择创建命名VG(例如：vg01).</li>
</ul>
<hr>
<ol start="7">
<li>Back at the “LVM configuration action” screen, select “Create logical volume”. Select the newly created volume group, and enter a name for the new LV, for example srv since that is the intended mount point. Then choose a size, which may be the full partition because it can always be extended later. Choose “Finish” and you should be back at the main “Partition Disks” screen.</li>
</ol>
<ul>
<li>根据自己的需求，将创建好的VG分切至各个LV，并取名(例如：swap、root).</li>
</ul>
<hr>
<ol start="8">
<li>Now add a filesystem to the new LVM. Select the partition under “LVM VG vg01, LV srv”, or whatever name you have chosen, the choose Use as. Setup a file system as normal selecting /srv as the mount point. Once done, select “Done setting up the partition”.</li>
</ol>
<ul>
<li>到这里，LVM已按照需求划分为不同分区，现在要做的就是挂载到对应的目录下，按照先前的命名，一一对应挂载.</li>
</ul>
<hr>
<ol start="9">
<li>Finally, select “Finish partitioning and write changes to disk”. Then confirm the changes and continue with the rest of the installation.</li>
</ol>
<ul>
<li>Finish.</li>
</ul>
<hr>
<h5 id="具体磁盘配置步骤"><a href="#具体磁盘配置步骤" class="headerlink" title="具体磁盘配置步骤"></a><strong>具体磁盘配置步骤</strong></h5><img src="1.png" title="01" alt="">

<hr>
<img src="2.png" title="02" alt="">

<hr>
<img src="3.png" title="03" alt="">

<hr>
<img src="4.png" title="单独建立/boot" alt="">

<hr>
<img src="5.png" title="单独建立/boot" alt="">

<hr>
<img src="6.png" title="单独建立/boot" alt="">

<hr>
<img src="7.png" title="单独建立/boot" alt="">

<hr>
<img src="8.png" title="08" alt="">

<hr>
<img src="9.png" title="09" alt="">

<hr>
<img src="10.png" title="10" alt="">

<hr>
<img src="11.png" title="11" alt="">

<hr>
<img src="12.png" title="12" alt="">

<hr>
<img src="13.png" title="13" alt="">

<hr>
<img src="14.png" title="14" alt="">

<hr>
<img src="15.png" title="15" alt="">

<hr>
<img src="16.png" title="16" alt="">

<hr>
<img src="17.png" title="17" alt="">

<hr>
<img src="18.png" title="18" alt="">

<hr>
<img src="19.png" title="19" alt="">

<hr>
<img src="20.png" title="20" alt="">

<hr>
<img src="21.png" title="21" alt="">

<hr>
<img src="22.png" title="配置完成后的挂载" alt="">

<hr>
<img src="23.png" title="23" alt="">

<hr>
<img src="24.png" title="24" alt="">

<hr>
<img src="25.png" title="25" alt="">

<hr>
<img src="26.png" title="26" alt="">

<hr>
<img src="27.png" title="27" alt="">

<hr>
<img src="28.png" title="28" alt="">

<hr>
<img src="29.png" title="29" alt="">

<hr>
<img src="30.png" title="不自动更新" alt="">

<hr>
<img src="31.png" title="31" alt="">

<hr>
<img src="32.png" title="Install GRUB boot loader" alt="">

<hr>
<img src="33.png" title="Install GRUB boot loader" alt="">

<hr>
<img src="34.png" title="Finish!" alt="">

<hr>
<h5 id="安装过程完成后会自动reboot"><a href="#安装过程完成后会自动reboot" class="headerlink" title="安装过程完成后会自动reboot."></a>安装过程完成后会自动reboot.</h5><img src="35.png" title="Finish!" alt="">


<h4 id="3-静态IP"><a href="#3-静态IP" class="headerlink" title="3. 静态IP"></a>3. 静态IP</h4><h5 id="配置root用户"><a href="#配置root用户" class="headerlink" title="配置root用户"></a>配置root用户</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置静态IP</span></span><br><span class="line">ubuntu@ubuntu:~$ sudo vim /etc/network/interfaces</span><br><span class="line">[sudo] password <span class="keyword">for</span> ubuntu: </span><br><span class="line"><span class="comment"># interfaces</span></span><br><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto ens33                 ⬅ 网关自启</span><br><span class="line"><span class="comment"># iface ens33 inet dhcp</span></span><br><span class="line">iface ens33 inet static</span><br><span class="line">address 192.168.73.21      ⬅ 内网静态IP</span><br><span class="line">gateway 192.168.73.2       ⬅ 内网网关</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">network 192.168.73.0       ⬅ 子网IP</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置DNS</span></span><br><span class="line">ubuntu@ubuntu:~$ sudo vim /etc/resolv.conf </span><br><span class="line"><span class="comment"># resolv.conf</span></span><br><span class="line"><span class="comment"># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</span></span><br><span class="line"><span class="comment">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span></span><br><span class="line"><span class="comment"># nameserver 192.168.73.2</span></span><br><span class="line"><span class="comment"># search localdomain</span></span><br><span class="line">nameserver 202.96.128.86</span><br><span class="line">nameserver 114.114.114.114</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启网络</span></span><br><span class="line">ubuntu@ubuntu:~$ sudo service networking restart</span><br></pre></td></tr></table></figure>


<h5 id="4-上述配置正确，此时就可以用客户端进行连接"><a href="#4-上述配置正确，此时就可以用客户端进行连接" class="headerlink" title="4.上述配置正确，此时就可以用客户端进行连接"></a>4.上述配置正确，此时就可以用客户端进行连接</h5><h5 id="5-root用户激活"><a href="#5-root用户激活" class="headerlink" title="5. root用户激活"></a>5. root用户激活</h5><p><code>Tips</code> 这一步可以放在第3步执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ubuntu@ubuntu:~$ sudo passwd root</span><br><span class="line">Enter new UNIX password:        ⬅ root </span><br><span class="line">Retype new UNIX password:       ⬅ root</span><br><span class="line">passwd: password updated successfully</span><br><span class="line">ubuntu@ubuntu:~$ su - root</span><br><span class="line">Password:                       ⬅ root</span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment"># </span></span><br><span class="line">root@ubuntu:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/20/20191220-1347-ubuntu16-04-2-server-amd64/" data-id="ck4ili080000ch0u60hwcfv66" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191219-2347-Hadoop-2-6-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/19/20191219-2347-Hadoop-2-6-1/" class="article-date">
  <time datetime="2019-12-19T15:47:55.000Z" itemprop="datePublished">2019-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/19/20191219-2347-Hadoop-2-6-1/">20191219-2347_Hadoop-2.6.1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Hadoop-2-X-配置"><a href="#Hadoop-2-X-配置" class="headerlink" title="Hadoop 2.X 配置"></a>Hadoop 2.X 配置</h2><h3 id="01-Hadoop-2-6-1"><a href="#01-Hadoop-2-6-1" class="headerlink" title="01. Hadoop 2.6.1"></a>01. Hadoop 2.6.1</h3><ul>
<li>Repo Point<br><a href="http://archive.apache.org/dist/hadoop/common/hadoop-2.6.1/hadoop-2.6.1.tar.gz" target="_blank" rel="noopener">hadoop-2.6.1.tar.gz</a></li>
</ul>
<h3 id="02-环境配置-部分Linux基础环境配置暂未罗列，如host、jdk等"><a href="#02-环境配置-部分Linux基础环境配置暂未罗列，如host、jdk等" class="headerlink" title="02. 环境配置(部分Linux基础环境配置暂未罗列，如host、jdk等)"></a>02. 环境配置(部分Linux基础环境配置暂未罗列，如host、jdk等)</h3><h4 id="1-环境包-rz-至相关路径，分流至其它节点："><a href="#1-环境包-rz-至相关路径，分流至其它节点：" class="headerlink" title="1. 环境包 rz 至相关路径，分流至其它节点："></a>1. 环境包 rz 至相关路径，分流至其它节点：</h4><h5 id="组件-amp-源码分发"><a href="#组件-amp-源码分发" class="headerlink" title="组件&amp;源码分发"></a>组件&amp;源码分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件解压：hadoop-2.6.1/etc/hadoop</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/</span><br><span class="line">tar -xvf hadoop-2.6.1.tar.gz</span><br></pre></td></tr></table></figure>

<h5 id="当前用户环境变量"><a href="#当前用户环境变量" class="headerlink" title="当前用户环境变量"></a>当前用户环境变量</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># ~/.bashrc</span></span><br><span class="line"><span class="comment"># SET JAVA PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># SET HADOOP PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET HIVE PATH</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SCALA PATH</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET INI PATH</span></span><br><span class="line"><span class="built_in">export</span> INI_PATH=/usr/<span class="built_in">local</span>/src</span><br><span class="line"><span class="comment"># SET SPARK PATH</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line">scp ~/.bashrc root@slave1 ~/.bashrc</span><br><span class="line">scp ~/.bashrc root@slave2 ~/.bashrc</span><br><span class="line"><span class="comment"># 节点分发&amp;生效</span></span><br><span class="line">ssh slave1</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">ssh slave2</span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure>

<h5 id="配置文件修改-amp-相关文件夹创建"><a href="#配置文件修改-amp-相关文件夹创建" class="headerlink" title="配置文件修改&amp;相关文件夹创建"></a>配置文件修改&amp;相关文件夹创建</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/etc/hadoop</span><br><span class="line">vim hadoop-env.sh</span><br><span class="line"><span class="comment"># hadoop-env.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim yarn-env.sh</span><br><span class="line"><span class="comment"># yarn-env.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim slaves</span><br><span class="line"><span class="comment"># 配置节点</span></span><br><span class="line"><span class="comment"># slaves</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim core-site.xml</span><br><span class="line"><span class="comment"># 配置master节点IP及Hadoop临时文件根目录tmp</span></span><br><span class="line"><span class="comment"># core-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim hdfs-site.xml</span><br><span class="line"><span class="comment"># 配置namenode/datanode/replication（备份）文件目录</span></span><br><span class="line"><span class="comment"># hdfs-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim mapred-site.xml</span><br><span class="line"><span class="comment"># mapred-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">vim yarn-site.xml</span><br><span class="line"><span class="comment"># yarn-site.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Hadoop临时目录和文件目录</span></span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/tmp</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/dfs/name</span><br><span class="line">mkdir -p /usr/<span class="built_in">local</span>/src/hadoop-2.6.1/dfs/data</span><br></pre></td></tr></table></figure>


<h5 id="主节点配置好的-Hadoop-源码分发至集群其余节点"><a href="#主节点配置好的-Hadoop-源码分发至集群其余节点" class="headerlink" title="主节点配置好的 Hadoop 源码分发至集群其余节点"></a>主节点配置好的 Hadoop 源码分发至集群其余节点</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /usr/<span class="built_in">local</span>/src/hadoop-2.6.1 root@slave1:/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line">scp /usr/<span class="built_in">local</span>/src/hadoop-2.6.1 root@slave2:/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br></pre></td></tr></table></figure>

<h3 id="03-Hadoop集群初始化-启动-关闭"><a href="#03-Hadoop集群初始化-启动-关闭" class="headerlink" title="03. Hadoop集群初始化/启动/关闭"></a>03. Hadoop集群初始化/启动/关闭</h3><h4 id="集群格式化-集群启动-JAVA进程查看-集群关闭"><a href="#集群格式化-集群启动-JAVA进程查看-集群关闭" class="headerlink" title="集群格式化/集群启动/JAVA进程查看/集群关闭"></a>集群格式化/集群启动/JAVA进程查看/集群关闭</h4><p><code>Tips</code> 初始化只需要做一次！！！</p>
<h5 id="格式化Hadoop-NN"><a href="#格式化Hadoop-NN" class="headerlink" title="格式化Hadoop(NN)"></a>格式化Hadoop(NN)</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line">hadoop namenode -format</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line">./start-all.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭集群</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/sbin</span><br><span class="line">./stop-all.ssh</span><br></pre></td></tr></table></figure>

<h5 id="jps查看集群状态"><a href="#jps查看集群状态" class="headerlink" title="jps查看集群状态"></a>jps查看集群状态</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@master bin]<span class="comment"># jps</span></span><br><span class="line">2784 NameNode       ⬅ NN</span><br><span class="line">3122 ResourceManager    ⬅ RM</span><br><span class="line">13827 Jps</span><br><span class="line">6853 Master     ⬅ (这个为Spark集群启动标识，Hadoop启动时不包括)</span><br><span class="line">2943 SecondaryNameNode  ⬅ Secondary Bak NN</span><br><span class="line">[root@master bin]<span class="comment"># </span></span><br><span class="line">[root@master bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/20191219-2347-Hadoop-2-6-1/" data-id="ck4ili086000eh0u65s7celiu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hadoop-2-X/" rel="tag">Hadoop 2.X</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191219-2254-Hive-1-x" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/19/20191219-2254-Hive-1-x/" class="article-date">
  <time datetime="2019-12-19T14:55:20.000Z" itemprop="datePublished">2019-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/19/20191219-2254-Hive-1-x/">20191219-2254_Hive-1.x</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Hive-配置"><a href="#Hive-配置" class="headerlink" title="Hive 配置"></a>Hive 配置</h2><h3 id="01-Hive-1-x"><a href="#01-Hive-1-x" class="headerlink" title="01. Hive 1.x"></a>01. Hive 1.x</h3><ul>
<li>Repo Point<br><a href="http://mirror.bit.edu.cn/apache/hive/hive-1.2.2/apache-hive-1.2.2-bin.tar.gz" target="_blank" rel="noopener">apache-hive-1.2.2-bin.tar.gz</a><br><a href="https://downloads.mysql.com/archives/get/file/mysql-connector-java-5.1.44.tar.gz" target="_blank" rel="noopener">mysql-connector-java-5.1.44.tar</a></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-环境包"><a href="#1-环境包" class="headerlink" title="1. 环境包"></a>1. 环境包</h4><h5 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h5><p><code>Tips</code> 记得安装JDBC连接器mysql-connector-java-5.1.44-bin.jar，并将Hive和Hadoop侧的jline版本同步！！！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解压并拷贝MySQL-jdbc的jar包至 $Hive/libs下：</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src</span><br><span class="line">tar -zxvf mysql-connector-java-5.1.44.tar</span><br><span class="line">cp /usr/<span class="built_in">local</span>/src/mysql-connector-java-5.1.44/mysql-connector-java-5.1.44-bin.jar <span class="variable">$HIVE_HOME</span>/lib/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入yarn下的lib查看Hadoop-2.6.1自带的jline版本：</span></span><br><span class="line">ll <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/*jline*</span><br><span class="line"><span class="comment">#发现Jjline版本过低：jline-0.9.94.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入Hive下的lib查看Hive-1.2.2自带的jline版本：</span></span><br><span class="line">ll <span class="variable">$HIVE_HOME</span>/lib/*jline*</span><br><span class="line"><span class="comment"># jline-2.12.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份Hadoop侧的jline，用Hive侧的jline替代：</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br><span class="line">mv jline-0.9.94.jar jline-0.9.94.jar.old</span><br><span class="line"></span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/lib/jline-2.12.jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br><span class="line"><span class="comment"># 替换后检查</span></span><br><span class="line">ll <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/jline*</span><br></pre></td></tr></table></figure>

<h5 id="配置文件修改-amp-相关文件夹创建"><a href="#配置文件修改-amp-相关文件夹创建" class="headerlink" title="配置文件修改&amp;相关文件夹创建"></a>配置文件修改&amp;相关文件夹创建</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对应创建Hive配置文件中配置的文件夹：</span></span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/warehouse</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/tmp</span><br><span class="line">mkdir /usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户环境变量，添加Hive路径：</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment"># ~/.bashrc</span></span><br><span class="line"><span class="comment"># SET JAVA PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># SET HADOOP PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET HIVE PATH</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SCALA PATH</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET INI PATH</span></span><br><span class="line"><span class="built_in">export</span> INI_PATH=/usr/<span class="built_in">local</span>/src</span><br><span class="line"><span class="comment"># SET SPARK PATH</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生效</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># Hive log位置配置</span></span><br><span class="line">mv hive-log4j.properties.template hive-log4j.propertie</span><br><span class="line"><span class="comment"># Hive exec-log位置配置(貌似没有任务执行日志生成？？？)</span></span><br><span class="line">mv hive-exec-log4j.properties.template hive-exec-log4j.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加JDK/Hadoop/Hive家目录/Hive配置文件路径 </span></span><br><span class="line">cp hive-env.sh.template hive-env.sh</span><br><span class="line"><span class="comment"># hive-env.sh</span></span><br><span class="line"><span class="comment"># Folder containing extra ibraries required for hive compilation/execution can be controlled by:</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> HIVE_CONF_DIR=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/conf</span><br><span class="line"><span class="comment">######</span></span><br></pre></td></tr></table></figure>

<h5 id="Hive配置的文件需要手动新建，修改MySQL连接信息-amp-更新多组文件夹路径"><a href="#Hive配置的文件需要手动新建，修改MySQL连接信息-amp-更新多组文件夹路径" class="headerlink" title="Hive配置的文件需要手动新建，修改MySQL连接信息&amp;更新多组文件夹路径"></a>Hive配置的文件需要手动新建，修改MySQL连接信息&amp;更新多组文件夹路径</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">touch hive-site.xml </span><br><span class="line"><span class="comment"># hive-site.xml</span></span><br><span class="line"><span class="comment"># 目前仅配置这么多，还有其他配置尚未添加</span></span><br><span class="line"><span class="comment"># javax.jdo.option.ConnectionURL: Hive使用MySQL作为 Metadata 存储时(MySql为5.7.12版本)，需要在连接串中指定是否采用SSL连接</span></span><br><span class="line">Tips：mysql -V	java -version</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;jdbc:mysql://master:3306/hive?createDatabaseIfNotExist=<span class="literal">true</span>&amp;amp;useSSL=<span class="literal">false</span>&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Warning disabled.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;root&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;123456&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/warehouse&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.exec.scratchdir&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/tmp&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.querylog.location&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin/<span class="built_in">log</span>&lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.cli.print.header&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Whether to <span class="built_in">print</span> the names of the columns <span class="keyword">in</span> query output.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.cli.print.current.db&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;<span class="literal">true</span>&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Whether to include the current database <span class="keyword">in</span> the Hive prompt.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property&gt;</span><br><span class="line">                &lt;name&gt;hive.metastore.uris&lt;/name&gt;</span><br><span class="line">                &lt;value&gt;thrift://master:9083&lt;/value&gt;</span><br><span class="line">                &lt;description&gt;Path <span class="keyword">for</span> Hive metadata.&lt;/description&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>




<h5 id="Beeline连接Hive"><a href="#Beeline连接Hive" class="headerlink" title="Beeline连接Hive"></a>Beeline连接Hive</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置了hive.metastore.uris后需开启 Metastore</span></span><br><span class="line"><span class="comment"># 后缀为重定向，需百度解决</span></span><br><span class="line">hive --service metastore  1&gt;/dev/null  2&gt;&amp;1  &amp;</span><br><span class="line"><span class="comment"># beeline方式连接Hive，默认端口为10000</span></span><br><span class="line">hive --service hiveserver2</span><br><span class="line"><span class="comment">#beeline</span></span><br><span class="line"><span class="comment">#!connect jdbc:hive2://master:10000 root 123456</span></span><br><span class="line">beeline -u jdbc:hive2://master:10000 -n root -p 123456 --color=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><code>Tips</code> <strong>退出当前jdbc:</strong> !close    <strong>退出Beeline:</strong> !q  <strong>查询表:</strong>!tables</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/20191219-2254-Hive-1-x/" data-id="ck4ili07u000bh0u6hk5w7qkv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191219-1545-Spark" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/19/20191219-1545-Spark/" class="article-date">
  <time datetime="2019-12-19T08:18:41.000Z" itemprop="datePublished">2019-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/19/20191219-1545-Spark/">20191219_1545_SPARK</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Spark-配置"><a href="#Spark-配置" class="headerlink" title="Spark 配置"></a>Spark 配置</h2><h3 id="01-Spark"><a href="#01-Spark" class="headerlink" title="01. Spark"></a>01. Spark</h3><ul>
<li>Repo Point<br><a href="http://archive.apache.org/dist/spark/spark-2.0.2/spark-2.0.2-bin-hadoop2.6.tgz" target="_blank" rel="noopener">spark-2.0.2-bin-hadoop2.6.tgz</a></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-环境包-rz-至相关路径，分流至其它节点"><a href="#1-环境包-rz-至相关路径，分流至其它节点" class="headerlink" title="1. 环境包 rz 至相关路径，分流至其它节点"></a>1. 环境包 rz 至相关路径，分流至其它节点</h4><h5 id="源码分发"><a href="#源码分发" class="headerlink" title="源码分发"></a>源码分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave1:/usr/<span class="built_in">local</span>/src/</span><br><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave2:/usr/<span class="built_in">local</span>/src/</span><br></pre></td></tr></table></figure>

<h4 id="2-用户环境变量配置"><a href="#2-用户环境变量配置" class="headerlink" title="2. 用户环境变量配置"></a>2. 用户环境变量配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SET JAVA PATH</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment"># SET HADOOP PATH</span></span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HADOOP_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET HIVE PATH</span></span><br><span class="line"><span class="built_in">export</span> HIVE_HOME=/usr/<span class="built_in">local</span>/src/apache-hive-1.2.2-bin</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$HIVE_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SCALA PATH</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SCALA_HOME</span>/bin</span><br><span class="line"><span class="comment"># SET SPARK PATH</span></span><br><span class="line"><span class="built_in">export</span> SPARK_HOME=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$SPARK_HOME</span>/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># SET INI PATH</span></span><br><span class="line"><span class="built_in">export</span> INI_PATH=/usr/<span class="built_in">local</span>/src</span><br></pre></td></tr></table></figure>
<h5 id="环境变量分发"><a href="#环境变量分发" class="headerlink" title="环境变量分发"></a>环境变量分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp ~/.bashrc root@slave1:~/</span><br><span class="line">scp ~/.bashrc root@slave2:~/</span><br></pre></td></tr></table></figure>

<h4 id="3-修改-SPARK-源码环境配置文件、添加集群节点："><a href="#3-修改-SPARK-源码环境配置文件、添加集群节点：" class="headerlink" title="3. 修改 SPARK 源码环境配置文件、添加集群节点："></a>3. 修改 SPARK 源码环境配置文件、添加集群节点：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6/conf/</span><br><span class="line">mv spark-env.sh.template spark-env.sh</span><br><span class="line">vim spark-env.sh</span><br><span class="line"><span class="comment"># spark-env.sh</span></span><br><span class="line"><span class="built_in">export</span> SCALA_HOME=/usr/<span class="built_in">local</span>/src/scala-2.11.8</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/src/jdk1.8.0_201</span><br><span class="line"><span class="built_in">export</span> HADOOP_HOME=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1</span><br><span class="line"><span class="built_in">export</span> HADOOP_CONF_DIR=/usr/<span class="built_in">local</span>/src/hadoop-2.6.1/etc/hadoop</span><br><span class="line">SPARK_MASTER_IP=master</span><br><span class="line">SPARK_LOCAL_DIRS=/usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6</span><br><span class="line">SPARK_DRIVER_MEMORY=1G</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line">mv slaves.template slaves</span><br><span class="line">vim slaves</span><br><span class="line"><span class="comment"># slaves 添加集群节点</span></span><br><span class="line">slave1</span><br><span class="line">slave2</span><br><span class="line"><span class="comment">######</span></span><br></pre></td></tr></table></figure>

<h4 id="4-适配Spark-SQL"><a href="#4-适配Spark-SQL" class="headerlink" title="4. 适配Spark-SQL"></a>4. 适配Spark-SQL</h4><h5 id="MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：MySQL配置"><a href="#MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：MySQL配置" class="headerlink" title="MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：MySQL配置"></a>MySQL相关配置和赋权见相关Blog，此处暂时不进行罗列：<a href="">MySQL配置</a></h5><p>修改 $HIVE_HOME/bin下的Hive启动脚本 <strong><code>hive</code></strong>：<br><code>Tips</code> <strong>SPARK2.0</strong> 中没有 <code>${SPARK_HOME}/lib/spark-assembly-*.jar</code>，<strong>lib</strong>文件中的jar包已经被分成多个小的jar包在放置在 <code>${SPARK_HOME}/jars/</code> 下.</p>
<h5 id="修改前："><a href="#修改前：" class="headerlink" title="修改前："></a>修改前：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add SPARK assembly jar to the classpath</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="string">"<span class="variable">$SPARK_HOME</span>"</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  sparkAssemblyPath=`ls <span class="variable">$&#123;SPARK_HOME&#125;</span>/lib/spark-assembly-*.jar`</span><br><span class="line">  CLASSPATH=<span class="string">"<span class="variable">$&#123;CLASSPATH&#125;</span>:<span class="variable">$&#123;sparkAssemblyPath&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h5 id="YARN-Hadoop-2-0-内的："><a href="#YARN-Hadoop-2-0-内的：" class="headerlink" title="YARN (Hadoop 2.0) 内的："></a>YARN (Hadoop 2.0) 内的：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add SPARK assembly jar to the classpath</span></span><br><span class="line"><span class="keyword">if</span> [[ -n <span class="string">"<span class="variable">$SPARK_HOME</span>"</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  sparkAssemblyPath=`ls <span class="variable">$&#123;SPARK_HOME&#125;</span>/jars/*.jar`</span><br><span class="line">  CLASSPATH=<span class="string">"<span class="variable">$&#123;CLASSPATH&#125;</span>:<span class="variable">$&#123;sparkAssemblyPath&#125;</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h4 id="5-更新Hadoop-Yarn下的老版-jline-0-9-94-jar"><a href="#5-更新Hadoop-Yarn下的老版-jline-0-9-94-jar" class="headerlink" title="5. 更新Hadoop Yarn下的老版 jline-0.9.94.jar"></a>5. 更新Hadoop Yarn下的老版 <strong>jline-0.9.94.jar</strong></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hive内较新版本的jline替换Hadoop内的OLD版本</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br><span class="line">mv jline-0.9.94.jar jline-0.9.94.jar.old</span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/lib/jline-2.12.jar <span class="variable">$HADOOP_HOME</span>/share/hadoop/yarn/lib/</span><br></pre></td></tr></table></figure>

<h4 id="6-Hive集成Spark-SQL"><a href="#6-Hive集成Spark-SQL" class="headerlink" title="6. Hive集成Spark-SQL"></a>6. Hive集成Spark-SQL</h4><p><code>Tips</code> 这部分集成后的功能暂未进行操作</p>
<h5 id="hive-site-xml-内新增-Metastore-配置"><a href="#hive-site-xml-内新增-Metastore-配置" class="headerlink" title="hive-site.xml 内新增 Metastore 配置"></a>hive-site.xml 内新增 Metastore 配置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="variable">$HIVE_HOME</span>/conf/hive-site.xml</span><br><span class="line"><span class="comment"># hive-site.xml 新增如下内容：</span></span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;hive.metastore.uris&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;thrift://hostname:9083&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line"><span class="comment">######</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将Hive的配置文件拷贝给SPARK</span></span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/conf/hive-site.xml <span class="variable">$SPARK_HOME</span>/conf/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将MySQL下的jdbc驱动包拷贝给SPARK</span></span><br><span class="line">cp <span class="variable">$HIVE_HOME</span>/lib/mysql-connector-java-5.1.44.jar  <span class="variable">$SPARK_HOME</span>/jars/</span><br></pre></td></tr></table></figure>

<h4 id="7-SPARK集群启动-关闭"><a href="#7-SPARK集群启动-关闭" class="headerlink" title="7. SPARK集群启动/关闭"></a>7. SPARK集群启动/关闭</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6/sbin/</span><br><span class="line">./start-all.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭集群：</span></span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6/sbin/</span><br><span class="line">./stop-all.sh</span><br></pre></td></tr></table></figure>

<h5 id="启动-Hive-metastore"><a href="#启动-Hive-metastore" class="headerlink" title="启动 Hive metastore"></a>启动 Hive metastore</h5><p><code>Metedata</code>元数据.<br><code>Metastore</code>Hive客户端连接Metastore元存储服务，Metastore再去连接MySQL来存取 <strong>元数据</strong>。多个客户端连接Hive时，只需要连接Metastore服务即可；即启动后可以用Java、Python等调用该jdbc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hive --service metastore</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$HIVE_HOME</span>/bin/</span><br><span class="line">hive --service metastore  1&gt;/dev/null  2&gt;&amp;1  &amp;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动Spark-SQL的shell交互界面</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SPARK_HOME</span>/bin/</span><br><span class="line">spark-shell --master spark://master:7077</span><br></pre></td></tr></table></figure>
<h5 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h5><p><code>hiveserver2</code>HS2是一个服务端接口，使远程客户端可以执行对Hive的查询并返回结果，HS2提供了新的CLI：Beeline(基于SQLLine)，可以作为Hive jdbc Client端访问HS2.<br><code>hiveserver2</code> 和 <code>Metastore</code>一样同为Thrift Service，区别是否在于前者访问数据，后者访问元数据？？？</p>
<ul>
<li>网上有一部分解释：</li>
</ul>
<ol>
<li><p>若有在 <code>hive-site.xml</code> 中配置 <code>hive.metastore.uris</code>，则 <code>hiveserver2</code> 启动时会去连接配置好的 Metastore 服务(故需开启Metastore服务，其余jdbc访问也需开启该服务)，这种方式最为常用；</p>
</li>
<li><p>配置情况下未启动 <code>Metastore</code>，本地Beeline Client连接会失败；<img src="Spark-error_metastore_beeline.png" alt="配置MS但未开启时，Beeline报错." title="配置MS但未开启时，Beeline报错."> </p>
</li>
<li><p>若未配置，则启动HS2时，会先启动一个 <code>Metastore</code> 服务，然后再启动HS2，便于后续Beeline CLI的连接.</p>
</li>
<li></li>
</ol>
<h5 id="回顾下Beeline连接Hive"><a href="#回顾下Beeline连接Hive" class="headerlink" title="回顾下Beeline连接Hive"></a>回顾下Beeline连接Hive</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置了hive.metastore.uris后需开启 Metastore</span></span><br><span class="line"><span class="comment"># 后缀为重定向，需百度解决</span></span><br><span class="line">hive --service metastore  1&gt;/dev/null  2&gt;&amp;1  &amp;</span><br><span class="line"><span class="comment"># beeline方式连接Hive，默认端口为10000</span></span><br><span class="line">hive --service hiveserver2</span><br><span class="line"><span class="comment">#beeline</span></span><br><span class="line"><span class="comment">#!connect jdbc:hive2://master:10000 root 123456</span></span><br><span class="line">beeline -u jdbc:hive2://master:10000 -n root -p 123456 --color=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><code>Tips</code> 可以单独启动 SPARK 集群，但此时无ResourceManager/NodeManager等进程！！！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/20191219-1545-Spark/" data-id="ck4ili07l0007h0u6d05r2e0b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191219-1545-ZooKeeper-Kafka" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/19/20191219-1545-ZooKeeper-Kafka/" class="article-date">
  <time datetime="2019-12-19T07:47:13.000Z" itemprop="datePublished">2019-12-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/19/20191219-1545-ZooKeeper-Kafka/">20191219_1545_ZooKeeper-Kafka</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ZooKeeper-amp-Kafka-配置"><a href="#ZooKeeper-amp-Kafka-配置" class="headerlink" title="ZooKeeper &amp; Kafka 配置"></a>ZooKeeper &amp; Kafka 配置</h2><h3 id="01-ZooKeeper"><a href="#01-ZooKeeper" class="headerlink" title="01. ZooKeeper"></a>01. ZooKeeper</h3><ul>
<li>Repo Point<br><a href="http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/0.10.2.1/kafka_2.11-0.10.2.1.tgz" target="_blank" rel="noopener">kafka_2.11-0.10.2.1.tgz</a><br><a href="http://archive.apache.org/dist/zookeeper/zookeeper-3.4.11/zookeeper-3.4.11.tar.gz" target="_blank" rel="noopener">ZooKeeper</a></li>
</ul>
<h3 id="02-环境配置"><a href="#02-环境配置" class="headerlink" title="02. 环境配置"></a>02. 环境配置</h3><h4 id="1-环境包-rz-至相关路径，分流至其它节点："><a href="#1-环境包-rz-至相关路径，分流至其它节点：" class="headerlink" title="1. 环境包 rz 至相关路径，分流至其它节点："></a>1. 环境包 rz 至相关路径，分流至其它节点：</h4><h5 id="源码分发"><a href="#源码分发" class="headerlink" title="源码分发"></a>源码分发</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave1:/usr/<span class="built_in">local</span>/src/</span><br><span class="line">scp -r /usr/<span class="built_in">local</span>/src/spark-2.0.2-bin-hadoop2.6 root@slave2:/usr/<span class="built_in">local</span>/src/</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/19/20191219-1545-ZooKeeper-Kafka/" data-id="ck4ili07p0008h0u60ocb46kk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ZooKeeper-Kafka/" rel="tag">ZooKeeper Kafka</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191218-2224-MURA-Excel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/18/20191218-2224-MURA-Excel/" class="article-date">
  <time datetime="2019-12-18T14:24:35.000Z" itemprop="datePublished">2019-12-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/18/20191218-2224-MURA-Excel/">20191218-2224-MURA-Excel</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Execl-数据分析"><a href="#Execl-数据分析" class="headerlink" title="Execl 数据分析"></a>Execl 数据分析</h2><h3 id="01-数据验证"><a href="#01-数据验证" class="headerlink" title="01. 数据验证"></a>01. 数据验证</h3><p>通过 <strong>数据验证</strong> 填充数据</p>
<p><code>Excel</code> 的 <strong>数据验证</strong> 选项是在 <strong>数据</strong> 目录下：<br><img src="Excel-数据验证.png" width="100" title="数据验证." alt="数据验证."></p>
<!-- ![001-数据验证-w001](/image/Excel-数据验证.png) -->


<h3 id="02-快速选中-amp-快速填充"><a href="#02-快速选中-amp-快速填充" class="headerlink" title="02. 快速选中&amp;快速填充"></a>02. 快速选中&amp;快速填充</h3><p>ctrl + shift + 方向键</p>
<h3 id="03-分类统计"><a href="#03-分类统计" class="headerlink" title="03. 分类统计"></a>03. 分类统计</h3><p>SUMIF(&lt;条件区域&gt;,&lt;条件值&gt;,&lt;待求和区域&gt;)<br>SUMIFS(&lt;待求和区域&gt;,&lt;条件区域1&gt;,&lt;条件值1&gt;,…,&lt;条件区域n&gt;,&lt;条件值n&gt;)</p>
<h3 id="04-函数"><a href="#04-函数" class="headerlink" title="04. 函数"></a>04. 函数</h3><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SUMPRODUCT</span>(<span class="symbol">A3</span>:<span class="symbol">A3</span>,<span class="symbol">B2</span>:<span class="symbol">B3</span>,<span class="symbol">C2</span>:<span class="symbol">C3</span>)</span><br><span class="line"><span class="built_in">SUMPRODUCT</span>((<span class="symbol">A2</span>:<span class="symbol">A3</span>=<span class="string">"2018"</span>)*(<span class="symbol">D2</span>:<span class="symbol">D3</span>=<span class="string">"上海"</span>)*(<span class="symbol">B2</span>:<span class="symbol">B3</span>)*(<span class="symbol">C2</span>:<span class="symbol">C3</span>))</span><br></pre></td></tr></table></figure>


<h3 id="0x-样例分析"><a href="#0x-样例分析" class="headerlink" title="0x. 样例分析"></a>0x. 样例分析</h3><ul>
<li>某顶尖外卖平台数据分析师面试题。现有交易数据表user_goods_table如下：<br>user_name    用户名<br>goods_kind   用户订购的的外卖品类</li>
</ul>
<ul>
<li><p>现在老板想知道每个用户购买的外卖品类偏好分布，并取出每个用户购买最多的外卖品类是哪个。</p>
</li>
<li><p>输出要求如下：<br>user_name    用户名<br>goods_kind   该用户购买的最多外卖品类</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/18/20191218-2224-MURA-Excel/" data-id="ck4ili07d0006h0u6ekt9cfrg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Excel/" rel="tag">Excel</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-20191212_1629_MURA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/18/20191212_1629_MURA/" class="article-date">
  <time datetime="2019-12-18T14:05:52.479Z" itemprop="datePublished">2019-12-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/18/20191212_1629_MURA/">20191212_1629_MURA</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/18/20191212_1629_MURA/" data-id="ck4ili04m0000h0u690ha0r7b" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-20191218-1300-Python3-Monitor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/18/20191218-1300-Python3-Monitor/" class="article-date">
  <time datetime="2019-12-18T05:01:29.000Z" itemprop="datePublished">2019-12-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/18/20191218-1300-Python3-Monitor/">20191218_1300_Python3-Monitor</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Python3-Oracle2CSV-Monitor"><a href="#Python3-Oracle2CSV-Monitor" class="headerlink" title="Python3 Oracle2CSV_Monitor"></a>Python3 Oracle2CSV_Monitor</h2><h3 id="01-数据库数据采集-amp-监控"><a href="#01-数据库数据采集-amp-监控" class="headerlink" title="01. 数据库数据采集&amp;监控"></a>01. 数据库数据采集&amp;监控</h3><ul>
<li>Repo Point<br>cx_Oracle<br>csv<br>smtplib, email<br>threading</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author: Shin</span></span><br><span class="line"><span class="comment"># @Date: 2019/11/20 15:14</span></span><br><span class="line"><span class="comment"># @File: class_email_daily3.py</span></span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os, re</span><br><span class="line"><span class="comment"># import math</span></span><br><span class="line"><span class="comment"># from os.path import abspath, join, dirname</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cx_Oracle</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="comment"># import numpy as np</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> email.utils <span class="keyword">import</span> formataddr</span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep, ctime</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD模式运行配置</span></span><br><span class="line"><span class="comment"># from src.func_test.func_f import date_f</span></span><br><span class="line"><span class="comment"># from conf import bas_insert_conf</span></span><br><span class="line"><span class="comment"># from conf import bas_mail_conf</span></span><br><span class="line"><span class="comment"># from conf import sql_conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 非CMD模式运行配置</span></span><br><span class="line"><span class="keyword">from</span> src.conf <span class="keyword">import</span> bas_mail_conf</span><br><span class="line"><span class="keyword">from</span> src.conf <span class="keyword">import</span> sql_conf</span><br><span class="line"><span class="keyword">from</span> src.conf <span class="keyword">import</span> bas_mail_conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># sys.path.insert(0, join(abspath(dirname(__file__)), '../func_test/'))</span></span><br><span class="line">sys.path.append(<span class="string">'./func_test'</span>)</span><br><span class="line"><span class="keyword">from</span> src.func_test.func_f <span class="keyword">import</span> date_f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OracleExecution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="comment"># def __init__(self, sql=None, connect=None, check_style=None):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__connect = <span class="literal">None</span></span><br><span class="line">        self.__sql = <span class="literal">None</span></span><br><span class="line">        self.__check_style = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># self.message_str = ''</span></span><br><span class="line">        self.rs = []</span><br><span class="line">        self.message = <span class="string">''</span></span><br><span class="line">        self.message_data = []</span><br><span class="line">        self.db = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 装饰器用法1：</span></span><br><span class="line">    <span class="comment"># @property</span></span><br><span class="line">    <span class="comment"># def conf_f(self):</span></span><br><span class="line">    <span class="comment">#     return self.__connect, self.__sql, self.__check_style</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># @conf_f.setter</span></span><br><span class="line">    <span class="comment"># def conf_f(self, value):</span></span><br><span class="line">    <span class="comment">#     self.__connect = value[0]</span></span><br><span class="line">    <span class="comment">#     self.__sql = value[1]</span></span><br><span class="line">    <span class="comment">#     self.__check_style = value[2]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 装饰器用法2：&lt;1等价于2&gt;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_conf_f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__connect, self.__sql, self.__check_style</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_conf_f</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.__connect = value[<span class="number">0</span>]</span><br><span class="line">        self.__sql = value[<span class="number">1</span>]</span><br><span class="line">        self.__check_style = value[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    conf_f = property(get_conf_f, set_conf_f)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect_f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.db = cx_Oracle.connect(self.__connect)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f'Status: Failed to connect database.'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">return</span> self.db</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute_f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># db = cx_oracle.connect(self.username + "/" + self.password + "@" +</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cur = self.db.cursor().execute(self.__sql)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f'Status: Failed to execute SQL.\nSQL:  <span class="subst">&#123;self.conf_f[<span class="number">1</span>]&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">            self.db.rollback()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rs = cur.fetchall()</span><br><span class="line">            <span class="comment"># print(self.rs)</span></span><br><span class="line">            <span class="comment"># print(type(self.rs))    # &lt;class 'list'&gt;</span></span><br><span class="line">            <span class="keyword">if</span> self.__check_style == <span class="string">'JOB'</span>:</span><br><span class="line">                data_flag = <span class="number">0</span></span><br><span class="line">                data_flag_bad = <span class="literal">None</span></span><br><span class="line">                i = <span class="number">0</span></span><br><span class="line">                <span class="keyword">for</span> r1 <span class="keyword">in</span> self.rs:</span><br><span class="line">                    <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">                        data_flag = r1[<span class="number">1</span>]</span><br><span class="line">                        <span class="keyword">if</span> data_flag != <span class="number">0</span>:</span><br><span class="line">                            data_flag_bad = r1[<span class="number">0</span>]</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">elif</span> r1[<span class="number">1</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                        data_flag = data_flag + r1[<span class="number">1</span>]</span><br><span class="line">                        <span class="keyword">if</span> data_flag != <span class="number">0</span>:</span><br><span class="line">                            data_flag_bad = data_flag_bad + <span class="string">','</span> + r1[<span class="number">0</span>]</span><br><span class="line">                            <span class="comment"># 这里也可以直接写成 data_flag_bad = data_flag_bad, r1[0]</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        data_flag = data_flag + <span class="number">0</span></span><br><span class="line">                        <span class="keyword">if</span> data_flag != <span class="number">0</span>:</span><br><span class="line">                            data_flag_bad = data_flag_bad + <span class="string">','</span> + r1[<span class="number">0</span>]</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> data_flag != <span class="number">0</span>:</span><br><span class="line">                    self.message = <span class="string">'数据库脚本或定时任务异常,请及时核查.报错任务号：'</span> + str(data_flag_bad)</span><br><span class="line">                    <span class="comment"># print(data_flag_bad)</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.message = <span class="string">'数据库脚本正常执行,详细监测日志请查看附件.'</span></span><br><span class="line">                print(<span class="string">'&lt;'</span> + date_f(<span class="number">0</span>)[<span class="number">1</span>] + <span class="string">'&gt; : '</span> + self.message)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.message = <span class="string">'定时邮件任务完成，详细信息请看附件.'</span></span><br><span class="line">                print(<span class="string">'&lt;'</span> + date_f(<span class="number">0</span>)[<span class="number">1</span>] + <span class="string">'&gt; : '</span> + self.message)</span><br><span class="line">            cur.close()</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.db.close()</span><br><span class="line">            <span class="comment"># print(type(self.message))</span></span><br><span class="line">            <span class="comment"># print(self.rs)</span></span><br><span class="line">            <span class="keyword">return</span> self.message</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute_split_f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># message_data_all = []</span></span><br><span class="line">        <span class="comment"># message_data = []</span></span><br><span class="line">        <span class="keyword">for</span> r1 <span class="keyword">in</span> self.rs:</span><br><span class="line">            <span class="comment"># 如果写成 str(r1), list内的行对象list会变成字符串：list [(),()] -&gt; ["()","()"]</span></span><br><span class="line">            <span class="comment"># 写入时会把每一组对象当成一个个完整的字符串，即一个字母一个数字进一个单元格</span></span><br><span class="line">            <span class="comment"># 要写入.csv的文件，按行转换成最基本的list即可，一行一个list对象&lt;即元组tuple&gt;：list [(),()]；或list嵌套list：[[],[]]</span></span><br><span class="line">            <span class="comment"># 无需转换为str再拼接为数组</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.message_data.append(r1)  <span class="comment"># 数据库拉取出来的一行为一个元组</span></span><br><span class="line">                <span class="comment"># print(f'r1:&#123;r1&#125;')</span></span><br><span class="line">                <span class="comment"># r1:(datetime.datetime(2019, 12, 12, 0, 0), 'HW_4G_CM&lt;OMC1&gt;', '00', 23, 11, 11, 11, 369.36, 357.26,</span></span><br><span class="line">                <span class="comment"># 355.16, 0, -12.1, '数量未变', '大小波动小', '/LTE/MOBILE/HUAWEI/OMC1/CM/')</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># print(self.message_data)</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">        <span class="comment"># print(self.message_data)</span></span><br><span class="line">        <span class="comment"># print(type(self.message_data))</span></span><br><span class="line">        <span class="keyword">return</span> self.message_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileWR</span><span class="params">(OracleExecution)</span>:</span></span><br><span class="line">    <span class="comment"># 初始化子类属性时，需带上父类属性，这种需全部初始化父类属性的写法，用在：调用含父类属性的父类方法时，不然实例化时，无法顺利调用父类方法</span></span><br><span class="line">    <span class="comment"># 调用不含父类属性的父类方法时，可以直接用：super(&lt;子类名&gt;, self).__init__()完成父类初始化</span></span><br><span class="line">    <span class="comment"># def __init__(self, local_file_path=None, title=None, connect=None, sql=None, check_style=None):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, local_file_path=None, title=None)</span>:</span></span><br><span class="line">        <span class="comment"># super(FileWR, self).__init__(connect, sql, check_style)   # 初始化父类属性</span></span><br><span class="line">        <span class="comment"># super(FileWR, self).__init__()</span></span><br><span class="line">        super().__init__()  <span class="comment"># 简写</span></span><br><span class="line">        <span class="comment"># 初始化父类属性，父类属性有默认赋值时，在子类初始化时可以不再指明具体参数</span></span><br><span class="line">        <span class="comment"># 后续实例化时，若子类想调用父类属性，则可以直接调用父类属性并赋值；或写成注释行部分的形式去初始化父类属性，在初始化子类时一并加入父类属性</span></span><br><span class="line">        self.local_file_path = local_file_path</span><br><span class="line">        self.title = title</span><br><span class="line">        <span class="comment"># self.message_data = message_date</span></span><br><span class="line">        self.file_name = <span class="string">''</span>  <span class="comment"># 可以不定义在初始化内，只作为类的私有属性</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">file_write_f</span><span class="params">(self, message_date, job_flag, sleep_seconds=<span class="number">0.001</span>)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.file_name = self.local_file_path + date_f(<span class="number">0</span>)[<span class="number">0</span>] + <span class="string">'_'</span> + job_flag + <span class="string">'.csv'</span></span><br><span class="line">            <span class="comment"># print(self.file_name)</span></span><br><span class="line">            <span class="keyword">with</span> open(self.file_name, <span class="string">'w'</span>, newline=<span class="string">''</span>, encoding=<span class="string">'GBK'</span>) <span class="keyword">as</span> file_1:</span><br><span class="line">                writer_csv = csv.writer(file_1)</span><br><span class="line">                writer_csv.writerow(self.title)</span><br><span class="line">                <span class="keyword">for</span> row <span class="keyword">in</span> tqdm(message_date, ncols=<span class="number">80</span>):</span><br><span class="line">                    <span class="comment"># print([row])</span></span><br><span class="line">                    writer_csv.writerow(row)  <span class="comment"># csv提供的写入方法可以按行写入list，无需按照对象一个个写入，效率更高</span></span><br><span class="line">                    sleep(sleep_seconds)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># for row in tqdm(iterable=message_date, ncols=80):</span></span><br><span class="line">                    <span class="comment">#     writer_csv.writerow(row)  # csv提供的写入方法可以按行写入list，无需按照对象一个个写入，效率更高</span></span><br><span class="line">                    <span class="comment">#     # sleep(0.05)</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment"># file_size = len(message_date)</span></span><br><span class="line">                    <span class="comment"># for row in range(file_size):</span></span><br><span class="line">                    <span class="comment">#     writer_csv.writerow(message_date[row])</span></span><br><span class="line">                    <span class="comment">#     sys.stdout.write('\r[&#123;0&#125;] Percent:&#123;1&#125;%'.format('='*int(row*50/(file_size-1)),</span></span><br><span class="line">                    <span class="comment">#     str(row*100/(file_size-1))))</span></span><br><span class="line">                    <span class="comment">#     if row == file_size:</span></span><br><span class="line">                    <span class="comment">#         sys.stdout.write('\r[&#123;0&#125;] Percent:&#123;1&#125;%'.format('=' * int(100), str(100)))</span></span><br><span class="line">                    <span class="comment">#         print('\n')</span></span><br><span class="line">                    <span class="comment">#     sleep(sleep_seconds)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MailSender</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>  <span class="comment"># 邮件概览/正文/文件名(含路径)</span></span><br><span class="line">        <span class="comment"># self.mail_view = mail_view</span></span><br><span class="line">        <span class="comment"># self.mail_text = mail_text</span></span><br><span class="line">        <span class="comment"># self.mail_title = mail_title</span></span><br><span class="line">        self.mail_attach = []</span><br><span class="line">        <span class="comment"># self.file_name = file_name</span></span><br><span class="line">        self.msg = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># self.attach = None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mail_mime_action</span><span class="params">(self, receivers)</span>:</span></span><br><span class="line">        mail_sender = <span class="string">'shinnosuke1028@qq.com'</span></span><br><span class="line">        mail_password = <span class="string">'ixwzutghdbtxbaie'</span></span><br><span class="line">        mail_server = <span class="string">'smtp.qq.com'</span></span><br><span class="line">        <span class="comment"># subject = 'Python SMTP 邮件测试...&lt;数据完整性监控(日常JOB/采集)&gt;'</span></span><br><span class="line">        subject = <span class="string">'Py-%s &lt;数据完整性监控(日常JOB/昨日采集)&gt;'</span> % date_f(<span class="number">0</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># MIMEMultipart 形式构造邮件正文</span></span><br><span class="line">        self.msg = MIMEMultipart()  <span class="comment"># 开辟一个带邮件的mail接口</span></span><br><span class="line">        self.msg[<span class="string">'From'</span>] = formataddr([<span class="string">'郭皓然测试'</span>, mail_sender])</span><br><span class="line">        self.msg[<span class="string">'To'</span>] = formataddr([<span class="string">','</span>.join(receivers), <span class="string">'utf-8'</span>])  <span class="comment"># 用','进行拼接，待拼接内容：join(x)内的x</span></span><br><span class="line">        self.msg[<span class="string">'Subject'</span>] = Header(subject, <span class="string">'utf-8'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 邮件正文</span></span><br><span class="line">        <span class="comment"># self.msg.attach(MIMEText(message + '\n' + title + message_str, 'plain', 'utf-8'))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 邮件装载附件</span></span><br><span class="line">        <span class="comment"># 1</span></span><br><span class="line">        <span class="comment"># for fn in self.file_name:</span></span><br><span class="line">        <span class="comment">#     attach_tmp = self.msg_attach(fn)</span></span><br><span class="line">        <span class="comment">#     self.mail_attach.append(attach_tmp)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cur_list_re = []</span><br><span class="line">            <span class="keyword">for</span> fn <span class="keyword">in</span> os.walk(bas_mail_conf.mail_file_path_class):</span><br><span class="line">                print(<span class="string">f'fn[-1]: <span class="subst">&#123;fn[<span class="number">-1</span>]&#125;</span>'</span>)  <span class="comment"># ./data_output/*</span></span><br><span class="line">                <span class="keyword">for</span> cur <span class="keyword">in</span> fn[<span class="number">-1</span>]:</span><br><span class="line">                    x = re.search(bas_mail_conf.file_pattern, cur)</span><br><span class="line">                    print(<span class="string">f'cur: <span class="subst">&#123;cur&#125;</span>, x: <span class="subst">&#123;x&#125;</span>'</span>)</span><br><span class="line">                    <span class="comment"># cur: 20191217_PKG.csv, x: None</span></span><br><span class="line">                    <span class="comment"># cur: 20191218_GATHER.csv, x: &lt;re.Match object; span=(0, 19), match='20191218_GATHER.csv'&gt;</span></span><br><span class="line">                    <span class="keyword">if</span> x:</span><br><span class="line">                        cur_list_re.append(bas_mail_conf.mail_file_path_class + x.group())</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> rx <span class="keyword">in</span> cur_list_re:</span><br><span class="line">                <span class="comment"># print(f'rx: &#123;rx&#125;')</span></span><br><span class="line">                tx_tmp = self.msg_attach(rx)</span><br><span class="line">                self.msg.attach(tx_tmp)</span><br><span class="line">            print(<span class="string">f'Status: Mail loaded successfully.'</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f'Status: Failed to load mail...'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            server = smtplib.SMTP(mail_server, <span class="number">25</span>)  <span class="comment"># 发件人邮箱中的SMTP服务器，SMTP服务端口是25</span></span><br><span class="line">            server.login(mail_sender, mail_password)  <span class="comment"># 括号中对应的是发件人邮箱账号、邮箱密码</span></span><br><span class="line">            server.sendmail(mail_sender, receivers, self.msg.as_string())  <span class="comment"># 括号中对应的是发件人邮箱账号、收件人邮箱账号、邮件内容发送</span></span><br><span class="line">            print(<span class="string">'Status: Mail sended successfully.'</span>)</span><br><span class="line">            server.quit()  <span class="comment"># 关闭连接</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">'Status: Failed to send mail...'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">msg_attach</span><span class="params">(self, file_name)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :return:  type(attach): &lt;class 'email.mime.text.MIMEText'&gt; 附件封装结果</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Ex:</span></span><br><span class="line"><span class="string">            att1 = MIMEText(open(file_name, 'rb').read(), 'base64', 'utf-8')</span></span><br><span class="line"><span class="string">            att1["Content-Type"] = 'application/octet-stream'</span></span><br><span class="line"><span class="string">            att1["Content-Disposition"] = 'attachment; filename=' + file_name    # 这里的filename可任意，写什么名字，邮件中显示什么名字</span></span><br><span class="line"><span class="string">            msg.attach(att1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            att2 = MIMEText(open(file_name2, 'rb').read(), 'base64', 'utf-8')</span></span><br><span class="line"><span class="string">            att2["Content-Type"] = 'application/octet-stream'</span></span><br><span class="line"><span class="string">            att2["Content-Disposition"] = 'attachment; filename=' + file_name2    # 这里的filename可任意，写什么名字，邮件中显示什么名字</span></span><br><span class="line"><span class="string">            msg.attach(att2)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        attach = MIMEText(open(file_name, <span class="string">'rb'</span>).read(), <span class="string">'base64'</span>, <span class="string">'utf-8'</span>)</span><br><span class="line">        attach[<span class="string">"Content-Type"</span>] = <span class="string">'application/octet-stream'</span></span><br><span class="line">        attach[<span class="string">"Content-Disposition"</span>] = <span class="string">'attachment; filename='</span> + file_name  <span class="comment"># 这里的filename可任意，写什么名字，邮件中显示什么名字</span></span><br><span class="line">        <span class="comment"># print(f'type(attach): &#123;type(attach)&#125;')</span></span><br><span class="line">        <span class="keyword">return</span> attach</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func=None, args=<span class="params">()</span>)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.func = func</span><br><span class="line">        self.args = args</span><br><span class="line">        self.result = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.result = self.func(*self.args)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_result</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># noinspection PyBroadException</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.result</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f'Status: 线程返回结果.'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>, <span class="string">f'\nError Details:\n<span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">            print(<span class="string">'------------------'</span> * <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################</span></span><br><span class="line"><span class="comment">######################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 以下是装饰器修饰函数的用法，可省略代码的反复加工</span></span><br><span class="line">balance = []</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lock_f</span><span class="params">(lock_flag=<span class="string">'N'</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">threading_f</span><span class="params">(f)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner_f</span><span class="params">(*value)</span>:</span></span><br><span class="line">            print(<span class="string">'Status: 1号装饰器测试开始！'</span>)</span><br><span class="line">            <span class="keyword">global</span> balance, i</span><br><span class="line">            <span class="keyword">if</span> lock_flag == <span class="string">'Y'</span>:</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">                lock = threading.RLock()</span><br><span class="line">                <span class="keyword">with</span> lock:</span><br><span class="line">                    <span class="comment"># r_lock.acquire()</span></span><br><span class="line">                    print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> is running. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">                    result = f(*value)</span><br><span class="line">                    <span class="comment"># pprint.pprint(results)</span></span><br><span class="line">                    <span class="comment"># print(type(results))    # &lt;class 'tuple'&gt;</span></span><br><span class="line">                    balance.append(result)</span><br><span class="line">                    <span class="comment"># r_lock.release()</span></span><br><span class="line">                    print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> end. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">                    print(<span class="string">'1号装饰器测试结束！'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'Status: 1号装饰器不再调用！'</span>)</span><br><span class="line">                print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> is running. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">                result = f(*value)</span><br><span class="line">                balance.append(result)</span><br><span class="line">                print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> end. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">            <span class="comment"># pprint.pprint(result)</span></span><br><span class="line">            <span class="keyword">return</span> balance</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inner_f</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> threading_f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">email_f</span><span class="params">(email_flag=<span class="string">'N'</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mail_post_f</span><span class="params">(f)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner_f</span><span class="params">(*value)</span>:</span></span><br><span class="line">            print(<span class="string">'Status: 2号装饰器测试开始！'</span>)</span><br><span class="line">            <span class="keyword">if</span> email_flag == <span class="string">'Y'</span>:</span><br><span class="line">                print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> is running. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">                results = f(*value)</span><br><span class="line">                <span class="comment"># mail = None</span></span><br><span class="line">                <span class="comment"># 注意: 这里要捕捉的是文件接口,不是数据详情,只需提供返回的文件名即可</span></span><br><span class="line">                <span class="comment"># 部分邮件正文才需要从上述results中获取,这里先不添加正文信息</span></span><br><span class="line">                mail = MailSender()</span><br><span class="line">                mail.mail_mime_action(bas_mail_conf.receivers)</span><br><span class="line"></span><br><span class="line">                print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> end. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">                print(<span class="string">'2号装饰器测试结束！'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'Status: 2号装饰器不再调用！'</span>)</span><br><span class="line">                print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> is running. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">                results = f(*value)</span><br><span class="line">                print(<span class="string">f'Thread <span class="subst">&#123;threading.current_thread().getName()&#125;</span> end. Time: <span class="subst">&#123;ctime()&#125;</span>'</span>)</span><br><span class="line">            <span class="comment"># pprint.pprint(results)</span></span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> inner_f</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mail_post_f</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序编译时优先编译内层装饰器/再编译外层装饰器,编译顺序:email_f -&gt; lock_f</span></span><br><span class="line"><span class="comment"># 执行时,类似于Queue(先进后出),执行顺序:lock_f(执行 f(*value) 之前的内容) -&gt; email_f -&gt; lock_f(f(*value))</span></span><br><span class="line"><span class="meta">@email_f('Y')  # 1号装饰器</span></span><br><span class="line"><span class="meta">@lock_f('Y')  # 2号装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ora_job</span><span class="params">(conf_job, file_path, file_title)</span>:</span></span><br><span class="line">    <span class="comment"># with r_lock:</span></span><br><span class="line">    <span class="comment"># 实例化</span></span><br><span class="line">    ora = FileWR(local_file_path=file_path, title=file_title)</span><br><span class="line">    ora.conf_f = conf_job  <span class="comment"># 列表按顺序，进行数据库检索配置</span></span><br><span class="line">    job_flag = ora.conf_f[<span class="number">2</span>]</span><br><span class="line">    ora.connect_f()</span><br><span class="line">    file_mail_view_tmp = str(ora.execute_f())</span><br><span class="line">    <span class="keyword">del</span> ora.message</span><br><span class="line">    <span class="comment"># print('1:', file_mail_view_tmp)</span></span><br><span class="line">    file_mail_text_tmp = ora.execute_split_f()</span><br><span class="line">    <span class="keyword">del</span> ora.message_data</span><br><span class="line">    <span class="comment"># print(type(file_mail_text_tmp))</span></span><br><span class="line">    ora.file_write_f(file_mail_text_tmp, job_flag, )</span><br><span class="line">    <span class="keyword">return</span> job_flag, file_mail_view_tmp, file_mail_text_tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># print(sys.path)</span></span><br><span class="line">    print(<span class="string">'Thread'</span>, threading.current_thread().getName(), <span class="string">'is Running. Time: %s'</span> % date_f()[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">######################################################</span></span><br><span class="line">    <span class="comment"># 准备工作</span></span><br><span class="line">    threads = []</span><br><span class="line">    <span class="comment"># 实例化信息&amp;检索语句初始化</span></span><br><span class="line">    sqlConf = sql_conf.sqlDict</span><br><span class="line">    <span class="comment"># 文件生成路径/各报表标题初始化</span></span><br><span class="line">    filePath, fileTitleJob = bas_mail_conf.mail_file_path_class, bas_mail_conf.fileDict</span><br><span class="line">    <span class="comment">######################################################</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">######################################################</span></span><br><span class="line">    <span class="comment"># 采集多线程初始化</span></span><br><span class="line">    <span class="comment"># r_lock = threading.RLock()</span></span><br><span class="line">    <span class="keyword">for</span> rs <span class="keyword">in</span> sqlConf.keys():</span><br><span class="line">        t = MyThread(ora_job, (sqlConf[rs], filePath, fileTitleJob[rs]))</span><br><span class="line">        threads.append(t)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 线程批量启动</span></span><br><span class="line">    <span class="keyword">for</span> rt <span class="keyword">in</span> threads:</span><br><span class="line">        rt.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> rt <span class="keyword">in</span> threads:</span><br><span class="line">        rt.join()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># mail_dict = &#123;&#125;</span></span><br><span class="line">    mail_dict_combine = []</span><br><span class="line">    <span class="comment"># print(threads)</span></span><br><span class="line">    <span class="comment"># for rt in threads:</span></span><br><span class="line">    <span class="comment">#     # mail_dict['mail_attach_flag'] = rt.get_result()[0]</span></span><br><span class="line">    <span class="comment">#     # mail_dict['mail_attach_view'] = rt.get_result()[1]</span></span><br><span class="line">    <span class="comment">#     # mail_dict['mail_attach_text'] = rt.get_result()[2]</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     # 也可以使用临时字典新建内存,并保留当前字典键值对,再放入列表</span></span><br><span class="line">    <span class="comment">#     # mail_dict_copy = copy.copy(mail_dict)</span></span><br><span class="line">    <span class="comment">#     # mail_dict_combine.append(mail_dict_copy)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     mail_dict_combine.append(</span></span><br><span class="line">    <span class="comment">#         &#123;</span></span><br><span class="line">    <span class="comment">#             'mail_attach_flag': rt.get_result()[0],</span></span><br><span class="line">    <span class="comment">#             'mail_attach_view': rt.get_result()[1],</span></span><br><span class="line">    <span class="comment">#             'mail_attach_text': rt.get_result()[2]</span></span><br><span class="line">    <span class="comment">#         &#125;</span></span><br><span class="line">    <span class="comment">#     )</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># pprint.pprint(mail_dict_combine)</span></span><br><span class="line">    print(<span class="string">'Thread'</span>, threading.current_thread().getName(), <span class="string">'End. Time: %s'</span> % date_f()[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(id(mail_dict_copy))    # 这里打印的内存值不同</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 下次遍历前初始化字典的写法</span></span><br><span class="line">    <span class="comment"># mail_dict_combine.append(mail_dict)</span></span><br><span class="line">    <span class="comment"># mail_dict = &#123;&#125;</span></span><br><span class="line">    <span class="comment"># print(id(mail_dict_combine))    # 这里打印的内存值虽相同,但??????</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># # 注意:下面的写法有问题</span></span><br><span class="line">    <span class="comment"># 若直接mail_dict_combine.append(mail_dict),会出现覆盖情况,数据始终指向mail_dict初始内存,故只能取到最后一组数据</span></span><br><span class="line">    <span class="comment"># mail_dict_combine.append(mail_dict)</span></span><br><span class="line">    <span class="comment"># print(id(mail_dict_combine)) # 即多次打印这里的内存值相同</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(mail_dict_combine)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">######################################################</span></span><br><span class="line">    <span class="comment">######################################################</span></span><br><span class="line">    <span class="comment"># # 单线程</span></span><br><span class="line">    <span class="comment"># for rs in sqlConf.keys():</span></span><br><span class="line">    <span class="comment">#     ora_job(sqlConf[rs], filePath, fileTitleJob[rs])</span></span><br><span class="line">    <span class="comment">######################################################</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/18/20191218-1300-Python3-Monitor/" data-id="ck4ili0710003h0u63umd4rxu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python3/" rel="tag">Python3</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Demo/" rel="tag">Demo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Excel/" rel="tag">Excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop-2-X/" rel="tag">Hadoop 2.X</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hive/" rel="tag">Hive</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Oracle12c/" rel="tag">Oracle12c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python3/" rel="tag">Python3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spark/" rel="tag">Spark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ZooKeeper-Kafka/" rel="tag">ZooKeeper Kafka</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Demo/" style="font-size: 10px;">Demo</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/Hadoop-2-X/" style="font-size: 10px;">Hadoop 2.X</a> <a href="/tags/Hive/" style="font-size: 20px;">Hive</a> <a href="/tags/OS/" style="font-size: 10px;">OS</a> <a href="/tags/Oracle12c/" style="font-size: 10px;">Oracle12c</a> <a href="/tags/Python3/" style="font-size: 10px;">Python3</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/ZooKeeper-Kafka/" style="font-size: 10px;">ZooKeeper Kafka</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/21/20191221-1006-Oracle12cR2/">20191221_1006-Oracle12cR2</a>
          </li>
        
          <li>
            <a href="/2019/12/20/20191220-1940-Hive/">20191220-1940_Hive</a>
          </li>
        
          <li>
            <a href="/2019/12/20/20191220-1347-ubuntu16-04-2-server-amd64/">20191220_1347_ubuntu16.04.2-server-amd64</a>
          </li>
        
          <li>
            <a href="/2019/12/19/20191219-2347-Hadoop-2-6-1/">20191219-2347_Hadoop-2.6.1</a>
          </li>
        
          <li>
            <a href="/2019/12/19/20191219-2254-Hive-1-x/">20191219-2254_Hive-1.x</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>